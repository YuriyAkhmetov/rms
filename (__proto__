!function(){function t(e,n,o){function r(i,a){if(!n[i]){if(!e[i]){var u="function"==typeof require&&require;if(!a&&u)return u(i,!0);if(s)return s(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};e[i][0].call(l.exports,function(t){var n=e[i][1][t];return r(n||t)},l,l.exports,t,e,n,o)}return n[i].exports}for(var s="function"==typeof require&&require,i=0;i<o.length;i++)r(o[i]);return r}return t}()({1:[function(t,e,n){e.exports=function(t,e,n){for(var o=(2<<Math.log(e.length-1)/Math.LN2)-1,r=Math.ceil(1.6*o*n/e.length),s="";;)for(var i=t(r),a=0;a<r;a++){var u=i[a]&o;if(e[u]&&(s+=e[u],s.length===n))return s}}},{}],2:[function(t,e,n){function o(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function s(t){if(d===setTimeout)return setTimeout(t,0);if((d===o||!d)&&setTimeout)return d=setTimeout,setTimeout(t,0);try{return d(t,0)}catch(e){try{return d.call(null,t,0)}catch(e){return d.call(this,t,0)}}}function i(t){if(p===clearTimeout)return clearTimeout(t);if((p===r||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(t);try{return p(t)}catch(e){try{return p.call(null,t)}catch(e){return p.call(this,t)}}}function a(){g&&h&&(g=!1,h.length?m=h.concat(m):y=-1,m.length&&u())}function u(){if(!g){var t=s(a);g=!0;for(var e=m.length;e;){for(h=m,m=[];++y<e;)h&&h[y].run();y=-1,e=m.length}h=null,g=!1,i(t)}}function c(t,e){this.fun=t,this.array=e}function l(){}var d,p,f=e.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:o}catch(t){d=o}try{p="function"==typeof clearTimeout?clearTimeout:r}catch(t){p=r}}();var h,m=[],g=!1,y=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];m.push(new c(t,e)),1!==m.length||g||s(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=l,f.addListener=l,f.once=l,f.off=l,f.removeListener=l,f.removeAllListeners=l,f.emit=l,f.prependListener=l,f.prependOnceListener=l,f.listeners=function(t){return[]},f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],3:[function(t,e,n){"use strict";e.exports=t("./lib/index")},{"./lib/index":7}],4:[function(t,e,n){"use strict";function o(){f=!1}function r(t){if(!t)return void(d!==m&&(d=m,o()));if(t!==d){if(t.length!==m.length)throw new Error("Custom alphabet for shortid must be "+m.length+" unique characters. You submitted "+t.length+" characters: "+t);var e=t.split("").filter(function(t,e,n){return e!==n.lastIndexOf(t)});if(e.length)throw new Error("Custom alphabet for shortid must be "+m.length+" unique characters. These characters were not unique: "+e.join(", "));d=t,o()}}function s(t){return r(t),d}function i(t){h.seed(t),p!==t&&(o(),p=t)}function a(){d||r(m);for(var t,e=d.split(""),n=[],o=h.nextValue();e.length>0;)o=h.nextValue(),t=Math.floor(o*e.length),n.push(e.splice(t,1)[0]);return n.join("")}function u(){return f?f:f=a()}function c(t){var e=u();return e[t]}function l(){return d||m}var d,p,f,h=t("./random/random-from-seed"),m="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";e.exports={get:l,characters:s,seed:i,lookup:c,shuffled:u}},{"./random/random-from-seed":10}],5:[function(t,e,n){"use strict";function o(t){var e="",n=Math.floor(.001*(Date.now()-a));return n===s?r++:(r=0,s=n),e+=i(u),e+=i(t),r>0&&(e+=i(r)),e+=i(n)}var r,s,i=t("./generate"),a=(t("./alphabet"),1459707606518),u=6;e.exports=o},{"./alphabet":4,"./generate":6}],6:[function(t,e,n){"use strict";function o(t){for(var e,n=0,o="";!e;)o+=i(s,r.get(),1),e=t<Math.pow(16,n+1),n++;return o}var r=t("./alphabet"),s=t("./random/random-byte"),i=t("nanoid/format");e.exports=o},{"./alphabet":4,"./random/random-byte":9,"nanoid/format":1}],7:[function(t,e,n){"use strict";function o(t){return a.seed(t),e.exports}function r(t){return l=t,e.exports}function s(t){return void 0!==t&&a.characters(t),a.shuffled()}function i(){return u(l)}var a=t("./alphabet"),u=t("./build"),c=t("./is-valid"),l=t("./util/cluster-worker-id")||0;e.exports=i,e.exports.generate=i,e.exports.seed=o,e.exports.worker=r,e.exports.characters=s,e.exports.isValid=c},{"./alphabet":4,"./build":5,"./is-valid":8,"./util/cluster-worker-id":11}],8:[function(t,e,n){"use strict";function o(t){if(!t||"string"!=typeof t||t.length<6)return!1;var e=new RegExp("[^"+r.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]");return!e.test(t)}var r=t("./alphabet");e.exports=o},{"./alphabet":4}],9:[function(t,e,n){"use strict";var o,r="object"==typeof window&&(window.crypto||window.msCrypto);o=r&&r.getRandomValues?function(t){return r.getRandomValues(new Uint8Array(t))}:function(t){for(var e=[],n=0;n<t;n++)e.push(Math.floor(256*Math.random()));return e},e.exports=o},{}],10:[function(t,e,n){"use strict";function o(){return s=(9301*s+49297)%233280,s/233280}function r(t){s=t}var s=1;e.exports={nextValue:o,seed:r}},{}],11:[function(t,e,n){"use strict";e.exports=0},{}],12:[function(t,e,n){"use strict";function o(t,e,n){var o=this;s.call(o,t,e,n)}function r(t){return 200===t.status||0===t.status&&t.responseText}var s=t("./common-system");e.exports=o,o.prototype=Object.create(s.prototype),o.prototype.constructor=o,o.load=s.load,o.prototype.read=function(t,e,n){return new Promise(function(e,o){function s(){r(a)?e(a.responseText):i()}function i(){var e=new Error("Can't XHR "+JSON.stringify(t));404!==a.status&&0!==a.status||(e.code="ENOENT",e.notFound=!0),o(e)}var a=new XMLHttpRequest;try{a.open("GET",t,!0),n&&a.overrideMimeType&&a.overrideMimeType(n),a.onreadystatechange=function(){4===a.readyState&&s()},a.onload=a.load=s,a.onerror=a.error=i,a.send()}catch(u){o(u)}})}},{"./common-system":14}],13:[function(t,e,n){"use strict";n.resolve=function(t,e){return new URL(e,t).toString()}},{}],14:[function(t,e,n){"use strict";function o(t,e,n){var o=this;n=n||{},e=e||{},o.name=n.name||e.name||"",o.location=t,o.description=e,o.dependencies={},o.main=null,o.resources=n.resources||{},o.modules=n.modules||{},o.systemLocations=n.systemLocations||{},o.systems=n.systems||{},o.systemLoadedPromises=n.systemLoadedPromises||{},o.buildSystem=n.buildSystem,o.strategy=n.strategy||"nested",o.analyzers={js:o.analyzeJavaScript},o.translators={json:o.translateJson},o.internalRedirects={},o.externalRedirects={},o.node=!!n.node,o.browser=!!n.browser,o.parent=n.parent,o.root=n.root||o,o.systems[o.name]=o,o.systemLocations[o.name]=o.location,o.systemLoadedPromises[o.name]=Promise.resolve(o),null!=n.name&&null==e.name?console.warn("Package loaded by name "+JSON.stringify(n.name)+" has no name"):null!=n.name&&n.name!==e.name&&console.warn("Package loaded by name "+JSON.stringify(n.name)+" has mismatched name "+JSON.stringify(e.name)),o.main=e.main||"index.js",o.internalRedirects[".js"]="./"+i.resolve(o.main,""),n.browser&&o.overlayBrowser(e),n.node&&o.overlayNode(e),e.dependencies&&o.addDependencies(e.dependencies),o.root===o&&e.devDependencies&&o.addDependencies(e.devDependencies),e.extensions&&o.addExtensions(e.extensions),e.redirects&&o.addRedirects(e.redirects)}function r(t){return t._args?"flat":"nested"}var s=t("./url"),i=t("./identifier"),a=t("./module"),u=t("./resource"),c=t("./parse-dependencies"),l=t("./compile"),d=Object.prototype.hasOwnProperty;e.exports=o,o.load=function(t,e){var n=this;return n.prototype.loadSystemDescription(t,"<anonymous>").then(function(o){return new n(t,o,e)})},o.prototype["import"]=function(t,e){var n=this;return n.load(t,e).then(function(){return n.root.main=n.lookup(t,e),n.require(t,e)})},o.prototype.require=function(t,e){var n=this,o=i.resolve(t,e);if(i.isAbsolute(t)){if(n.externalRedirects[o]===!1)return{};if(n.externalRedirects[o])return n.require(n.externalRedirects[o],o);var r=i.head(t),s=i.tail(t);if(n.dependencies[r])return n.getSystem(r,e).requireInternalModule(s,e);if(n.modules[r])return n.requireInternalModule(t,e,n.modules[t]);var a=e?" via "+JSON.stringify(e):"";throw new Error("Can't require "+JSON.stringify(t)+a+" in "+JSON.stringify(n.name))}return n.requireInternalModule(t,e)},o.prototype.requireInternalModule=function(t,e,n){var o=this,r=i.resolve(t,e),s=o.normalizeIdentifier(r);if(o.internalRedirects[s])return o.require(o.internalRedirects[s],s);if(n=n||o.lookupInternalModule(s),n.error){var a=n.error,u=e?" via "+JSON.stringify(e):"";throw a.message="Can't require module "+JSON.stringify(n.id)+u+" in "+JSON.stringify(o.name||o.location)+" because "+a.message,a}if(null!=n.exports)return n.exports;if("function"!=typeof n.factory)throw new Error("Can't require module "+JSON.stringify(n.filename)+". No exports. No exports factory.");return n.require=o.makeRequire(n.id,o.root.main),n.exports={},n.factory.call(null,n.require,n.exports,n,n.filename,n.dirname),n.exports},o.prototype.makeRequire=function(t,e){function n(e){return o.require(e,t)}var o=this;return n.main=e,n},o.prototype.getSystem=function(t,e){var n,o=this.dependencies[t];if(!o)throw n=e?" via "+JSON.stringify(e):"",new Error("Can't get dependency "+JSON.stringify(t)+" in package named "+JSON.stringify(this.name)+n);var r=this.systems[t];if(!r)throw n=e?" via "+JSON.stringify(e):"",new Error("Can't get dependency "+JSON.stringify(t)+" in package named "+JSON.stringify(this.name)+n);return r},o.prototype.loadSystem=function(t,e){var n=this,o=n.systemLoadedPromises[t];return o||(o=n.actuallyLoadSystem(t,e),n.systemLoadedPromises[t]=o),o},o.prototype.loadSystemDescription=function(t,e){var n=this,o=s.resolve(t,"package.json");return n.read(o,"utf-8","application/json").then(function(t){try{return JSON.parse(t)}catch(e){throw e.message=e.message+" in "+JSON.stringify(o),e}},function(n){throw n.message="Can't load package "+JSON.stringify(e)+" at "+JSON.stringify(t)+" because "+n.message,n})},o.prototype.actuallyLoadSystem=function(t,e){var n=this,o=n.constructor,s=n.systemLocations[t];if(!s){var i=e?" via "+JSON.stringify(e):"";throw new Error("Can't load package "+JSON.stringify(t)+i+" because it is not a declared dependency")}var a;return n.buildSystem&&(a=n.buildSystem.actuallyLoadSystem(t,e)),Promise.all([n.loadSystemDescription(s,t),a]).then(function(e){var i=e[0],a=e[1],u=new o(s,i,{parent:n,root:n.root,name:t,resources:n.resources,modules:n.modules,systems:n.systems,systemLocations:n.systemLocations,systemLoadedPromises:n.systemLoadedPromises,buildSystem:a,browser:n.browser,node:n.node,strategy:r(i)});return n.systems[u.name]=u,u})},o.prototype.getBuildSystem=function(){var t=this;return t.buildSystem||t},o.prototype.normalizeIdentifier=function(t){var e=this,n=i.extension(t);return d.call(e.translators,n)||d.call(e.analyzers,n)||"js"===n||"json"===n||(t+=".js"),t},o.prototype.load=function(t,e){var n=this;return n.deepLoad(t,e).then(function(){return n.deepCompile(t,e,{})})},o.prototype.deepCompile=function(t,e,n){var o=this,r=i.resolve(t,e);if(i.isAbsolute(t)){if(o.externalRedirects[r])return o.deepCompile(o.externalRedirects[r],r,n);var s=i.head(t),a=i.tail(t);if(o.dependencies[s]){var u=o.getSystem(s,e);return u.compileInternalModule(a,"",n)}return Promise.resolve()}return o.compileInternalModule(t,e,n)},o.prototype.compileInternalModule=function(t,e,n){var o=this,r=i.resolve(t,e),s=o.normalizeIdentifier(r);if(o.internalRedirects[s])return o.deepCompile(o.internalRedirects[s],"",n);var a=o.lookupInternalModule(s,e);return n[a.key]?Promise.resolve():(n[a.key]=!0,a.compiled?Promise.resolve():(a.compiled=!0,Promise.resolve().then(function(){return Promise.all(a.dependencies.map(function(t){return o.deepCompile(t,a.id,n)}))}).then(function(){return o.translate(a)}).then(function(){return o.compile(a)})["catch"](function(t){a.error=t})))},o.prototype.deepLoad=function(t,e,n){var o=this,r=i.resolve(t,e);if(i.isAbsolute(t)){if(o.externalRedirects[r])return o.deepLoad(o.externalRedirects[r],r,n);var s=i.head(t),a=i.tail(t);return o.dependencies[s]?o.loadSystem(s,e).then(function(t){return t.loadInternalModule(a,"",n)}):Promise.resolve()}return o.loadInternalModule(t,e,n)},o.prototype.loadInternalModule=function(t,e,n){function o(t){var o=i.resolve("./index.js",s);return c.redirect=o,!t||t.notFound&&""===u?r.loadInternalModule(o,e,n)["catch"](function(e){c.redirect=null,c.error=t||e}):void(c.error=t)}var r=this,s=i.resolve(t,e),a=r.normalizeIdentifier(s);if(r.internalRedirects[a])return r.deepLoad(r.internalRedirects[a],"",n);var u=i.extension(s),c=r.lookupInternalModule(a,e);return n=n||{},n[c.key]?Promise.resolve():(n[c.key]=!0,c.loadedPromise?c.loadedPromise:(c.loadedPromise=Promise.resolve().then(function(){if(null==c.factory&&null==c.exports)return r.read(c.location,"utf-8").then(function(t){return c.text=t,r.finishLoadingModule(c,n)},o)}),c.loadedPromise))},o.prototype.finishLoadingModule=function(t,e){var n=this;return Promise.resolve().then(function(){return n.analyze(t)}).then(function(){return Promise.all(t.dependencies.map(function(o){return n.deepLoad(o,t.id,e)}))})},o.prototype.lookup=function(t,e){var n=this,o=i.resolve(t,e);if(i.isAbsolute(t)){if(n.externalRedirects[o])return n.lookup(n.externalRedirects[o],o);var r=i.head(o),s=i.tail(o);if(n.dependencies[r])return n.getSystem(r,e).lookupInternalModule(s,"");if(n.modules[r]&&!s)return n.modules[r];var a=e?" via "+JSON.stringify(e):"";throw new Error("Can't look up "+JSON.stringify(t)+a+" in "+JSON.stringify(n.location)+" because there is no external module or dependency by that name")}return n.lookupInternalModule(t,e)},o.prototype.lookupInternalModule=function(t,e){var n=this,o=i.resolve(t,e),r=n.normalizeIdentifier(o);if(n.internalRedirects[r])return n.lookup(n.internalRedirects[r],o);var u=n.name+"/"+r,c=u.toLowerCase(),l=n.modules[c];return l&&l.redirect&&l.redirect!==l.id?n.lookupInternalModule(l.redirect):(l||(l=new a,l.id=r,l.extension=i.extension(r),l.location=s.resolve(n.location,r),l.filename=u,l.dirname=i.dirname(u),l.key=c,l.system=n,l.modules=n.modules,n.modules[c]=l),l.filename!==u&&(l.error=new Error("Can't refer to single module with multiple case conventions: "+JSON.stringify(u)+" and "+JSON.stringify(l.filename))),l)},o.prototype.addExtensions=function(t){for(var e=Object.keys(t),n=0;n<e.length;n++){var o=e[n],r=t[o];this.analyzers[o]=this.makeLoadStep(r,"analyze"),this.translators[o]=this.makeLoadStep(r,"translate")}},o.prototype.makeLoadStep=function(t,e){var n=this;return function(o){return n.getBuildSystem()["import"](t).then(function(t){if(t[e])return t[e](o)})}},o.prototype.translate=function(t){var e=this;if(null!=t.text&&null!=t.extension&&e.translators[t.extension])return e.translators[t.extension](t)},o.prototype.translateJson=function(t){t.text="module.exports = "+t.text.trim()+";\n"},o.prototype.analyze=function(t){if(null!=t.text&&null!=t.extension&&this.analyzers[t.extension])return this.analyzers[t.extension](t)},o.prototype.analyzeJavaScript=function(t){t.dependencies.push.apply(t.dependencies,c(t.text))},o.prototype.compile=function(t){null==t.factory&&null==t.redirect&&null==t.exports&&l(t)},o.prototype.getResource=function(t,e){var n=this;if(i.isAbsolute(t)){var o=i.head(t),r=i.tail(t);return n.getSystem(o,e).getInternalResource(r)}return n.getInternalResource(i.resolve(t,e))},o.prototype.locateResource=function(t,e){var n=this;if(i.isAbsolute(t)){var o=i.head(t),r=i.tail(t);return n.loadSystem(o,e).then(function(t){return t.getInternalResource(r)})}return Promise.resolve(n.getInternalResource(i.resolve(t,e)))},o.prototype.getInternalResource=function(t){var e=this,n=e.name+"/"+t,o=n.toLowerCase(),r=e.resources[o];return r||(r=new u,r.id=t,r.filename=n,r.dirname=i.dirname(n),r.key=o,r.location=s.resolve(e.location,t),r.system=e,e.resources[o]=r),r},o.prototype.addDependencies=function(t){for(var e=this,n=Object.keys(t),o=0;o<n.length;o++){var r=n[o];if(e.dependencies[r]=!0,!e.systemLocations[r]){var i;i="flat"===this.strategy?s.resolve(e.root.location,"node_modules/"+r+"/"):s.resolve(e.location,"node_modules/"+r+"/"),e.systemLocations[r]=i}}},o.prototype.introduce=function(t,e){if(!this.dependencies[e])throw new Error("Extension package cannot introduce a module to a package that the analyzer does not directly depend upon.");t.dependencies[e]=!0,t.systemLocations[e]||(t.systemLocations[e]=this.systemLocations[e])},o.prototype.addRedirects=function(t){for(var e=this,n=Object.keys(t),o=0;o<n.length;o++){var r=n[o],s=t[r];e.addRedirect(r,s)}},o.prototype.addRedirect=function(t,e){var n=this;i.isAbsolute(t)?n.externalRedirects[t]=e:(t=n.normalizeIdentifier(i.resolve(t)),n.internalRedirects[t]=e)},o.prototype.overlayBrowser=function(t){var e=this;"string"==typeof t.browser?e.addRedirect("",t.browser):t.browser&&"object"==typeof t.browser&&e.addRedirects(t.browser)},o.prototype.inspect=function(){var t=this;return{type:"system",location:t.location}}},{"./compile":15,"./identifier":16,"./module":17,"./parse-dependencies":18,"./resource":19,"./url":13}],15:[function(t,e,n){(function(t){"use strict";function n(t){var e=t.filename.replace(/[^\w\d]|^\d/g,"_");try{t.factory=o("(function "+e+"(require, exports, module, __filename, __dirname) {"+t.text+"//*/\n})\n//# sourceURL="+t.system.location+t.id)}catch(n){throw n.message=n.message+" in "+t.filename,n}t.factory.displayName=t.filename}e.exports=n;var o=eval;t.navigator&&t.navigator.userAgent.indexOf("Firefox")>=0&&(o=new Function("_","return eval(_)"))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],16:[function(t,e,n){"use strict";function o(t){return""!==t&&t.lastIndexOf("./",0)<0&&t.lastIndexOf("../",0)<0}function r(t){var e=t.lastIndexOf("/");return t.indexOf(".",e)<0}function s(t){var e=t.indexOf("/");return e<0?t:t.slice(0,e)}function i(t){var e=t.indexOf("/");return e<0?"":t.slice(e+1)}function a(t){var e=t.lastIndexOf("/"),n=t.lastIndexOf(".");return n<=e?"":t.slice(n+1)}function u(t){var e=t.lastIndexOf("/");return e<0?t:t.slice(0,e)}function c(t){var e=t.lastIndexOf("/");return e<0?t:t.slice(e+1)}function l(t,e){e=e||"";var n,o=t.split("/"),r=[];(o.length&&"."===o[0]||".."===o[0])&&(n=e.split("/"),n.pop(),o.unshift.apply(o,n));for(var s=0;s<o.length;s++)".."===o[s]?r.length&&r.pop():""!==o[s]&&"."!==o[s]&&r.push(o[s]);return r.join("/")}n.isAbsolute=o,n.isBare=r,n.head=s,n.tail=i,n.extension=a,n.dirname=u,n.basename=c,n.resolve=l},{}],17:[function(t,e,n){"use strict";function o(){this.id=null,this.extension=null,this.system=null,this.key=null,this.filename=null,this.dirname=null,this.exports=null,this.redirect=null,this.text=null,this.factory=null,this.dependencies=[],this.loadedPromise=null,this.index=null,this.bundled=!1}e.exports=o},{}],18:[function(t,e,n){"use strict";function o(t){var e={};return String(t).replace(/(?:^|[^\w\$_.])require\s*\(\s*["']([^"']*)["']\s*\)/g,function(t,n){e[n]=!0}),Object.keys(e)}e.exports=o},{}],19:[function(t,e,n){"use strict";function o(){this.id=null,this.filename=null,this.dirname=null,this.key=null,this.location=null,this.system=null}e.exports=o},{}],20:[function(t,e,n){toastr.options={closeButton:!1,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-bottom-right",preventDuplicates:!1,onclick:null,showDuration:300,hideDuration:1e3,timeOut:5e3,extendedTimeOut:1e3,showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},window.JSONLint=t("../../static/libs/jsonlint/jsonlint.js"),t("./ng-app"),moment.locale("ru")},{"../../static/libs/jsonlint/jsonlint.js":95,"./ng-app":46}],21:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p=function(t,e){function n(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;a=t("../dscommon/util").assert,d=t("../dscommon/util").validate,l=t("../dscommon/util").serviceOwner,o=t("../dscommon/DSObject"),r=t("./models/Person"),t("../utils/angular-local-storage.js"),e.exports=(c=angular.module("config",["LocalStorageModule"])).name,c.config(["localStorageServiceProvider",function(t){t.setPrefix("rms")}]),c.run(["$rootScope","config",function(t,e){t.config=e}]),s=1,i=1,u=function(t){return(t=/https?:\/\/.*?($|\/)/.exec(t)[0])?("/"!==t.charAt(t.length-1)&&(t+="/"),t):null},c.factory("config",["$http","localStorageService",function(t,e){var n,a,c,f,h,m,g,y,v,_,w,k;if(n=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return p(n,t),n.begin("Config"),n.propStr("token",{valid:d.trimString}),n.propStr("teamwork",{init:"http://teamwork.webprofy.ru/",valid:u}),n.propCalc("hasRoles",function(){return this.teamwork.indexOf("://teamwork.webprofy.ru/")>0}),n.propCalc("hasTimeReports",function(){return this.teamwork.indexOf("://teamwork.webprofy.ru/")>0||this.teamwork.indexOf("://delightsoft.teamworkpm.net/")>0}),n.propConst("planTag","План"),n.propConst("teamleadRole","Teamlead"),n.propNum("hResizer"),n.propNum("vResizer"),n.propStr("currentUserId"),n.propDoc("currentUser",r),n.propCalc("canUserSetPlan",function(){var t,e;return(null!=(t=this.currentUser)&&null!=(e=t.roles)?e.get(this.teamleadRole):void 0)||"http://delightsoft.teamworkpm.net/"===this.teamwork}),n.propStr("selectedRole"),n.propNum("selectedCompany",{init:-1}),n.propStr("selectedManager"),n.propNum("selectedLoad"),n.propNum("activeSidebarTab",{init:0}),n.propNum("refreshPeriod"),n.propNum("autosave",{init:0}),n.propNum("view3GroupByPerson",{init:0}),n.propNum("view3HidePeopleWOTasks",{init:0}),n.propStr("view3FilterByPerson",{init:""}),n.propStr("view3FilterByProject",{init:""}),n.propStr("view3FilterByTask",{init:""}),n.propNum("histStart",{init:-1}),n.onAnyPropChange(function(t,n,o,r){"currentUserId"!==n&&"currentUser"!==n&&("teamwork"!==n&&"token"!==n||this.set("histStart",-1),"undefined"!=typeof o?e.set(n,o):e.remove(n))}),n.prototype.hasFilter=function(){var t;return t=this.get("teamwork"),"http://teamwork.webprofy.ru/"===t||"https://delightsoft.teamworkpm.net/"===t},n.end(),n}(o),a=l.add(new n(l,"config")),f=!0,h=!0,_=1,w=0,"string"==typeof(v=e.get("ver"))&&((k=v.split(".")).length=2)&&(_=parseInt(k[0]),w=parseInt(k[1])),h=(f=_===s)&&w===i,h||e.set("ver",s+"."+i),f){g=n.prototype.__props;for(m in g)c=g[m],(h||"teamwork"===m||"token"===m)&&(c.readonly||null===(y=e.get(m))||a.set(m,y))}return a}])},{"../dscommon/DSObject":86,"../dscommon/util":92,"../utils/angular-local-storage.js":93,"./models/Person":36}],22:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p=function(t,e){function n(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;e.exports=(d=angular.module("data/PeopleWithJson",[])).name,c=t("../../dscommon/util").assert,l=t("../../dscommon/util").error,i=t("../../dscommon/DSSet"),a=t("../../dscommon/DSTags"),o=t("../../dscommon/DSData"),s=t("../../dscommon/DSDigest"),r=t("../../dscommon/DSDataServiceBase"),u=t("../models/Person"),d.factory("PeopleWithJson",["DSDataSource","config","$rootScope","$http","$q",function(t,e,n,d,f){var h;return h=function(t){function h(){return h.__super__.constructor.apply(this,arguments)}return p(h,t),h.begin("PeopleWithJson"),h.addPool(),h.propDoc("teamworkPeople",i),h.propObj("cancel",{init:null}),h.propSet("people",u),h.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this._unwatchA&&this._unwatchA()}),h.prototype.clear=function(){var t;o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},h.prototype.init=function(t){var o,i,p,h;c&&(t instanceof r||l.invalidArg("dsDataService")),(h=this.set("teamworkPeople",t.findDataSet(this,_.assign({},this.params,{type:u,source:!0})))).release(this),p=this.get("peopleSet"),i=function(t){return function(e,n){n||(e.hasOwnProperty("status")?toastr.error("Failed to load <i>data/people.json</i>:<br/><br/> "+e.status+" "+e.statusText,null,{positionClass:"toast-top-center",newestOnTop:!0,timeOut:-1}):toastr.error("Invalid <i>data/people.json</i>:<br/><br/> "+e.message,null,{positionClass:"toast-top-center",newestOnTop:!0,timeOut:-1}),t.set("cancel",null)),t._endLoad(!1)}}(this),o=function(t){return function(){var o;t._startLoad()&&(o=t.set("cancel",f.defer()),d.get("data/people.json?t="+(new Date).getTime(),{timeout:o,transformResponse:function(t,e,n){if(200===n)return JSONLint.parse(t)}}).then(function(o){200===o.status?(t.set("cancel",null),s.block(function(){var r,s,i,u,c,l,d,f,m,g,y,v,_,w,k,S,D,b,T,O,P,$,j,x;if(_=n.peopleRoles=o.data.roles,j=n.selectedRole=e.get("selectedRole"))for(u=0,d=_.length;u<d;u++)if(i=_[u],i.role===j){n.selectedRole=i;break}for(s=n.filterManagers=[{name:"All",$ds_key:null}],T=o.data.people,c=0,f=T.length;c<f;c++)if(k=T[c],h.items.hasOwnProperty(S=""+k.id)&&((x=h.items[S]).set("roles",r=new a(t,k.role)),r.release(t),k.hasOwnProperty("projects")))if(Array.isArray(k.projects))try{for(x.projects=b={},O=k.projects,l=0,m=O.length;l<m;l++)D=O[l],b[D]=!0;s.push(x)}catch(L){console.error("Person "+k.name+": Invalid prop 'projects'")}else console.error("Person "+k.name+": Invalid prop 'projects'");if($=n.selectedManager=e.get("selectedManager"))for(y=0,g=s.length;y<g;y++)if(i=s[y],i.$ds_key===$){n.selectedManager=i;break}v={},P=h.items;for(S in P)w=P[S],v[S]=w,w.addRef(t);p.merge(t,v),t._endLoad(!0)})):i(o,0===o.status)},i))}}(this),this._unwatchA=h.watchStatus(this,function(t){return function(e,n){var r;if(n!==(r=t.get("status")))switch(n){case"ready":s.block(o);break;case"update":s.block(o);break;case"nodata":t.set("status","nodata")}}}(this)),this.init=null},h.end(),h}(o)}])},{"../../dscommon/DSData":77,"../../dscommon/DSDataServiceBase":80,"../../dscommon/DSDigest":82,"../../dscommon/DSSet":89,"../../dscommon/DSTags":90,"../../dscommon/util":92,"../models/Person":36}],23:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h=function(t,e){function n(){this.constructor=t}for(var o in e)m.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},m={}.hasOwnProperty;e.exports=(f=angular.module("data/PersonDayStatData",[])).name,d=t("../../dscommon/util").assert,p=t("../../dscommon/util").error,i=t("../../dscommon/DSDocument"),r=t("../../dscommon/DSDataServiceBase"),o=t("../../dscommon/DSData"),s=t("../../dscommon/DSDigest"),a=t("../../dscommon/DSSet"),u=t("../models/Person"),l=t("../models/Task"),c=t("../models/PersonDayStat"),f.factory("PersonDayStatData",[function(){var t;return t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.begin("PersonDayStatData"),e.addPool(),e.propDoc("tasks",a),e.propDoc("people",a),e.propSet("personDayStats",c),e.ds_dstr.push(function(){"function"==typeof this._unwatchA&&this._unwatchA(),"function"==typeof this._unwatchB&&this._unwatchB(),"function"==typeof this._unwatch1&&this._unwatch1(),"function"==typeof this._unwatch2&&this._unwatch2()}),e.prototype.clear=function(){o.prototype.clear.call(this),"function"==typeof this._unwatch1&&this._unwatch1(),delete this._unwatch1,"function"==typeof this._unwatch2&&this._unwatch2(),delete this._unwatch2},e.prototype.init=function(t){var e,n,o,a,f,h,m,g;d&&(t instanceof r||p.invalidArg("dsDataService")),(h=this.set("tasks",t.findDataSet(this,_.assign({},this.params,{type:l,filter:"assigned"})))).release(this),m=h.items,(n=this.set("people",t.findDataSet(this,{type:u,mode:this.params.mode}))).release(this),o=n.items,a=this.get("personDayStats"),e=function(t){return function(){var e,r,i,l,f,g,y,v,w,k,S,D,b,T,O;if(t._startLoad()){O=_.groupBy(m,function(t){return t.get("responsible").$ds_key}),f=moment.duration((y=t.params.endDate).diff(b=t.params.startDate)).asDays(),i=b,l=function(){var t,e,n;for(n=[],v=t=0,e=f;0<=e?t<=e:t>=e;v=0<=e?++t:--t)n.push(((i=moment(D=i)).add(1,"day"),D));return n}(),e=function(t){var e,n,o,r,s,a,u,c,d,p,f,h,m,g,y,_,w,k,S,D,T,P,$;if(D=function(){var t,e,n;for(n=[],t=0,e=l.length;t<e;t++)i=l[t],n.push(0);return n}(),T=function(){var t,e,n;for(n=[],t=0,e=l.length;t<e;t++)i=l[t],n.push(moment.duration(0));return n}(),n=t.get("dayStats"),O.hasOwnProperty(m=(h=t.get("person")).$ds_key))for(g=O[m],s=0,c=g.length;s<c;s++)if(S=g[s],null!==(o=S.duedate))if(null!==(w=S.get("split")))for(y=k=w.list,v=a=0,d=y.length;a<d;v=a+=2)i=y[v],f=Math.floor(moment(o).add(i).diff(b)/864e5),0<=f&&f<n.length&&(T[f].add(k[v+1]),D[f]++);else f=Math.floor((o.valueOf()-b.valueOf())/864e5),0<=f&&f<n.length&&(null!==(r=S.get("remaining"))&&T[f].add(r),D[f]++);for(e=h.get("contractTime"),P=moment.duration(0),v=u=0,p=n.length;u<p;v=++u)_=n[v],_.set("tasksCount",D[v]),_.set("contract",e),_.set("tasksTotal",$=T[v]),_.set("timeLeft",moment.duration(e).subtract($)),P.add($);t.set("totalPeriodTime",P)},T={};for(k in o)w=o[k],e(T[k]=new c(t,w.$ds_key,w,l));t.get("personDayStatsSet").merge(t,T),g=function(t){a.hasOwnProperty(t)&&e(a[t])},S=function(e){d&&(e instanceof u||p.invalidArg("person")),s.render(t.$ds_key,e.$ds_key,g)},t._unwatch1=h.watch(t,{change:r=function(t,e,n,o){"estimate"===e||"split"===e||"duedate"===e?null!==(w=t.get("responsible"))&&null!==t.get("duedate")&&S(w):"responsible"===e&&(null!==o&&O.hasOwnProperty(k=o.$ds_key)&&_.remove(O[k],t).length>0&&S(o),null!==n&&(h=O.hasOwnProperty(k=n.$ds_key)?O[k]:O[k]=[],_.find(h,t)||(h.push(t),S(n))))},add:function(t){r(t,"responsible",t.get("responsible"),null)},remove:function(t){null!==(w=t.get("responsible"))&&O.hasOwnProperty(k=w.$ds_key)&&(_.remove(O[k],t),S(w))}}),t._unwatch2=n.watch(t,{add:function(e){var n,o;o=new c(t,n=e.$ds_key,e,l),o.get("dayStatsList").merge(t,function(){var t,e,n;for(n=[],v=t=0,e=l.length;t<e;v=++t)i=l[v],n.push(((D=new c.DayStat(this,"personKey_"+v)).set("day",i),D));return n}.call(t)),t.get("personDayStatsSet").add(t,o),S(e)},remove:function(e){t.get("personDayStatsSet").remove(t.get("personDayStats")[e.$ds_key])},change:function(t,e,n,o){"contractTime"===e&&S(t)}}),t._endLoad(!0)}}}(this),f=[h,n],g=function(t){return function(n,o){var r,a;if((r=i.integratedStatus(f))!==(a=t.get("status")))switch(r){case"ready":s.block(e);break;case"update":t._startLoad()&&t._endLoad(!0);break;case"nodata":t.set("status","nodata")}}}(this),this._unwatchA=n.watchStatus(this,g),this._unwatchB=h.watchStatus(this,g),this.init=null},e.end(),e}(o)}])},{"../../dscommon/DSData":77,"../../dscommon/DSDataServiceBase":80,"../../dscommon/DSDigest":82,"../../dscommon/DSDocument":83,"../../dscommon/DSSet":89,"../../dscommon/util":92,"../models/Person":36,"../models/PersonDayStat":37,"../models/Task":41}],24:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f=function(t,e){function n(){this.constructor=t}for(var o in e)h.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},h={}.hasOwnProperty;e.exports=(p=angular.module("data/TasksWithTimeTracking",[])).name,l=t("../../dscommon/util").assert,d=t("../../dscommon/util").error,i=t("../../dscommon/DSSet"),a=t("../../dscommon/DSTags"),o=t("../../dscommon/DSData"),s=t("../../dscommon/DSDigest"),r=t("../../dscommon/DSDataServiceBase"),u=t("../models/Task"),c=t("../models/TaskTimeTracking"),p.factory("TasksWithTimeTracking",["DSDataSource","$rootScope","$http","$q",function(t,e,n,s){var a;return a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.begin("TasksWithTimeTracking"),e.addPool(),e.propDoc("srcTasks",i),e.propDoc("srcTasksTimeTracking",i),e.propObj("cancel",{init:null}),e.propSet("tasks",u),e.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this.__unwatchA&&this.__unwatchA(),"function"==typeof this.__unwatchB&&this.__unwatchB()}),e.prototype.clear=function(){var t;o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},e.prototype.init=function(t){var e,n,o;l&&(t instanceof r||d.invalidArg("dsDataService")),(e=this.set("srcTasks",t.findDataSet(this,{mode:"original",type:u,filter:"all",source:!0}))).release(this),
(n=this.set("srcTasksTimeTracking",t.findDataSet(this,{mode:"original",type:c}))).release(this),o=this.get("tasksSet"),this.__unwatchA=e.watch(this,{add:function(t){var e;null===t.get("timeTracking")&&(e=c.pool.find(this,t.$ds_key))&&(t.set("timeTracking",e),e.release(this)),o.add(this,t.addRef(this))},remove:function(t){o.remove(t)}}),this.__unwatchB=e.watchStatus(this,function(t){return function(e,n){t.set("status",n)}}(this)),this.init=null},e.end(),e}(o)}])},{"../../dscommon/DSData":77,"../../dscommon/DSDataServiceBase":80,"../../dscommon/DSDigest":82,"../../dscommon/DSSet":89,"../../dscommon/DSTags":90,"../../dscommon/util":92,"../models/Task":41,"../models/TaskTimeTracking":43}],25:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h,m,g,y,v=function(t,e){function n(){this.constructor=t}for(var o in e)w.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},w={}.hasOwnProperty;e.exports=(g=angular.module("data/dsDataChanges",["LocalStorageModule",t("../../dscommon/DSDataSource")])).name,h=t("../../dscommon/util").assert,y=t("../../dscommon/util").serviceOwner,m=t("../../dscommon/util").error,a=t("../../dscommon/DSDigest"),s=t("../../dscommon/DSChangesBase"),i=t("../../dscommon/DSDataEditable"),c=t("../../dscommon/DSTags"),u=t("../../dscommon/DSSet"),l=t("../models/Person"),p=t("../models/Tag"),f=t("../models/Task"),r=t("../models/types/Comments"),d=t("../utils/RMSData"),g.run(["dsChanges","$rootScope",function(t,e){e.changes=t}]),o=1,g.factory("dsChanges",["TWTaskLists","DSDataSource","config","localStorageService","$rootScope","$http","$timeout","$q",function(t,e,n,u,h,m,g,w){var k;return k=function(m){function y(t,e){s.call(this,t,e)}var k,S,D,b;return v(y,m),y.begin("DSChanges"),y.propSet("tasks",f.Editable),y.propObj("dataService"),y.propDoc("source",e),y.propObj("cancel",{init:null}),y.ds_dstr.push(function(){var t;this.__unwatch2(),this.__unwatch3(),"function"==typeof this.__unwatch4&&this.__unwatch4(),"function"==typeof this.__unwatchStatus1&&this.__unwatchStatus1(),"function"==typeof this.__unwatchStatus2&&this.__unwatchStatus2(),"function"==typeof this.__unwatchStatus3&&this.__unwatchStatus3(),(t=this.get("cancel"))&&t.resolve()}),y.prototype.init=function(t){var e;this.set("dataService",t),this.set("source",t.get("dataSource")),f.prototype.__props.tags.read=function(t){var n,o,r,s,i;if(null===t)return null;for(i=null,r=t.split(","),n=0,o=r.length;n<o;n++)s=r[n],e.items.hasOwnProperty(s=s.trim())&&((i||(i={}))[s]=e.items[s]);return null===i?null:new c(this,i)},e=t.findDataSet(this,{type:p,mode:"original"}),this.__unwatch2=e.watchStatus(this,function(t){return function(e,n){switch(n){case"ready":a.block(function(){return t.load()});break;case"nodata":t.set("status","nodata")}}}(this)),e.release(this),this.__unwatch3=h.$watch(function(){return n.get("autosave")},function(t){return function(e){var n;e?t.__unwatch4=t.get("tasksSet").watch(t,{add:n=function(){return h.$evalAsync(function(){t.save()})},change:n}):("function"==typeof t.__unwatch4&&t.__unwatch4(),t.__unwatch4=null)}}(this))},y.prototype.clear=function(){"function"==typeof this.__unwatchStatus2&&this.__unwatchStatus2(),delete this.__unwatchStatus2,this.reset()},y.prototype.load=function(){var e,r,s;if("ready"!==this.get("status")){if(!this._startLoad())return;e=i(f.Editable).$u,(r=u.get("changes"))?r.ver===o&&r.source.url===n.get("teamwork")&&r.source.token===n.get("token")?(s=this.get("dataService").findDataSet(this,{type:l,mode:"original"}),this.__unwatchStatus2=s.watchStatus(this,function(n){return function(o,i,u,c){var l;"ready"===i&&(c(),l=n.get("dataService").findDataSet(n,{type:f,mode:"original",filter:"all"}),n.__unwatchStatus3=l.watchStatus(n,function(o,i,u,c){var d,p,h,m,g,y,v,_,w,k;if("ready"===i){c(),f.pool.enableWatch(!1),_=n.mapToChanges(r.changes),v=_.load.Person;for(y in v)if(m=v[y],s.items.hasOwnProperty(y))for(g=s.items[y],p=0,h=m.length;p<h;p++)(d=m[p])(g);else console.error("Person #{personKey} missing in server data");k=(w=n.get("tasksSet")).$ds_pool,t.loadTaskListsAndProjects(n.get("dataService").get("dataSource"),_.load).then(function(){a.block(function(){var t,o,r,s,i,a;o={},t=_.changes.tasks;for(a in t){if(s=t[a],a.startsWith("new:"))console.info("2."),r=f.pool.find(n,a),r.set("status","new");else if(!l.items.hasOwnProperty(a)||(r=l.items[a]).get("completed"))continue;(i=k.find(n,a,o)).init(r,w,s),i.$u=e,i.hasOwnProperty("__change")||(delete o[i.$ds_key],i.release(n)),r.release(n)}w.merge(n,o),f.pool.enableWatch(!0),n._endLoad(!0)})})}}),l.release(n))}}(this)),s.release(this)):(u.remove("changes"),this._endLoad(!0)):this._endLoad(!0)}},y.prototype.persist=function(){this.hasOwnProperty("__persist")||(this.__persist=g(function(t){return function(){delete t.__persist,t.saveToLocalStorage()}}(this)))},y.prototype.saveToLocalStorage=function(){var t,e;this.anyChange()?(t=this.changesToMap(),e={},u.set("changes",{ver:o,changes:t,source:{url:n.get("teamwork"),token:n.get("token")}})):u.remove("changes")},y.prototype.removeChanges=k=function(t){var e;(e=t.$ds_chg.$ds_hist).startBlock();try{a.block(function(){var e,n,o;o=t.__change;for(n in o)e=o[n],"__error"!==n&&"__refreshView"!==n&&t.set(n,t.$ds_doc.get(n))})}finally{e.endBlock()}},b=function(t){return t.length>60?t.substr(0,60)+"...":t},D=function(t){n.get("autosave")&&toastr.success("Task '"+b(t.get("title"))+"' updated","Update task",{timeOut:2e3})},S=function(t,e){n.get("autosave")&&toastr.error("Task '"+b(e.get("title"))+"' update failed. Reason: "+t,"Update task",{positionClass:"toast-top-center",newestOnTop:!0}),k(e)},y.prototype.save=function(t){return function(e){var o,s,i,u,c,l,p,f,h,m,g,y,v,b,T,O,P,$,j,x,L,A,C,M;if(t&&!e)return t.promise;if(e||(t=w.defer(),e=function(){var t,e;t=this.get("tasks"),e=[];for(A in t)L=t[A],e.push(L.addRef(this));return e}.call(this)),h=null,M={"todo-item":C={}},!(L=e.shift())){if((e=function(){var t,e;t=this.get("tasks"),e=[];for(A in t)L=t[A],L.__change.__error||e.push(L.addRef(this));return e}.call(this)).length>0)return void this.save(e);s=!0;for(f in this.get("tasks")){s=!1;break}return t.resolve(s),y=t.promise,t=null,y}i=_.clone(L.__change),C.content=L.get("title"),c=!1;for(b in i)if(v=i[b],"__error"!==b&&"__refreshView"!==b)switch(b){case"title":break;case"comments":break;case"description":i.hasOwnProperty("split")||(C.description=L.get("description"));break;case"split":C.description=d.put(L.get("description"),(P=v.v)?{split:v.v.valueOf()}:null),C["start-date"]=null===P||null===(p=L.get("duedate"))?"":P.firstDate(p).format("YYYYMMDD");break;case"duedate":C["due-date"]=l=v.v?v.v.format("YYYYMMDD"):"",null!==($=L.get("startDate"))&&$>L.get("duedate")&&(C["start-date"]=l);break;case"estimate":C["estimated-minutes"]=v.v?Math.floor(v.v.asMinutes()):"0";break;case"responsible":C["responsible-party-id"]=(h=v.v)?[v.v.get("id")]:[];break;case"tags":C.tags=(x=null!=(T=L.get("tags"))?T.map:void 0)?function(){var t;t=[];for(j in x)t.push(j);return t}().join():"";break;case"plan":u=null===(u=L.get("comments"))?new r:u.clone(),u.unshift(v.v?"Поставлено в план на "+L.get("duedate").format("DD.MM.YYYY"):"Снято с плана.  Причина:"),L.set("comments",u);break;default:console.error("change.save(): Property "+b+" not expected to be changed")}return o=function(e){return function(o,r){var s;r||(n.get("autosave")?(S(o,L),k(L)):(L.__change.__error=o,"function"==typeof(s=L.__change).__refreshView&&s.__refreshView()),e.set("cancel",null)),L.release(e),t.reject(),t=null}}(this),O=function(t){return function(){return t.get("source").httpPut("tasks/"+L.get("id")+".json",M,t.set("cancel",w.defer())).then(function(r){var s,c,l;if(t.set("cancel",null),200===r.status)if(delete i.__error,a.block(function(){for(b in i)v=i[b],"__refreshView"!==b&&L.$ds_doc.set(b,v.v)}),null!==(u=L.get("comments"))){for(l="";c=u.shift();)l+="<p>"+c+"</p>";M={comment:{"content-type":"html",body:l,isprivate:!1}},t.get("source").httpPost("tasks/"+L.get("id")+"/comments.json",M,t.set("cancel",w.defer())).then(function(n){t.set("cancel",null),201===n.status?(L.$ds_chg.$ds_hist.setSameAsServer(L,"comments"),D(L),L.release(t),t.save(e)):o(n,0===n.status)},o)}else D(L),L.release(t),t.save(e);else n.get("autosave")?S(r.data.MESSAGE,L):(L.__change.__error=r.data.MESSAGE,"function"==typeof(s=L.__change).__refreshView&&s.__refreshView()),L.release(t),t.save(e)},o)}}(this),null===h?O():null===(g=(m=L.get("project")).get("people"))?this.get("source").httpGet("projects/"+m.get("id")+"/people.json",this.set("cancel",w.defer())).then(function(t){return function(e){var n,r,s,i;if(t.set("cancel",null),200===e.status){for(m.set("people",g={}),i=e.data.people,n=0,r=i.length;n<r;n++)s=i[n],g[s.id]=!0;t.addPersonToProject(m,h,O,o)}else o(e,0===e.status)}}(this),o):g.hasOwnProperty(h.get("id"))?O():this.addPersonToProject(m,h,O),t.promise}}(null),y.prototype.addPersonToProject=function(t,e,n,o){this.get("source").httpPost("projects/"+t.get("id")+"/people/"+e.get("id")+".json",null,this.set("cancel",w.defer())).then(function(r){return function(s){r.set("cancel",null),200===s.status||409===s.status?(t.get("people")[e.get("id")]=!0,n()):o(s,0===s.status)}}(this),o)},y.end(),y}(s),y.add(new k(y,"dataChanges"))}])},{"../../dscommon/DSChangesBase":76,"../../dscommon/DSDataEditable":78,"../../dscommon/DSDataSource":81,"../../dscommon/DSDigest":82,"../../dscommon/DSSet":89,"../../dscommon/DSTags":90,"../../dscommon/util":92,"../models/Person":36,"../models/Tag":40,"../models/Task":41,"../models/types/Comments":44,"../utils/RMSData":75}],26:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h,m,g,y,v=function(t,e){function n(){this.constructor=t}for(var o in e)w.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},w={}.hasOwnProperty;e.exports=(g=angular.module("data/dsDataService",[t("./PeopleWithJson"),t("./TasksWithTimeTracking"),t("./teamwork/TWPeople"),t("./teamwork/TWProjects"),t("./teamwork/TWTaskLists"),t("./teamwork/TWTasks"),t("./teamwork/TWTags"),t("./teamwork/TWTimeTracking"),t("./PersonDayStatData"),t("./dsChanges"),t("../../dscommon/DSDataSource"),t("../config")])).name,f=t("../../dscommon/util").assert,y=t("../../dscommon/util").serviceOwner,m=t("../../dscommon/util").error,h=t("../../utils/base64"),a=t("../../dscommon/DSObject"),i=t("../../dscommon/DSDataServiceBase"),o=t("../../dscommon/DSChangesBase"),r=t("../../dscommon/DSDataEditable"),s=t("../../dscommon/DSDataFiltered"),u=t("../models/Person"),l=t("../models/Tag"),d=t("../models/Task"),p=t("../models/TaskTimeTracking"),c=t("../models/PersonTimeTracking"),g.run(["dsDataService","$rootScope",function(t,e){e.dataService=t}]),g.factory("dsDataService",["TWPeople","TWTasks","TWProjects","TWTaskLists","TWTags","TWTimeTracking","PeopleWithJson","TasksWithTimeTracking","PersonDayStatData","DSDataSource","dsChanges","config","$http","$rootScope","$q",function(t,e,n,a,l,p,m,g,w,k,S,D,b,T,O){var P;return P=function(y){function P(){return $.apply(this,arguments)}var $;return v(P,y),P.begin("DSDataService"),P.propDoc("dataSource",k),P.propPool("editedPeople",r(u.Editable)),P.propPool("editedTasks",r(d.Editable)),P.propPool("tasksPool",s(d)),P.propPool("personTimeTrackingPool",s(c)),P.propBool("showTimeSpent",{init:!1}),P.propDoc("changes",o),P.propSet("emptyPersonTimeTracking",c),P.ds_dstr.push(function(){this.__unwatch2()}),$=function(){var t;i.apply(this,arguments),this.set("dataSource",new k(this,"dataSource")).release(this),t=null,this.__unwatch2=T.$watch(function(){return[D.get("teamwork"),D.get("token")]},function(e){return function(n){var o,r,s;return r=n[0],s=n[1],r&&s?(t&&(t.resolve(),t=null),o=function(n,o){T.connected=!1,o||(console.error("error: ",n),t=null),e.get("dataSource").setConnection(null,null)},T.connected=null,b.get(r+"authenticate.json",{timeout:(t=O.defer()).promise,headers:{Authorization:"Basic "+h.encode(s)}}).then(function(n){200===n.status?(T.connected=!0,t=null,D.set("currentUserId",n.data.account.userId),e.get("dataSource").setConnection(r,s)):o(n,0===n.status)},o),void 0):(T.connected=!1,e.get("dataSource").setConnection(null,null))}}(this),!0),this.set("changes",S).init(this)},P.prototype.refresh=function(){this.get("dataSource").refresh()},P.prototype.findDataSet=function(o,r){var s,f,h,y,v,k,S,b,T,O,P,$;switch(i.prototype.findDataSet.call(this,o,r),r.type.docType){case"Tag":return"function"==typeof(s=T=l.pool.find(this,{})).init&&s.init(this),(P=T.get("tagsSet")).addRef(o),T.release(this),P;case"PersonDayStat":return"function"==typeof(f=T=w.pool.find(this,r)).init&&f.init(this),(P=T.get("personDayStatsSet")).addRef(o),T.release(this),P;case"TaskTimeTracking":return(T=p.pool.find(this,{})).init&&T.init(this),(P=T.get("taskTimeTrackingSet")).addRef(o),T.release(this),P;case"PersonTimeTracking":return r.hasOwnProperty("showTimeSpent")&&!r.showTimeSpent?(P=this.get("emptyPersonTimeTrackingSet")).addRef(o):r.hasOwnProperty("startDate")?((T=this.get("personTimeTrackingPool").find(this,r)).init&&(T.init(O=this.findDataSet(this,{type:c,mode:r.mode}),p.filterPersonTimeTracking(r)),O.release(this)),(P=T.get("itemsSet")).addRef(o),T.release(this)):((T=p.pool.find(this,{})).init&&T.init(this),(P=T.get("personTimeTrackingSet")).addRef(o),T.release(this)),P}switch(r.mode){case"edited":switch($=r.type.docType){case"Person":return this.findDataSet(o,_.assign({},r,{mode:"original"}));case"Task":return(T=this.get("editedTasks").find(this,r)).init&&(T.init(O=this.findDataSet(this,_.assign({},r,{mode:"original"})),b=this.findDataSet(this,_.assign({},r,{mode:"changes"})),e.filter(r)),O.release(this),b.release(this)),(P=T.get("itemsSet")).addRef(o),T.release(this),P;default:throw new Error("Not supported model type (1): "+$)}break;case"changes":switch($=r.type.docType){case"Task":return(P=this.get("changes").get("tasksSet")).addRef(o);default:throw new Error("Not supported model type (2): "+$)}break;case"original":switch(($=r.type)!==u?$.docType:!D.get("hasRoles")||r.source?u.docType:"PeopleWithJson"){case"PeopleWithJson":return"function"==typeof(h=T=m.pool.find(this,r)).init&&h.init(this),(P=T.get("peopleSet")).addRef(o),T.release(this),P;case"Person":return delete r.source,"function"==typeof(y=T=t.pool.find(this,r)).init&&y.init(this),(P=T.get("peopleSet")).addRef(o),T.release(this),P;case"Project":return delete r.source,"function"==typeof(v=T=n.pool.find(this,r)).init&&v.init(this),(P=T.get("projectsSet")).addRef(o),T.release(this),P;case"TaskList":return delete r.source,"function"==typeof(k=T=a.pool.find(this,r)).init&&k.init(this),(P=T.get("taskListsSet")).addRef(o),T.release(this),P;case"Task":return"all"!==r.filter||r.hasOwnProperty("startDate")?((T=this.get("tasksPool").find(this,r)).init&&(T.init(O=this.findDataSet(this,{type:d,mode:"original",filter:"all"}),e.filter(r)),O.release(this)),(P=T.get("itemsSet")).addRef(o),T.release(this)):(!D.get("hasTimeReports")||r.source?(delete r.source,"function"==typeof(S=T=e.pool.find(this,r)).init&&S.init(this)):(T=g.pool.find(this,{})).init&&T.init(this),(P=T.get("tasksSet")).addRef(o),T.release(this)),P;default:throw new Error("Not supported model type (3): "+$)}}},P.prototype.requestSources=function(t,e,n){var o,r,s,a,u,c,l,d,p;i.prototype.requestSources.call(this,t,e,n);for(r in n){switch(p=n[r],l=_.assign({},p.params,e),u={type:d=p.type,mode:s=l.mode},o=d.docType){case"Tag":case"Person":case"Project":break;case"TaskList":u.project=l.project;break;case"PersonDayStat":u.startDate=l.startDate,u.endDate=l.endDate;break;case"PersonTimeTracking":u.showTimeSpent=l.showTimeSpent,u.startDate=l.startDate,u.endDate=l.endDate;break;case"Task":if("changes"!==s){if(f&&!("string"==typeof l.filter&&0<=["all","assigned","notassigned","overdue","noduedate","clipboard"].indexOf(l.filter)))throw new Error("Unexpected filter: "+l.filter);u.filter=l.filter,"all"!==l.filter&&"assigned"!==l.filter&&"notassigned"!==l.filter||(u.startDate=l.startDate,u.endDate=l.endDate),l.manager&&(u.manager=l.manager)}break;default:throw new Error("Not supported model type (4): "+o)}a=this.findDataSet(t,u),"undefined"==typeof(c=p.set)||c!==a?p.newSet=a:a.release(t)}},P.end(),P}(i),y.add(new P(y,"dataService"))}])},{"../../dscommon/DSChangesBase":76,"../../dscommon/DSDataEditable":78,"../../dscommon/DSDataFiltered":79,"../../dscommon/DSDataServiceBase":80,"../../dscommon/DSDataSource":81,"../../dscommon/DSObject":86,"../../dscommon/util":92,"../../utils/base64":94,"../config":21,"../models/Person":36,"../models/PersonTimeTracking":38,"../models/Tag":40,"../models/Task":41,"../models/TaskTimeTracking":43,"./PeopleWithJson":22,"./PersonDayStatData":23,"./TasksWithTimeTracking":24,"./dsChanges":25,"./teamwork/TWPeople":29,"./teamwork/TWProjects":30,"./teamwork/TWTags":31,"./teamwork/TWTaskLists":32,"./teamwork/TWTasks":33,"./teamwork/TWTimeTracking":34}],27:[function(t,e,n){var o,r,s,i;r=t("../../dscommon/util").assert,i=t("../../dscommon/util").serviceOwner,o=t("../models/Task.coffee"),e.exports=(s=angular.module("data/persistClipboard",[t("./dsDataService.coffee")])).name,s.factory("clipboardTasks",["localStorageService",function(t){var e,n,o,r,s;if(r={},null!==(s=t.get("clipboardTasks")))for(e=0,o=s.length;e<o;e++)n=s[e],r[n]=!0;return r}]),s.run(["dsDataService","localStorageService",function(t,e){var n,r;n=i.add(t.findDataSet(i,{type:o,mode:"original",filter:"clipboard"})),r=i.add(n.watchStatus(i,function(t,o){var s;"ready"===o&&(r(),(s=function(){var t;e.set("clipboardTasks",function(){var e;e=[];for(t in n.items)e.push(t);return e}())})(),i.add(n.watch(i,{add:s,remove:s})))}))}])},{"../../dscommon/util":92,"../models/Task.coffee":41,"./dsDataService.coffee":26}],28:[function(t,e,n){var o,r,s,i,a,u,c=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;e.exports=(u=angular.module("dscommon/DSDataTeamworkPaged",[])).name,i=t("../../../dscommon/util").assert,a=t("../../../dscommon/util").error,o=t("../../../dscommon/DSData"),r=t("../../../dscommon/DSDigest"),s=100,u.factory("DSDataTeamworkPaged",["DSDataSource","$rootScope","$q",function(t,e,n){var a;return a=function(e){function a(){return a.__super__.constructor.apply(this,arguments)}return c(a,e),a.begin("DSDataTeamworkPaged"),a.propDoc("source",t),a.propObj("cancel",{init:null}),a.propEnum("method",["httpGet","httpPost","httpPut"]),a.propStr("request"),a.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve()}),a.prototype.clear=function(){var t;o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},a.prototype.load=function(){var t,e,o,a,u;if(i){if(!this.get("source"))throw new Error("load(): Source is not specified");if(!("string"==typeof(u=this.get("request"))&&u.length>0))throw new Error("load(): Request is not specified")}this._startLoad()&&(e=this.set("cancel",n.defer()),o=function(t){return function(e,n){n||(console.error("error: ",e),t.set("cancel",null)),t._endLoad(!1)}}(this),t=function(t,e){return""+e+(e.indexOf("?")===-1?"?":"&")+"page="+t+"&pageSize="+s},this.startLoad(),(a=function(n){return function(i){var u;return function(){switch(u=this.get("method")){case"httpGet":return this.get("source").httpGet(t(i,this.get("request")),e);case"httpPost":return this.get("source").httpPost(t(i,this.get("request")),this.params.json,e);case"httpPut":return this.get("source").httpPut(t(i,this.get("request")),this.params.json,e)}}.call(n).then(function(t){var e;if(200===t.status){if(n.set("cancel",null),n.importResponse(t.data,t.status)===s)return void a(i+1);e=r.block(function(){return n.finalizeLoad()}),"object"==typeof e&&null!==e&&"then"in e?e.then(function(){n._endLoad(!0)}):n._endLoad(!0)}else o(t,0===t.status)},o)}}(this))(1))},a.end(),a}(o)}])},{"../../../dscommon/DSData":77,"../../../dscommon/DSDigest":82,"../../../dscommon/util":92}],29:[function(t,e,n){var o,r,s,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;e.exports=(i=angular.module("data/teamwork/TWPeople",[t("../../../dscommon/DSDataSource"),t("./DSDataTeamworkPaged")])).name,r=t("../../../dscommon/util").assert,s=t("../../../dscommon/util").error,o=t("../../models/Person"),i.factory("TWPeople",["DSDataTeamworkPaged","DSDataSource","$rootScope","$q",function(t,e,n,r){var s;return s=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return a(n,t),n.begin("TWPeople"),n.addPool(),n.propSet("people",o),n.ds_dstr.push(function(){this.__unwatch2()}),n.prototype.init=function(t){this.set("request","people.json"),this.__unwatch2=e.setLoadAndRefresh.call(this,t),this.init=null},n.prototype.startLoad=function(){return this.peopleMap={}},n.prototype.importResponse=function(t){var e,n,r,s,i,a;for(e=0,a=t.people,n=0,s=a.length;n<s;n++)r=a[n],++e,i=o.pool.find(this,""+r.id,this.peopleMap),i.set("id",+r.id),i.set("name",(r["last-name"]+" "+r["first-name"].charAt(0).toUpperCase()+".").trim()),i.set("firstName",r["first-name"].trim()),i.set("avatar",r["avatar-url"]),i.set("email",r["email-address"]),i.set("companyId",+r["company-id"]),i.set("currentUser",!1);return e},n.prototype.finalizeLoad=function(){this.get("peopleSet").merge(this,this.peopleMap),delete this.peopleMap},n.end(),n}(t)}])},{"../../../dscommon/DSDataSource":81,"../../../dscommon/util":92,"../../models/Person":36,"./DSDataTeamworkPaged":28}],30:[function(t,e,n){var o,r,s,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;e.exports=(i=angular.module("data/teamwork/TWProjects",[t("../../../dscommon/DSDataSource"),t("./DSDataTeamworkPaged")])).name,r=t("../../../dscommon/util").assert,s=t("../../../dscommon/util").error,o=t("../../models/Project"),i.factory("TWProjects",["DSDataTeamworkPaged","DSDataSource","$rootScope","$q",function(t,e,n,r){var s;return s=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return a(n,t),n.begin("TWProjects"),n.addPool(),n.propSet("projects",o),n.ds_dstr.push(function(){this.__unwatch2()}),n.prototype.init=function(t){this.set("request","projects.json?status=ACTIVE"),this.__unwatch2=e.setLoadAndRefresh.call(this,t),this.init=null},n.prototype.startLoad=function(){return this.projectsMap={}},n.prototype.importResponse=function(t){var e,n,r,s,i,a;for(e=0,a=t.projects,n=0,s=a.length;n<s;n++)r=a[n],++e,i=o.pool.find(this,""+r.id,this.projectsMap),i.set("id",parseInt(r.id)),i.set("name",r.name);return e},n.prototype.finalizeLoad=function(){this.get("projectsSet").merge(this,this.projectsMap),delete this.projectsMap},n.end(),n}(t)}])},{"../../../dscommon/DSDataSource":81,"../../../dscommon/util":92,"../../models/Project":39,"./DSDataTeamworkPaged":28}],31:[function(t,e,n){var o,r,s,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;e.exports=(i=angular.module("data/teamwork/TWTags",[t("../../../dscommon/DSDataSource"),t("./DSDataTeamworkPaged")])).name,r=t("../../../dscommon/util").assert,s=t("../../../dscommon/util").error,o=t("../../models/Tag"),i.factory("TWTags",["DSDataTeamworkPaged","DSDataSource","$rootScope","$http","$q",function(t,e,n,r,s){var i;return i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return a(n,t),n.begin("TWTags"),n.addPool(),n.propObj("cancel",{init:null}),n.propSet("tags",o),n.ds_dstr.push(function(){this.__unwatch()}),n.prototype.init=function(t){this.set("request","tags.json"),this.__unwatch=e.setLoadAndRefresh.call(this,t),this.init=null},n.prototype.startLoad=function(){var t;this.tagsMap={},t=function(t){return function(e,n){return n||t.set("cancel",null),[]}}(this),this.tagsJson=r.get("data/tags.json?t="+(new Date).getTime(),{timeout:this.set("cancel",s.defer()),transformResponse:function(t,e,n){if(200===n)return JSONLint.parse(t)}}).then(function(e){return function(n){var o,r,s,i,a,u;if(200!==n.status)return t(n,0===n.status);if(e.set("cancel",null),u=n.data,!Array.isArray(u))return console.error("invalid tags.json"),[];for(o=!1,r=s=0,i=u.length;s<i;r=++s)a=u[r],"string"==typeof a.name&&a.name.length>=0||(o=!0,console.error("invalid tags.json: invalid 'name'",a)),a.hasOwnProperty("priority")?"number"!=typeof a.priority&&(o=!0,console.error("invalid tags.json: invalid 'priority'",a)):a.priority=r,!a.hasOwnProperty("color")||"string"==typeof a.color&&a.color.length>=0||(o=!0,console.error("invalid tags.json: invalid 'color'",a)),!a.hasOwnProperty("border")||"string"==typeof a.border&&a.border.length>=0||(o=!0,console.error("invalid tags.json: invalid 'border'",a));return o?[]:u}}(this),t)},n.prototype.importResponse=function(t){var e,n,r,s,i,a,u,c;for(e=0,i=t.tags,n=0,s=i.length;n<s;n++)r=i[n],++e,c=o.pool.find(this,u=r.name,this.tagsMap),c.set("id",parseInt(r.id)),c.set("name",u),c.set("twColor",a=r.color);return 1},n.prototype.finalizeLoad=function(){return this.tagsJson.then(function(t){return function(e){var n,o,r,s;for(t.tagsJson=null,n=0,o=e.length;n<o;n++)r=e[n],t.tagsMap.hasOwnProperty(r.name)&&(s=t.tagsMap[r.name],s.set("name",r.name),r.hasOwnProperty("priority")&&s.set("priority",r.priority),r.color&&s.set("color",r.color),r.border&&s.set("border",r.border));t.get("tagsSet").merge(t,t.tagsMap),delete t.tagsMap}}(this))},n.end(),n}(t)}])},{"../../../dscommon/DSDataSource":81,"../../../dscommon/util":92,"../../models/Tag":40,"./DSDataTeamworkPaged":28}],32:[function(t,e,n){var o,r,s,i,a,u,c=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;e.exports=(a=angular.module("data/teamwork/TWTaskLists",[t("../../../dscommon/DSDataSource"),t("./DSDataTeamworkPaged")])).name,s=t("../../../dscommon/util").assert,i=t("../../../dscommon/util").error,o=t("../../models/Project"),r=t("../../models/TaskList"),u=t("../../../dscommon/util").serviceOwner,a.factory("TWTaskLists",["DSDataTeamworkPaged","DSDataSource","$rootScope","$q",function(t,e,n,s){var i;return i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return c(n,t),n.begin("TWTaskLists"),n.addPool(),n.propSet("taskLists",r),n.propDoc("project",o),n.ds_dstr.push(function(){this.__unwatch2()}),n.prototype.init=function(t){var n;this.get("params").hasOwnProperty("project")&&(this.set("project",n=this.get("params").project),this.set("request","projects/"+this.project.get("id")+"/tasklists.json")),this.__unwatch2=e.setLoadAndRefresh.call(this,t),this.init=null},n.prototype.startLoad=function(){return this.taskListsMap={}},n.prototype.importResponse=function(t){var e,n,o,s,i,a,u;for(e=0,i=this.get("project"),a=t.tasklists,n=0,s=a.length;n<s;n++)o=a[n],++e,u=r.pool.find(this,""+o.id,this.taskListsMap),u.set("id",parseInt(o.id)),u.set("name",o.name),u.set("project",i),u.set("position",o.position);return e},n.prototype.finalizeLoad=function(){this.get("taskListsSet").merge(this,this.taskListsMap),delete this.taskListsMap},n.loadTaskListsAndProjects=function(t,e){var n,i;return n=s.defer(),e.hasOwnProperty("TaskList")?(i=function(){var a,c,l,d,p,f,h,m,g,y;m=e.TaskList;for(y in m)return d=m[y],p=function(t,o){o?n.resolve():(console.error("error: ",t),delete e.TaskList[y],i())},void t.httpGet("/tasklists/"+y+".json",s.defer()).then(function(t){var n,s,a,c,l,f;if(200===t.status){for(a=t.data["todo-list"],l=o.pool.find(u,a.projectId),l.set("id",parseInt(a.projectId)),l.set("name",a.projectName),f=r.pool.find(u,y),f.set("id",parseInt(a.id)),f.set("name",a.name),f.set("project",l),f.set("position",a.position),s=0,c=d.length;s<c;s++)(n=d[s])(f);l.release(u),f.release(u),delete e.TaskList[y],i()}else p(t,0===t.status)},p);g=e.Project;for(h in g){for(d=g[h],f=o.pool.find(u,h),c=0,l=d.length;c<l;c++)(a=d[c])(f);f.release(u)}n.resolve()})():n.resolve(),n.promise},n.end(),n}(t)}])},{"../../../dscommon/DSDataSource":81,"../../../dscommon/util":92,"../../models/Project":39,"../../models/TaskList":42,"./DSDataTeamworkPaged":28}],33:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h,m,g,y,v,_=function(t,e){function n(){this.constructor=t}for(var o in e)w.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},w={}.hasOwnProperty;e.exports=(y=angular.module("data/teamwork/TWTasks",[t("../../../dscommon/DSDataSource"),t("./TWTags")])).name,m=t("../../../dscommon/util").assert,g=t("../../../dscommon/util").error,v=t("../../ui/time"),d=t("../../models/Task"),l=t("../../models/Tag"),i=t("../../models/Person"),p=t("../../models/TaskList"),u=t("../../models/Project"),h=t("../../models/TaskTimeTracking"),a=t("../../models/PersonTimeTracking"),o=t("../../../dscommon/DSData"),r=t("../../../dscommon/DSDigest"),s=t("../../../dscommon/DSTags"),f=t("../../models/types/TaskSplit"),c=t("../../utils/RMSData"),y.factory("TWTasks",["TWTags","DSDataSource","dsChanges","config","$injector","$http","$q",function(t,e,n,g,y,w,k){var S;return S=function(t){function w(){return D.apply(this,arguments)}var S,D,b,T,O,P;return _(w,t),d.TWTask=w,d.planTag=g.planTag,w.begin("TWTasks"),w.addPool(),w.propDoc("source",e),w.propStr("request"),w.propSet("tasks",d),w.propPool("completedTasksPool",d),w.propObj("cancel",{init:null}),w.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),this.__unwatch1(),this.__unwatch2()}),S=w,w.prototype.clear=function(){var t;o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},w.propObj("visiblePersonTTracking",{init:{}}),D=function(){var t,e,n,r;o.apply(this,arguments),this.peopleMap={},this.projectMap={},this.taskListMap={},m&&a.prototype.hasOwnProperty("setVisible")&&console.error("TWTasks:ctor: setVisible expects that their will be only one instance of TWTasks object"),r=this.get("visiblePersonTTracking"),t=this.get("completedTasksPool"),n=this.get("tasksSet"),e=this,a.prototype.setVisible=function(o){var s,i;o?1===(this.__visCount=(this.__visCount||0)+1)&&(r[this.$ds_key]=this,null===(s=this.get("task"))&&((s=n.items[i=this.get("taskId")])?this.set("task",s):(this.set("task",s=t.find(this,""+i)),null===s.get("timeTracking")&&(s.set("id",i),s.set("timeTracking",h.pool.find(this,s.$ds_key)),O.call(e)),s.release(this))),s.setVisible(!0)):0===--this.__visCount&&(delete r[this.$ds_key],this.get("task").setVisible(!1))}},T=function(t,e){var n,o,r;return null!==(n=e.get("duedate"))&&(null===(r=e.get("split"))?t.startDate<=(o=e.get("duedate"))&&o<=t.endDate:t.startDate<=r.lastDate(n=e.get("duedate"))&&r.firstDate(n)<=t.endDate)},w.filter=function(t){var e,n;switch(n=[],t.filter){case"all":moment.isMoment(t.startDate)?n.push(function(e){return T(t,e)}):n.push(function(t){return!0});break;case"assigned":n.push(function(e){return null!==e.get("responsible")&&T(t,e)});break;case"notassigned":n.push(function(e){return null===e.get("responsible")&&T(t,e)});break;case"overdue":n.push(function(t){var e;return null!==(e=t.get("duedate"))&&e<v.today});break;case"noduedate":n.push(function(t){return null===t.get("duedate")});break;case"clipboard":n.push(function(t){return t.get("clipboard")});break;default:throw new Error("Not supported filter: "+t.filter)}return t.manager&&(e=i.pool.items[t.manager].projects)&&n.push(function(t){return e.hasOwnProperty(t.get("project").get("id"))}),1===n.length?n[0]:function(t){var e,o,r;for(e=0,o=n.length;e<o;e++)if(r=n[e],!r(t))return!1;return!0}},w.prototype.init=function(t){var e,n,o,s;this.set("source",t.get("dataSource")),this.set("request",function(){switch((n=this.get("params")).filter){case"all":return moment.isMoment(n.startDate)?"tasks.json?startdate="+n.startDate.format("YYYYMMDD")+"&enddate="+n.endDate.format("YYYYMMDD")+"&getSubTasks=no":"tasks.json?getSubTasks=no";case"assigned":return"tasks.json?startdate="+n.startDate.format("YYYYMMDD")+"&enddate="+n.endDate.format("YYYYMMDD")+"&responsible-party-ids=-1&getSubTasks=no";
case"notassigned":return"tasks.json?startdate="+n.startDate.format("YYYYMMDD")+"&enddate="+n.endDate.format("YYYYMMDD")+"&responsible-party-ids=0&getSubTasks=no";case"overdue":return"tasks.json?filter=overdue&getSubTasks=no";case"noduedate":return"tasks.json?filter=nodate&include=noduedate&getSubTasks=no";default:throw new Error("Unexpected filter: "+n.filter)}}.call(this)),e=w.filter(this.params),s=this.get("tasksSet"),this.__unwatch1=d.pool.watch(this,function(t){return function(n){e(n)?s.items.hasOwnProperty(n.$ds_key)||s.add(t,n.addRef(t)):s.items.hasOwnProperty(n.$ds_key)&&s.remove(n)}}(this)),o=t.findDataSet(this,{type:l,mode:"original"}),this.__unwatch2=o.watchStatus(this,function(t){return function(e,n){switch(n){case"ready":r.block(function(){return t.load()});break;case"nodata":t.set("status","nodata")}}}(this)),o.release(this),this.init=null},P=function(){var t,e,n,o,r;e=this.peopleMap;for(t in e)r=e[t],r.release(this),delete this.peopleMap[t];n=this.taskListMap;for(t in n)r=n[t],r.release(this),delete this.taskListMap[t];o=this.projectMap;for(t in o)r=o[t],r.release(this),delete this.projectMap[t]},b=function(t,e){var n,o,r,a,d,h,m,g,y,v,_,w,k,S,D,b,T,O,P;if(y=i.pool.find(this,""+e["creator-id"],this.peopleMap),v=u.pool.find(this,""+e["project-id"],this.projectMap),T=p.pool.find(this,""+e["todo-list-id"],this.taskListMap),T.set("project",v),t.set("creator",y),t.set("project",v),t.set("taskList",T),t.set("title",e.content),t.set("estimate",(d=e["estimated-minutes"])?moment.duration(d,"minutes"):null),t.set("progress",e.progress),t.set("duedate",(a=e["due-date"])?moment(a,"YYYYMMDD"):null),t.set("startDate",(o=e["start-date"])?moment(o,"YYYYMMDD"):null),t.set("completed",e.completed),t.set("isReady",!0),(O=e.timeIsLogged)&&t.set("firstTimeEntryId",O),r=e.description,n=c.get(r),null!==n&&(r=c.clear(r),n.hasOwnProperty("split")&&null!==a&&t.set("split",k=new f(n.split))),t.set("description",r),e["responsible-party-ids"]&&t.set("responsible",(w=e["responsible-party-ids"].split(",")).length>0?i.pool.find(this,""+w[0],this.peopleMap):null),y.set("id",parseInt(e["creator-id"])),e.hasOwnProperty("tags")){for(b=null,_=e.tags,h=0,g=_.length;h<g;h++)S=_[h],D=(null!=b?b:b={})[S.name]=l.pool.find(this,S.name),D.set("id",S.id),D.set("name",S.name),(b||(b={}))[S.name]=D;if(null===b)t.set("tags",null);else{t.set("tags",new s(this,b)).release(this);for(m in b)P=b[m],P.release(this)}}else t.set("tags",null),t.set("plan",!1);T.set("id",parseInt(e["todo-list-id"])),T.set("name",e["todo-list-name"]),v.set("id",parseInt(e["project-id"])),v.set("name",e["project-name"])},w.prototype.load=function(){var t,e,o,s,i,a,u;if(m&&!this.get("source"))throw new Error("load(): Source is not specified");this._startLoad()&&(o=null,y.invoke(["clipboardTasks",function(t){o=t}]),u={},s=function(t){return function(e){var n,r,s,i,a,c,l;d.pool.enableWatch(!1);try{for(i=l=e["todo-items"],n=0,s=i.length;n<s;n++)r=i[n],a=d.pool.find(t,c=""+r.id,u),a.set("id",parseInt(r.id)),b.call(t,a,r),o.hasOwnProperty(c)&&(a.clipboard=!0)}finally{d.pool.enableWatch(!0)}return 250===l.length}}(this),i=function(t){return function(e,n){var o,r;n||(console.error("error: ",e),t.set("cancel",null));for(o in u)r=u[o],r.release(t);P.call(t),t._endLoad(!1)}}(this),(t=this.get("cancel"))&&t.resolve(),(a=function(t){this.get("source").httpGet(this.get("request")+"&page="+t+"&pageSize=250",this.set("cancel",k.defer())).then(function(n){return function(o){200===o.status?(n.set("cancel",null),r.block(function(){return s(o.data,o.status)})?a.call(n,t+1):(r.block(function(){e.call(n),n.get("tasksSet").merge(n,u),P.call(n)}),n._endLoad(!0),O.call(n))):i(o,0===o.status)}}(this),i)}).call(this,1),e=function(){var t,e,o;t=n.tasks;for(o in t)e=t[o],u.hasOwnProperty(o)||e._clearChanges()})},O=function(){var t,e,n,o,s,i;if(null===this.get("cancel")){s=null,n=this.get("visiblePersonTTracking");for(t in n)if(i=n[t],!(o=i.get("task")).get("isReady")){s=o;break}null!==s&&(e=function(t){return function(e,n){n||(console.error("error: ",e),t.set("cancel",null)),s.release(t),P.call(t)}}(this),this.get("source").httpGet("/tasks/"+s.id+".json",this.set("cancel",k.defer())).then(function(t){return function(n){200===n.status?(t.set("cancel",null),r.block(function(){b.call(t,s,n.data["todo-item"]),P.call(t),O.call(t)})):e(n,0===n.status)}}(this),e))}},w.tasksSortRule=function(t,e){var n,o,r,s,i,a;return(o=t.get("priority"))!==(a=e.get("priority"))?o-a:(n=null!=(r=t.get("estimate"))?r.valueOf():void 0)!==(i=null!=(s=e.get("estimate"))?s.valueOf():void 0)?void 0===n?1:void 0===i?-1:i-n:t.get("id")-e.get("id")},w.end(),w}(o)}])},{"../../../dscommon/DSData":77,"../../../dscommon/DSDataSource":81,"../../../dscommon/DSDigest":82,"../../../dscommon/DSTags":90,"../../../dscommon/util":92,"../../models/Person":36,"../../models/PersonTimeTracking":38,"../../models/Project":39,"../../models/Tag":40,"../../models/Task":41,"../../models/TaskList":42,"../../models/TaskTimeTracking":43,"../../models/types/TaskSplit":45,"../../ui/time":60,"../../utils/RMSData":75,"./TWTags":31}],34:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h,m,g=function(t,e){function n(){this.constructor=t}for(var o in e)y.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},y={}.hasOwnProperty;e.exports=(h=angular.module("data/teamwork/TWTimeTracking",[t("../../config"),t("../../../dscommon/DSDataSource"),t("../../db")])).name,p=t("../../../dscommon/util").assert,f=t("../../../dscommon/util").error,m=t("../../ui/time"),u=t("../../models/Task"),l=t("../../models/TaskTimeTracking"),i=t("../../models/PersonTimeTracking"),o=t("../../../dscommon/DSData"),r=t("../../../dscommon/DSDigest"),c=t("../../models/types/TaskSplit"),a=t("../../utils/RMSData"),d=500,s=50,h.factory("TWTimeTracking",["DSDataSource","$q","db","config",function(t,e,n,a){var u;return u=function(n){function u(){return c.apply(this,arguments)}var c;return g(u,n),u.begin("TWTimeTracking"),u.addPool(),u.propDoc("source",t),u.propSet("taskTimeTracking",l),u.propSet("personTimeTracking",i),u.propObj("cancel",null),u.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this.__unwatchA&&this.__unwatchA(),"function"==typeof this.__unwatchB&&this.__unwatchB()}),u.propObj("visibleTTracking",{init:{}}),c=function(){var t;o.apply(this,arguments),p&&l.prototype.hasOwnProperty("setVisible")&&console.error("TWTimeTracking:ctor: setVisible expects that their will be only one instance of TWTimeTracking object"),t=this.get("visibleTTracking"),l.prototype.setVisible=function(e){e?1!==(this.__visCount=(this.__visCount||0)+1)||this.get("isReady")||(t[this.$ds_key]=this):0===--this.__visCount&&delete t[this.$ds_key]}},u.prototype.clear=function(){var t;o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve(),"function"==typeof this.__unwatchB&&this.__unwatchB()},u.filterPersonTimeTracking=function(t){return function(e){var n;return t.startDate<=(n=moment(e.get("date").startOf("day")))&&n<=t.endDate}},u.prototype.init=function(e){this.__unwatchA=t.setLoadAndRefresh.call(this,e),this.init=null},u.prototype.load=function(){var t,n,o,u,c,f,h,g,y,v,_,w,k,S,D,b;if(p&&!this.get("source"))throw new Error("load(): Source is not specified");if(this._startLoad()){"function"==typeof this.__unwatchB&&this.__unwatchB(),i.pool.enableWatch(!1),l.pool.enableWatch(!1),_=l.pool.items;for(k in _)D=_[k],D.set("isReady",!1),D.set("totalMin",0),D.set("priorTodayMin",0),D.set("timeEntries",{});w=i.pool.items;for(y in w)D=w[y],D.set("timeMin",0);v={},S={},c=function(t){return function(e){var n,o,r,s,a,u,c,p,f,h,g,y;for(o=0,s=e.length;o<s;o++)r=e[o],moment(r.date)>=m.historyLimit&&(f=parseInt(h=r["todo-item-id"]))&&(y=r.id,u=parseInt(c=r["person-id"]),a=60*parseInt(r.hours)+parseInt(r.minutes),n=moment(r.date).startOf("day"),p=i.pool.find(t,c+"-"+f+"-"+n.valueOf(),v),p.set("personId",u),p.set("date",n),p.set("taskId",f),p.set("timeMin",p.get("timeMin")+a),S.hasOwnProperty(h)?g=S[h]:(g=l.pool.find(t,h,S),g.set("taskId",f)),g.set("totalMin",g.get("totalMin")+a),g.get("timeEntries")[y]=!0,n<m.today&&g.set("priorTodayMin",g.get("priorTodayMin")+a));return e.length===d}}(this),n=function(t){return function(){r.block(function(){var e,n;e=l.pool.items;for(k in e)n=e[k],n.set("isReady",!0);t.__unwatchB||(t.__unwatchB=l.pool.watch(t,function(t){t.set("isReady",!0)})),i.pool.enableWatch(!0),t.get("personTimeTrackingSet").merge(t,v),l.pool.enableWatch(!0),t.get("taskTimeTrackingSet").merge(t,S)}),t._endLoad(!0)}}(this),f=function(t){return function(e,n){var o,r;n||(console.error("error: ",e),t.set("cancel",null));for(o in S)r=S[o],r.release(t);t._endLoad(!1)}}(this),g={},h=function(t){return function(o){g.hasOwnProperty(o)?r.block(function(){return c(g[o])})?h(o+1):n():t.get("source").httpGet("time_entries.json?page="+o+"&pageSize="+d,t.set("cancel",e.defer())).then(function(e){var s;200===e.status?(t.set("cancel",null),(s=e.data["time-entries"])&&0!==s.length?moment(s[s.length-1].date)<m.historyLimit?(a.set("histStart",o+1),s.length===d?h(o+1):n()):r.block(function(){return c(s)})?h(o+1):n():n()):f(e,0===e.status)},f)}}(this),b=1,t=s,(u=a.get("histStart"))>=0?h(u):(o=function(i){return function(u){i.get("source").httpGet("time_entries.json?page="+u+"&pageSize="+d,i.set("cancel",e.defer())).then(function(e){var l,d;200===e.status?(i.set("cancel",null),(l=e.data["time-entries"])&&0!==l.length?moment(l[0].date)>=m.historyLimit?b===u?(a.set("histStart",u),r.block(function(){return c(l)})?h(u+1):n()):(g[u]=l,o(b+Math.floor(((t=u)-b)/2))):moment(l[l.length-1].date)<m.historyLimit?t===u?(d=[t,t+s],b=d[0],t=d[1],o(t)):t===u+1?n():(b=u+1,o(b+Math.floor((t-b)/2))):(a.set("histStart",u),r.block(function(){return c(l)})?h(u+1):n()):o(b+Math.floor(((t=u)-b)/2))):f(e,0===e.status)},f)}}(this))(t)}},u.end(),u}(o)}])},{"../../../dscommon/DSData":77,"../../../dscommon/DSDataSource":81,"../../../dscommon/DSDigest":82,"../../../dscommon/util":92,"../../config":21,"../../db":35,"../../models/PersonTimeTracking":38,"../../models/Task":41,"../../models/TaskTimeTracking":43,"../../models/types/TaskSplit":45,"../../ui/time":60,"../../utils/RMSData":75}],35:[function(t,e,n){var o,r,s,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;r=t("../dscommon/util").assert,i=t("../dscommon/util").serviceOwner,o=t("../dscommon/DSObject"),e.exports=(s=angular.module("db",[])).name,s.factory("db",["$q",function(t){var e,n;return n=null,e=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return a(o,e),o.begin("DB"),o.propConst("name","RMS"),o.propConst("ver",4),o.prototype.logQuota=function(){},o.prototype.openDB=function(){var e;return window.indexedDB?(n||(n=t.defer(),e=window.indexedDB.open(this.get("name"),this.get("ver")),e.onsuccess=function(t){console.info("IndexedDB.openDB: Success"),n.resolve(t.target.result)},e.onerror=function(t){console.warn("IndexedDB.openDB: Error",t),n.reject()},e.onupgradeneeded=function(t){var e,o;console.info("IndexedDB.openDB: Upgrade",t),e=t.target.result;try{e.deleteObjectStore("timetracking")}catch(r){o=r}e.createObjectStore("timetracking",{keyPath:"page"}),n.resolve(e)}),n.promise):(console.warn("IndexedDB.openDB: Missing window.indexedDB, so there will be no local time tracking info"),void n.reject())},o.end(),o}(o),i.add(new e(i,"db"))}])},{"../dscommon/DSObject":86,"../dscommon/util":92}],36:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,o=t("../../dscommon/DSDocument"),r=t("../../dscommon/DSTags"),e.exports=s=function(t){function e(){return n.apply(this,arguments)}var n;return u(e,t),e.begin("Person"),r.addPropType(e),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",{init:0}),e.propStr("name"),e.propStr("firstName"),e.propStr("avatar"),e.propStr("email"),e.propDSTags("roles"),e.propNum("companyId"),e.propBool("currentUser"),e.propBool("missing"),e.propDuration("contractTime"),n=function(t,e){o.call(this,t,e),this.set("contractTime",moment.duration(8,"hours"))},e.end(),e}(o)},{"../../dscommon/DSDocument":83,"../../dscommon/DSTags":90,"../../dscommon/util":92}],37:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,o=t("../../dscommon/DSObject"),r=t("./Person"),e.exports=s=function(t){function e(){return s.apply(this,arguments)}var n,s;return u(e,t),e.begin("PersonDayStat"),e.DayStat=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("DayStat"),e.propMoment("day"),e.propNum("tasksCount"),e.propDuration("contract"),e.propDuration("tasksTotal"),e.propDuration("timeLeft"),e.propDuration("timeSpent"),e.end(),e}(o),s=function(t,e,s,u){var c,l,d,p,f;if(o.call(this,t,e),i)for(s instanceof r||a.invalidArg("person"),Array.isArray(u)||a.invalidArg("days"),d=0,f=u.length;d<f;d++)c=u[d],moment.isMoment(c)||a.invalidArg("days");this.set("person",s),p=0,this.get("dayStatsList").merge(this,function(){var t,e,o;for(o=[],t=0,e=u.length;t<e;t++)c=u[t],o.push(((l=new n(this,""+p++)).set("day",c),l));return o}.call(this))},e.propDoc("person",r),e.propList("dayStats",n),e.propDuration("totalPeriodTime"),e.end(),e}(o)},{"../../dscommon/DSObject":86,"../../dscommon/util":92,"./Person":36}],38:[function(t,e,n){var o,r,s,i=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=t("../../dscommon/DSObject"),s=t("../models/Task"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.begin("PersonTimeTracking"),e.addPool(!0),e.propNum("personId",{init:0}),e.propMoment("date"),e.propNum("taskId",{init:0}),e.propDoc("task",s),e.propNum("timeMin",{init:0}),e.end(),e}(o)},{"../../dscommon/DSObject":86,"../models/Task":41}],39:[function(t,e,n){var o,r,s,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;s=t("../../dscommon/util").assert,i=t("../../dscommon/util").error,o=t("../../dscommon/DSObject"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.begin("Project"),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",{init:0}),e.propStr("name"),e.propStr("status"),e.propObj("people"),e.end(),e}(o)},{"../../dscommon/DSObject":86,"../../dscommon/util":92}],40:[function(t,e,n){var o,r,s,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;s=t("../../dscommon/util").assert,i=t("../../dscommon/util").error,o=t("../../dscommon/DSDocument"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.begin("Tag"),e.addPool(),e.propNum("id",{init:0}),e.propStr("name"),e.propStr("color"),e.propStr("twColor"),e.propStr("border"),e.propNum("priority",{init:1e3}),e.end(),e}(o)},{"../../dscommon/DSDocument":83,"../../dscommon/util":92}],41:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h,m,g=function(t,e){function n(){this.constructor=t}for(var o in e)y.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},y={}.hasOwnProperty;f=t("../../dscommon/util").assert,h=t("../../dscommon/util").error,m=t("../ui/time"),r=t("../../dscommon/DSDocument"),a=t("./Project"),i=t("./Person"),l=t("./TaskList"),p=t("./TaskTimeTracking"),u=t("./Tag"),s=t("../../dscommon/DSTags"),o=t("./types/Comments"),d=t("./types/TaskSplit"),e.exports=c=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}var n,r,c,f,h;return g(e,t),e.begin("Task"),o.addPropType(e),d.addPropType(e),s.addPropType(e),e.defaultTag=n={name:"[default]",priority:1e3},e.addPool(!0),h=function(t,o){var r,s,i,a,u,c;if(t.set("plan",!(!o||!o.get(e.planTag))),null!==o){u=1e6,c=null,r=o.map;for(i in r)s=r[i],(a=s.get("priority"))<u&&(c=s,u=a);t.__setCalcPriority(c.priority),t.__setCalcStyle(c)}else t.__setCalcPriority(n.priority),t.__setCalcStyle(n)},c={__onChange:function(t,n,o,r){var i,a,c;switch(n){case"plan":c=t.get("tags"),c?(c=c.clone(this),o?c.get(e.planTag)||(c.set(e.planTag,a=u.pool.find(this,e.planTag)),a.release(this),t.set("tags",c)):c.get(e.planTag)&&(c.set(e.planTag,!1),t.set("tags",c.empty()?null:c)),c.release(this)):o&&((i={})[e.planTag]=a=u.pool.find(this,e.planTag),c=new s(this,i),t.set("tags",c),c.release(this));break;case"tags":h(t,o)}}},f={__onChange:function(t,e,n,o){"tags"===e&&h(t,n)}},e.ds_ctor.push(function(){this.__proto__.constructor.ds_editable?this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(c):this.$ds_evt=[c]:this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(f):this.$ds_evt=[f]}),e.str=function(t){return null===t?"":t.get("title")},e.propNum("id",{init:0}),e.propNum("progress",{init:0}),e.propDoc("project",a),e.propDoc("taskList",l),e.propStr("title"),e.propDuration("estimate").str=function(t){var e,n,o;return e=Math.floor(t.asHours()),n=t.minutes(),o=e?e+"h":"",n&&(o+=" "+n+"m"),o||(o="0"),o},e.prop({name:"remaining",type:"calc",func:function(){var t;return null===(t=this.get("estimate"))?null:moment.duration(t.valueOf()*(100-this.get("progress"))/100)}}),e.propMoment("duedate").str=function(t){return null===t?"":t.format("DD.MM.YYYY")},e.propMoment("startDate").str=function(t){return null===t?"":t.format("DD.MM.YYYY")},e.propDoc("creator",i),e.propDoc("responsible",i),e.propTaskRelativeSplit("split"),e.propDSTags("tags"),e.propBool("completed"),e.propBool("plan",{write:null,read:null}),e.propStr("description",{str:function(t){return t&&0!==t.length?t.length<=20?t:t.substr(0,20)+"...":""}}),e.propEnum("status",["new","","deleted"],{init:"",common:!0}),e.propComments("comments"),e.propDoc("timeTracking",p,{write:null}),e.propStr("firstTimeEntryId",{write:null}),e.propBool("isReady",{write:null}),e.propNum("priority",{init:n.priority,calc:!0}),e.propObj("style",{init:function(){return n},calc:!0}),e.propBool("clipboard",{init:!1,common:!0}),e.prototype.isOverdue=function(){var t;return null!==(t=this.get("duedate"))&&t<m.today},e.prototype.timeWithinEstimate=function(){var t;return null===(t=this.get("estimate"))?0:Math.min(100,Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))},e.prototype.timeAboveEstimate=function(){var t,e;return null===(t=this.get("estimate"))?0:(e=Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))<=100?0:e>200?100:e-100},e.prototype.timeReported=function(){var t,e;return null===(t=this.get("estimate"))?"":(e=Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))>200?e+" %":""},e.prototype.grade=function(){var t;return null===(t=this.get("estimate"))?"":t.asMinutes()<60?"easy":t.asMinutes()>=60&&t.asMinutes()<240?"medium":t.asMinutes()>=240&&t.asMinutes()<480?"hard":t.asMinutes()>=480?"complex":void 0},e.prototype.setVisible=function(t){var e,n;t?1===(this.__visCount=(this.__visCount||0)+1)&&null!=(e=this.get("timeTracking"))&&e.setVisible(!0):0===--this.__visCount&&null!=(n=this.get("timeTracking"))&&n.setVisible(!1)},e.end(),r=e.Editable.prototype.init,e.Editable.prototype.init=function(){r.apply(this,arguments),h(this,this.get("tags"))},e}(r)},{"../../dscommon/DSDocument":83,"../../dscommon/DSTags":90,"../../dscommon/util":92,"../ui/time":60,"./Person":36,"./Project":39,"./Tag":40,"./TaskList":42,"./TaskTimeTracking":43,"./types/Comments":44,"./types/TaskSplit":45}],42:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,o=t("../../dscommon/DSObject"),r=t("./Project"),e.exports=s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("TaskList"),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",{init:0}),e.propStr("name"),e.propDoc("project",r),e.propNum("position"),e.end(),e}(o)},{"../../dscommon/DSObject":86,"../../dscommon/util":92,"./Project":39}],43:[function(t,e,n){var o,r,s=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;o=t("../../dscommon/DSObject"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.begin("TaskTimeTracking"),e.addPool(!0),e.propNum("taskId",{init:0}),e.propBool("isReady"),e.propNum("totalMin",{init:0}),e.propNum("priorTodayMin",{init:0}),e.propObj("timeEntries",{init:{}}),e.end(),e}(o)},{"../../dscommon/DSObject":86}],44:[function(t,e,n){var o,r,s,i;s=t("../../../dscommon/util").assert,i=t("../../../dscommon/util").error,r=t("../../../dscommon/DSDocument"),e.exports=o=function(){function t(){return e.apply(this,arguments)}var e,n;return t.addPropType=function(e){e.propComments=function(n,o){var r;return s&&o&&"function"!=typeof o&&i.invalidArg("valid"),o=(r=o)?function(t){return(null===t||Array.isArray(t))&&r(t)?t:void 0}:function(e){return null===e||e instanceof t?e:void 0},e.prop({name:n,type:"comments",valid:o,read:function(e){return null!==e?new t(e):null},str:function(t){var e;return 0===t.list.length?"":(e=t.list[0]).length<=20?e:e.substr(0,20)+"..."},equal:function(t,e){var n,o,r,s,i;if(null===t||null===e)return t===e;if(t.list.length!==e.list.length)return!1;for(i=t.list,n=o=0,r=i.length;o<r;n=++o)if(s=i[n],s!==e.list[n])return!1;return!0},init:null})}},n=moment.duration(0),e=function(e){var n,o,r,a;if(s)if(1===arguments.length&&"object"==typeof arguments[0]&&arguments[0].__proto__===t.prototype);else if(1===arguments.length&&Array.isArray(e))for(n=0,o=e.length;n<o;n++)a=e[n],"string"!=typeof a&&i.invalidArg("persisted");1===arguments.length&&"object"==typeof(r=arguments[0])&&r.__proto__===t.prototype?this.list=r.list.slice():this.list=e||[]},t.prototype.clone=function(){return new t(this)},t.prototype.add=function(t){this.list.push(t)},t.prototype.unshift=function(t){this.list.unshift(t)},t.prototype.shift=function(){return this.list.shift()},t.prototype.valueOf=function(){return this.list},t.prototype.clear=function(){this.list=[]},t}()},{"../../../dscommon/DSDocument":83,"../../../dscommon/util":92}],45:[function(t,e,n){var o,r,s,i;s=t("../../../dscommon/util").assert,i=t("../../../dscommon/util").error,o=t("../../../dscommon/DSDocument"),e.exports=r=function(){function t(){return e.apply(this,arguments)}var e,n;return t.addPropType=function(e){e.propTaskRelativeSplit=function(n,o){var r;return s&&o&&"function"!=typeof o&&i.invalidArg("valid"),o=(r=o)?function(e){return(null===e||"object"==typeof e&&e instanceof t)&&r(e)?e:void 0}:function(e){return null===e||e instanceof t?e:void 0},e.prop({name:n,type:"taskRelativeSplit",valid:o,read:function(e){return null!==e?new t(e):null},str:function(t){return t?"split":""},equal:function(t,e){var n,o,r,s,i,a;if(null===t||null===e)return t===e;if((r=null!=t?t.list:void 0).length!==(i=null!=e?e.list:void 0).length)return!1;for(n=o=0,s=r.length;o<s;n=o+=2)if(a=r[n],a!==i[n]||r[n+1].valueOf()!==i[n+1].valueOf())return!1;return!0},init:null})}},n=moment.duration(0),e=function(e){var n,o,r,a,u,c,l,d,p;if(s)if(1===arguments.length&&"object"==typeof arguments[0]&&arguments[0].__proto__===t.prototype);else if(1===arguments.length&&Array.isArray(e))for(e.length%2!==0&&i.invalidArg("persisted"),r=0,u=e.length;r<u;r++)p=e[r],"number"!=typeof p&&i.invalidArg("persisted");if(1===arguments.length&&"object"==typeof(d=arguments[0])&&d.__proto__===t.prototype)this.list=d.list.slice();else if(this.list=l=[],Array.isArray(e))for(o=a=0,c=e.length;a<c;o=a+=2)n=e[o],l.push(moment.duration(n,"day").valueOf()),l.push(moment.duration(e[o+1],"minute"))},t.prototype.clone=function(){return new t(this)},t.prototype.set=function(t,e,n){var o,r,a,u,c,l,d;for(s&&(moment.isMoment(t)||i.invalidArg("duedate"),moment.isMoment(e)||i.invalidArg("date"),null===n||moment.isDuration(n)||i.invalidArg("estimate")),r=e.diff(t),d=l=this.list,a=u=0,c=d.length;u<c;a=u+=2){if(o=d[a],o===r){if(null!==n&&0!==n.valueOf()){if(l[a+1].valueOf()===n.valueOf())return;l[a+1]=n}else l.splice(a,2);return void delete this.value}if(r<o)return 0!==(null!=n?n.valueOf():void 0)&&l.splice(a,0,r,n),void delete this.value}return 0!==(null!=n?n.valueOf():void 0)&&(delete this.value,l.push(r),l.push(n)),this},t.prototype.get=function(t,e){var n,o,r,a,u,c,l;for(s&&(moment.isMoment(t)||i.invalidArg("duedate"),moment.isMoment(e)||i.invalidArg("date")),o=e.diff(t),l=c=this.list,r=a=0,u=l.length;a<u;r=a+=2)if(n=l[r],n===o)return c[r+1];return null},t.prototype.day=function(t,e){var n;return s&&(moment.isMoment(e)||i.invalidArg("date")),Object.defineProperty(n={},"val",{get:function(n){return function(){return n.get(t(),e)}}(this),set:function(n){return function(o){return n.set(t(),e,o)}}(this)}),n},t.prototype.valueOf=function(){var t,e,n,o,r,s,i,a,u;if(u=this.value)return u;for(this.value=i=[],s=r=this.list,e=n=0,o=s.length;n<o;e=n+=2)a=s[e],t=r[e+1],i.push(moment.duration(a).asDays()),i.push(t.asMinutes());return i},t.prototype.shift=function(t,e){var n,o,r,a,u,c,l;if(s)switch(arguments.length){case 1:"number"!=typeof t&&i.invalidArg("diff");break;case 2:moment.isMoment(t)||i.invalidArg("newDuedate"),moment.isMoment(e)||i.invalidArg("oldDuedate");break;default:throw new Error("Invalid arguments")}if(delete this.value,n="number"==typeof t?t:t.diff(e),0!==n)for(c=u=this.list,o=r=0,a=c.length;r<a;o=r+=2)l=c[o],u[o]-=n},t.prototype.firstDate=function(t){var e;return s&&(moment.isMoment(t)||i.invalidArg("duedate")),(e=this.list).length>0?moment(t).add(e[0]):null},t.prototype.lastDate=function(t){var e;return s&&(moment.isMoment(t)||i.invalidArg("duedate")),(e=this.list).length>0?moment(t).add(e[e.length-2]):null},t.prototype.clear=function(){delete this.value,this.list=[]},t.prototype.fixEstimate=function(t){var e,n,o,r,s,i;if(t>0)this.list[this.list.length-1].add(t);else if(t<0)for(s=r=this.list.slice(1),e=n=0,o=s.length;n<o;e=n+=2)if(i=s[e],(t+=i.valueOf())>0){this.list[e+1]=moment.duration(t),this.list=this.list.slice(e);break}},Object.defineProperty(t.prototype,"total",{get:function(){var t,e,o,r,s,i;if(0===(o=this.list).length)return n;if(1===o.length)return o[1];for(s=moment.duration(o[1]),r=o.slice(3),t=0,e=r.length;t<e;t+=2)i=r[t],s.add(i);return s}}),t}()},{"../../../dscommon/DSDocument":83,"../../../dscommon/util":92}],46:[function(t,e,n){var o;e.exports=(o=angular.module("app",["ui.router","ui.select",t("./ui/ui"),t("./data/dsDataService"),t("./data/persistClipboard"),t("./svc/emails/emails"),t("./db")])).name,o.run(["config","$rootScope","db",function(t,e,n){e.Math=Math,e.taskModal={},e.startDateVal=null,e.view3ActiveTab=null,e.connnected=null}]),o.config(["$urlRouterProvider","$stateProvider","$locationProvider",function(t,e,n){n.html5Mode(!0),t.otherwise("/")}])},{"./data/dsDataService":26,"./data/persistClipboard":27,"./db":35,"./svc/emails/emails":47,"./ui/ui":61}],47:[function(t,e,n){var o,r,s,i,a;s=t("../../../utils/base64"),r=t("../../models/Task"),o=t("../../models/Person"),e.exports=(a=angular.module("svc-emails",[t("../../data/dsDataService")])).name,a.config(["$urlRouterProvider","$stateProvider","$locationProvider","$httpProvider",function(t,e,n,o){e.state({name:"emails",url:"/emails",templateUrl:function(){return"./svc/emails/main.html"},controller:i})}]),i=["$scope","$http","$sce","config","dsDataService",function(t,e,n,i,a){var u,c;t.dateCheck="",t.isDateCheckOk=function(){return!!/\d{1,2}\.\d{2}\.\d{4}/.test(t.dateCheck)&&moment(t.dateCheck,"DD.MM.YYYY").startOf("day").valueOf()===moment().startOf("day").valueOf()},t.state="notStarted",t.data=null,t.formatDuration=u=function(t){var e,n,o;return e=Math.floor(t.asHours()),n=t.minutes(),o=e?e+" ч.":"",n&&(o&&(o+=" "),o+=n+" мин."),o},t.prepare=function(){var e,s,i,c,l,d,p,f,h;c=a.findDataSet(this,{type:o,mode:"original"}),d=a.findDataSet(this,{type:r,mode:"original",filter:"assigned",startDate:l=moment().startOf("week"),endDate:s=moment(l).add(6,"days")}),i=function(t){var e,o,r;return o=u(t.planHours),e=u(t.optHours),r=o,e&&(r&&(r+=" + "),r+="<span style='background-color:rgb(255,153,0)'>"+e+"</span>"),t.hours=n.trustAsHtml(r),t},e=function(){var e,n,o,r,a,p,f,h,m,g,y,v,w,k,S,D,b,T,O;for(console.info("compute started..."),t.emails=r=[],k=h=_.sortBy(_.map(c.items),function(t){return t.get("name")}),p=0,f=k.length;p<f;p++)if(m=k[p],null!==m.get("roles")){w={},S=d.items;for(T in S)if(b=S[T],b.get("responsible")===m&&null!==b.get("estimate")&&462667!==b.get("taskList").get("id"))if((v=w[y=(g=b.get("project")).$ds_key])||(v=w[y]={id:g.get("id"),name:g.get("name"),planHours:moment.duration(),optHours:moment.duration(),manager:""}),a=b.get("title").toLowerCase().indexOf("бронь")!==-1||b.get("taskList").get("name").toLowerCase().indexOf("бронь")!==-1?v.optHours:v.planHours,D=b.get("split"))for(n=b.get("duedate"),e=moment(l);e<=s;)null!==(o=D.get(n,e))&&a.add(o),e.add(1,"day");else a.add(b.get("estimate"));O=moment.duration(),(w=_.map(w,function(t){return O.add(t.planHours),O.add(t.optHouras),i(t)})).length>0&&(w=_.sortBy(w,function(t){return t.name}),r.push({person:m,toName:m.get("firstName"),startDate:l.format("DD.MM"),endDate:s.format("DD.MM.YYYY"),totalHours:u(O),projects:w,status:"notSent"}))}console.info("compute finished: ",r)},h=function(){"ready"===c.status&&"ready"===d.status&&(e(),p(),f())},p=c.watchStatus(this,h),f=d.watchStatus(this,h),c.release(this),d.release(this)},c=function(n){var o,r,i,a,u;r=t.emails[n],i=template({email:r}),a=r.person.get("roles"),u=r.person.get("email"),o="managers@webprofy.ru",(a.get("Designer")||a.get("Jr. Designer"))&&(o+=", a.shevtsov@webprofy.ru, a.kolesnikov@webprofy.ru"),a.get("Markuper")&&(o+=", n.skinteev@webprofy.ru, s.yastrebov@webprofy.ru"),console.info("to: ",u),console.info("cc: ",o),e({method:"POST",url:"https://thawing-chamber-8269.herokuapp.com/https://api.mailgun.net/v3/webprofy.ru/messages",data:$.param({to:r.person.get("email"),cc:o,from:"Татьяна Верхотурова <t.verkhoturova@webprofy.ru>",subject:r.title,html:i}),headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+s.encode("api:key-3ccadef54df260c8a2903da328ebb165")}}).then(function(e){console.info("ok: ",e),r.status="sent",n+1===t.emails.length?t.state="completed":c(n+1)},function(e){console.error("error: ",e),t.state="error"})},t.sendOut=function(){t.state="inProgress",c(0)}}]},{"../../../utils/base64":94,"../../data/dsDataService":26,"../../models/Person":36,"../../models/Task":41}],48:[function(t,e,n){var o;e.exports=(o=angular.module("ui/account/rmsAccount",[t("../../config")])).name,o.run(["$rootScope",function(t){t.isShowAccount=!1,t.showAccount=function(){t.isShowAccount=!t.isShowAccount}}]),o.directive("rmsAccount",["config","$rootScope",function(t,e){return{restrict:"A",scope:!0,link:function(n,o,r){var s;n.$evalAsync(function(){$($("input",o)[1]).select()}),n.url=t.teamwork,n.token=t.token,n.refreshPeriod=t.refreshPeriod,n.autosave=!!t.autosave,n.save=function(){var e,o;o=n.url.trim(),e=n.token.trim(),t.teamwork=o,t.token=e,t.refreshPeriod=n.refreshPeriod,t.autosave=n.autosave?1:0,s()},n.close=s=function(){
e.isShowAccount=!1}}}}])},{"../../config":21}],49:[function(t,e,n){var o,r,s,i,a;r=t("../../dscommon/util").assert,i=t("../../dscommon/util").error,o=t("../../dscommon/DSObject"),e.exports=(a=angular.module("ui/filters",[])).name,s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a.run(["$rootScope",function(t){t.filter={calendarHeader:function(t,e){var n,a,u,c,l;if(r&&(t instanceof o||i.invalidArg("doc"),(c=t.__proto__.__props).hasOwnProperty(e)||i.invalidArg("prop"),"moment"!==(l=c[e].type)))throw new Error("Expected property with type 'moment', but property '"+e+"' has type "+l);if(!(n=t.get(e)))throw new Error("Non null date expected in the header");return a=moment(n).format("YYYYMMDD"),u=n.month()+1,u<10&&(u="0"+u),s[n.day()]+" "+n.date()+"/<small>"+u+"</small>"},shortDate:function(t,e){var n,s,a;if(r&&(t instanceof o||i.invalidArg("doc"),(s=t.__proto__.__props).hasOwnProperty(e)||i.invalidArg("prop"),"moment"!==(a=s[e].type)))throw new Error("Expected property with type 'moment', but property '"+e+"' has type "+a);return n=t.get(e),n?n.format("DD.MM"):""},taskPeriod:function(e,n,s){var a,u,c,l,d;return r&&e&&(null===e||e instanceof o||i.invalidArg("doc"),null===n||(l=e.__proto__.__props).hasOwnProperty(n)||i.invalidArg("prop")),d="",s?(moment.isDuration(s)?(u=Math.floor(s.asHours()),c=s.minutes()):(u=Math.floor((s=s.get("timeMin"))/60),c=s%60),u||c?(d+=u?u+"h ":"",c&&(d+=c+"m")):d+="0"):null===typeof s&&(d+="0"),e&&(a=e.get(n))&&("undefined"!=typeof s&&t.dataService.showTimeSpent&&(d+=" / "),u=Math.floor(a.asHours()),c=a.minutes(),d+=u?u+"h":"",u&&c&&(d+=" "),c&&(d+=c+"m"),d||(d+="0")),d},taskPeriodLight:function(t){var e,n,o;return r&&(moment.isDuration(t)||i.invalidArg("duration")),t?(e=Math.floor(t.asHours()),n=t.minutes(),o=e?e+"h":"",n&&(o+=" "+n+"m"),o||(o="0"),o):""},periodDiff:function(t){var e,n,o,s;return r&&(null===t||moment.isDuration(t)||i.invalidArg("diff")),t&&null!==(s=t.valueOf())?(o=s<0?(t=moment.duration(-s),"- "):"+ ",e=Math.floor(t.asHours()),n=t.minutes(),o+=e+"h",n&&(o+=" "+n+"m"),o||(o="0"),o):""},timeLeft:function(t){var e,n,o,s;return r&&(null===t||moment.isDuration(t)||i.invalidArg("diff")),t&&null!==(s=t.valueOf())?(o=s<0?(t=moment.duration(-s),"- "):"",e=Math.floor(t.asHours()),n=t.minutes(),o+=e+"h "+(n<10?"0"+n:n)+"m"):""},taskEditDueDate:function(t){return r&&t&&!moment.isMoment(t)&&i.invalidArg("date"),t?t.format("DD.MM.YYYY"):""},splitDuration:function(e,n){var o,r,s;return s="",n?(o=Math.floor((n=n.get("timeMin"))/60),r=n%60,o||r?(s+=o?o+"h ":"",r&&(s+=r+"m")):s+="0"):null===typeof n&&(s+="0"),e&&("undefined"!=typeof n&&t.dataService.showTimeSpent&&(s+=" / "),o=Math.floor(e.asHours()),r=e.minutes(),s=o?o+"h":"",r&&(s+=" "+r+"m"),s||(s="0")),s}}}])},{"../../dscommon/DSObject":86,"../../dscommon/util":92}],50:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h,m;l=t("../../dscommon/util").assert,d=t("../../dscommon/util").error,e.exports=(f=angular.module("ui/layout",[])).name,i=140,a=730,u=10,c=10,m=900,h=i+c,p=44,s=440,r=440,f.directive("uiLayout",["config","$window","$rootScope",function(t,e,n){return e=$(e),{restrict:"A",controller:["$scope",function(o){var r;o.layout=this,this.area1={},this.area2={},this.area3={},this.width=e.width(),this.area3.height=this.height=e.height()-p,r=function(){n.$digest(),n.$broadcast("layout-update")},(this.setVResizer=function(e,n){var o;o=this.area1.width=this.area2.width=this.vResizer=Math.min(Math.max(Math.round(e),a),this.width-c),this.area3.width=this.width-o,t.set("vResizer",this.area1.width/this.width),n||r()}).call(this,this.width*(t.get("vResizer")||.68),!0),(this.setHResizer=function(e,n){var o;o=this.area1.height=this.hResizer=Math.min(Math.max(Math.round(e),i),this.height-u),this.area2.height=this.height-o,t.set("hResizer",this.area1.height/this.height),n||r()}).call(this,this.height*(t.get("hResizer")||.68),!0),this.setSize=function(t,e,n){var o,s,i;e-=p,o=!1,(i=this.width)!==t&&(o=!0,this.setVResizer(this.vResizer*((this.width=Math.max(t,m))/i),!0)),(s=this.height)!==e&&(o=!0,this.setHResizer(this.hResizer*((this.height=Math.max(e,h))/s),!0),this.area3.height=e),o&&!n&&r()}}],link:function(t,n,o,r){var s;e.on("resize",s=function(){r.setSize(e.width(),e.height())}),t.$on("$destroy",function(){e.off("resize",s)})}}}]),f.directive("uiLayoutResizer",["$document",function(t){return{restrict:"A",require:"^uiLayout",link:function(e,n,o,r){var s,i,a,u;s="horizontal"===o.uiLayoutResizer,n.on("mousedown",u=function(e){e.preventDefault(),t.on("mousemove",i),t.on("mouseup",a)}),i=s?function(t){r.setHResizer(t.pageY-p)}:function(t){r.setVResizer(t.pageX)},a=function(e){t.off("mousemove",i),t.off("mouseup",a)},e.$on("$destroy",function(){t.off("mousedown",u),a()})}}}]),o=function(){function t(){return e.apply(this,arguments)}var e;return e=function(t){this.elem=t},t.prototype.innerHeight=function(){return this.elem.innerHeight()},t}(),f.directive("uiLayoutContainer",["$document",function(t){return{restrict:"A",link:function(t,e,n){t.uiContainer=new o(e)}}}])},{"../../dscommon/util":92}],51:[function(t,e,n){var o,r,s;o=t("../../dscommon/util").assert,r=t("../../dscommon/util").error,e.exports=(s=angular.module("ui/noDrag",[])).name,s.directive("noDrag",function(){return{link:function(t,e){var n;n=e[0],n.addEventListener("dragstart",function(t){return t.preventDefault(),!1})}}})},{"../../dscommon/util":92}],52:[function(t,e,n){var o,r,s,i,a;o=t("../../dscommon/util").assert,r=t("../../dscommon/util").error,e.exports=(s=angular.module("ui/sameHeight",[])).name,i=10,a=10,s.directive("sameHeight",function(){return{scope:!0,controller:["$scope",function(t){this.height=0,this.update=[],this.scope=t}],link:function(t,e,n,o){n.sameHeight&&t.$watch(n.sameHeight,function(){return t.resizeInProgress()})}}}),s.directive("sameHeightSrc",function(){return{require:"^sameHeight",scope:!1,link:function(t,e,n,o){var r,s;s=null,r=!1,o.scope.resizeInProgress=function(){var t,n,u,c;r||(r=!0,n=e.height(),u=null,c=a,t=!1,s=setInterval(function(){var i,l,d,p,f,h,m,g;if(t)if(g=u,g===(u=e.height()))0===--c&&(clearInterval(s),r=!1);else{for(m=o.update,d=0,f=m.length;d<f;d++)(i=m[d])(u);c=a}else if(n!==(u=e.height()))for(t=!0,h=o.update,l=0,p=h.length;l<p;l++)(i=h[l])(u)},i))},o.scope.$on("$destroy",function(){clearInterval(s)}),t.$evalAsync(function(){var t,n,r,s,i,a;for(a=e.height(),s=o.update,i=[],n=0,r=s.length;n<r;n++)t=s[n],i.push(t(a));return i})}}}),s.directive("sameHeightDest",function(){return{require:"^sameHeight",scope:!1,link:function(t,e,n,o){o.update.push(function(t){e.height(t)})}}})},{"../../dscommon/util":92}],53:[function(t,e,n){var o,r,s,i,a;o=t("../../dscommon/util").assert,r=t("../../dscommon/util").error,e.exports=(s=angular.module("ui/sameWidth",[])).name,i=30,a=10,s.directive("sameWidth",function(){return{scope:!0,controller:["$scope",function(t){this.width=0,this.update=[],this.scope=t}],link:function(t,e,n,o){n.sameWidth&&t.$watch(n.sameWidth,function(){return t.resizeInProgress()})}}}),s.directive("sameWidthSrc",function(){return{require:"^sameWidth",scope:!1,link:function(t,e,n,o){var r,s,u;u=null,s=!1,r=e[0],o.scope.resizeInProgress=function(){var t,e,n,c;s||(s=!0,e=r.clientWidth,n=null,c=a,t=!1,u=setInterval(function(){var i,l,d,p,f,h,m,g;if(t)if(g=n,g===(n=r.clientWidth))0===--c&&(clearInterval(u),s=!1);else{for(m=o.update,d=0,f=m.length;d<f;d++)(i=m[d])(n);c=a}else if(e!==(n=r.clientWidth))for(t=!0,h=o.update,l=0,p=h.length;l<p;l++)(i=h[l])(n)},i))},o.scope.$on("$destroy",function(){clearInterval(u)}),t.$evalAsync(function(){var t,e,n,s,i,a;for(a=r.clientWidth,s=o.update,i=[],e=0,n=s.length;e<n;e++)t=s[e],i.push(t(a));return i})}}}),s.directive("sameWidthDest",function(){return{require:"^sameWidth",scope:!1,link:function(t,e,n,o){o.update.push(function(t){e.width(t)})}}})},{"../../dscommon/util":92}],54:[function(t,e,n){var o,r,s,i,a,u,c,l,d=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;e.exports=(c=angular.module("ui/tasks/TaskSplitWeekView",[t("../../../dscommon/DSView")])).name,u=t("../../../dscommon/util").assert,o=t("../../../dscommon/DSObject"),a=t("../../models/types/TaskSplit"),i=t("../../models/Task"),r=t("../../models/Person"),s=t("../../models/PersonDayStat"),l=t("../time"),c.factory("TaskSplitWeekView",["DSView","$log",function(t,e){var n,i;return n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,t),e.begin("DayModel"),e.ds_dstr.push(function(){"function"==typeof this.__unwatch1&&this.__unwatch1(),"function"==typeof this.__unwatch2&&this.__unwatch2()}),e.propDuration("timeLeft"),e.propDuration("timeLeftShow"),e.propObj("plan"),e.propDuration("initPlan"),e.propBool("select"),e.end(),e}(o),i=function(e){function o(){return i.apply(this,arguments)}var i;return d(o,e),o.begin("TaskSplitWeekView"),a.addPropType(o),o.propData("personDayStat",s,{mode:"edited"}),o.propList("days",n),o.propMoment("monday"),o.propDoc("responsible",r),o.propMoment("today"),o.propMoment("duedate"),o.propTaskRelativeSplit("split"),i=function(e,o,r,s,i){var c,d,p,f,h,m;u&&(!s instanceof a&&error.invalidArg("split"),moment.isMoment(i)||error.invalidArg("monday")),t.call(this,e,o),this.set("split",s),this.set("monday",i),e.$watch("edit.responsible",function(t){return function(e){t.set("responsible",e),t.__dirty++}}(this)),this.dataUpdate({startDate:i,endDate:moment(i).endOf("week"),mode:e.mode}),h=e.edit.split,m=e.edit.splitDuedate,d=moment(i),this.get("daysList").merge(this,f=function(){var t,o,i;for(t=function(t){return function(t,n){var o;return t.set("initPlan",o=null===h?null:h.get(m,n)),t.set("plan",s.day(r,n)),n.valueOf()===l.today?t.set("select",!0):n>l.today&&(t.__unwatch1=e.$watch("edit.duedate",function(e){t.set("select",null!==e&&n<=e)})),t.__unwatch2=e.$watch(function(){var n,o,r;return[null!=(n=e.$eval("edit.responsible"))?n.$ds_key:void 0,null!=(o=t.get("plan"))?o.val:void 0,null!=(r=t.get("timeLeft"))?r.valueOf():void 0]},function(n){var r,s,i,a,u;a=n[0],s=n[1],u=n[2],"number"!=typeof u?t.set("timeLeftShow",null):(r=moment.duration(u),null!==o&&null!==(i=e.task.get("responsible"))&&i.$ds_key===a&&r.add(o),moment.isDuration(s)&&r.subtract(s),t.set("timeLeftShow",r))},!0)}}(this),i=[],c=o=0;o<7;c=++o)p=new n(this,""+c),t(p,d),(d=moment(d)).add(1,"day"),i.push(p);return i}.call(this))},o.prototype.render=function(){var t,e,n,o,r,s,i,a,c,l,d;if(null===(l=this.get("responsible"))||"ready"!==(d=this.data.get("personDayStatStatus"))&&"update"!==d)for(c=this.get("days"),r=0,i=c.length;r<i;r++)t=c[r],t.set("timeLeft",null);else{if(u&&!this.data.get("personDayStat").hasOwnProperty(l.$ds_key))throw new Error("Missing person");for(e=this.data.get("personDayStat")[l.$ds_key].get("dayStats"),a=this.get("days"),n=o=0,s=a.length;o<s;n=++o)t=a[n],t.set("timeLeft",e[n].get("timeLeft"))}},o.end(),o}(t)}])},{"../../../dscommon/DSObject":86,"../../../dscommon/DSView":91,"../../../dscommon/util":92,"../../models/Person":36,"../../models/PersonDayStat":37,"../../models/Task":41,"../../models/types/TaskSplit":45,"../time":60}],55:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h=function(t,e){function n(){this.constructor=t}for(var o in e)m.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},m={}.hasOwnProperty;c=t("../../../dscommon/util").assert,l=t("../../../dscommon/util").error,f=t("shortid"),p=t("../../../dscommon/util").serviceOwner,i=t("../../../dscommon/DSObject"),s=t("../../../dscommon/DSDocument"),r=t("../../../dscommon/DSDigest"),o=t("../../models/types/Comments"),a=t("../../models/Person"),u=t("../../models/Task"),e.exports=(d=angular.module("ui/tasks/addCommentAndSave",[t("../../config"),t("../../data/dsDataService"),t("../../data/dsChanges")])).name,d.run(["$rootScope",function(t){t.AddCommentAndSave=null}]),d.factory("addCommentAndSave",["dsDataService","dsChanges","config","$rootScope","$q",function(t,e,n,a,d){var m,g;return m=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return h(n,t),n.begin("AddCommentAndSave"),n.propDoc("document",s),n.propList("documents",s),n.propObj("changes"),n.propStr("reason",{init:""}),n.propBool("plansChange"),n.prototype.show=function(t,n,o){var r,i,p,h,m,g,y,v,_,w,k,S,D,b,T,O,P,$,j;if(c&&(null!==t&&(t.$new||Array.isArray(t)&&t.length>0&&t[0]instanceof s||t instanceof s)||l.invalidArg("document"),"boolean"!=typeof n&&l.invalidArg("showDialog"),null!==o&&"object"==typeof o||l.invalidArg("changes")),this.__deferred=d.defer(),this.get("documentsList").merge(this,[]),t.$new)_=u.pool.find(this,w="new:"+f()),_.set("status","new"),this.set("document",t=(i=e.get("tasksSet")).$ds_pool.find(this,w)),t.release(this);else if(Array.isArray(t)){for(h=0,g=t.length;h<g;h++)p=t[h],p.addRef(this);this.get("documentsList").merge(this,t),t=this.set("document",t[0])}else this.set("document",t);if(o.hasOwnProperty("plan")&&!o.plan)if(Array.isArray(t)){for(m=0,y=t.length;m<y;m++)if(p=t[m],p.get("plan")){k=this.set("plansChange",!0);break}}else t.get("plan")&&(k=this.set("plansChange",!0));o.hasOwnProperty("duedate")&&!o.hasOwnProperty("clipboard")&&(null!=(T=(Array.isArray(t)?t[0]:t).get("duedate"))?T.valueOf():void 0)!==(null!=(O=o.duedate)?O.valueOf():void 0)&&(o.clipboard=!1),v=[],r=!1,P=t.__props;for(b in P)if(D=P[b],o.hasOwnProperty(b)){if(!(null!=($=t.$u)?$.hasOwnProperty(b):void 0)){console.error("Doc "+t.toString()+": Prop "+b+": Property is not editable");continue}if("undefined"==typeof D.valid(j=o[b])){console.error("Doc "+t.toString()+": Prop "+b+": Invalid value '"+j+"'");continue}D.equal(t.get(b),j=o[b])||(r=!0,v.push({propName:b,value:j,text:null===j?"-":D.str(j)})),delete o[b]}for(b in o)console.error("Doc "+t.toString()+": Has no property '"+b+"'");return S=this.__deferred.promise,r?(this.set("changes",v),n||k?a.addCommentAndSave=this:(this.saveWOComment(),this.freeDocs())):(this.set("document",null),this.get("documentsList").merge(this,[]),this.__deferred.resolve(!0),delete this.__deferred),S},n.prototype.save=function(){this.addCommentAndSave(),a.addCommentAndSave=null},n.prototype.cancel=function(){this.freeDocs(),a.addCommentAndSave=null,this.__deferred.resolve(!1),delete this.__deferred},n.prototype.freeDocs=function(){this.set("reason",""),this.set("document",null),this.get("documentsList").merge(this,[]),this.set("changes",null)},n.prototype.addCommentAndSave=function(){r.block(function(t){return function(){var n,r,s,i,a,u,c,l,d,p,f,h,m;(a=e.get("hist")).startBlock();try{for(s=t.get("document"),0===(i=t.get("documents")).length&&(i=null),h=t.get("changes"),u=0,d=h.length;u<d;u++)if(n=h[u],i)for(c=0,p=i.length;c<p;c++)s=i[c],s.set(n.propName,n.value);else s.set(n.propName,n.value);if((r=t.get("reason").trim()).length>0)if(m=function(t){var e;e=null===(e=t.get("comments"))?new o:e.clone(),e.add(r),t.set("comments",e)},i)for(l=0,f=i.length;l<f;l++)s=i[l],m(s);else m(s)}finally{a.endBlock()}}}(this)),this.freeDocs(),this.__deferred.resolve(!0),delete this.__deferred},n.prototype.saveWOComment=function(){r.block(function(t){return function(){var n,o,r,s,i,a,u,c,l;(s=e.get("hist")).startBlock();try{for(o=t.get("document"),0===(r=t.get("documents")).length&&(r=null),l=t.get("changes"),i=0,u=l.length;i<u;i++)if(n=l[i],r)for(a=0,c=r.length;a<c;a++)o=r[a],o.set(n.propName,n.value);else o.set(n.propName,n.value)}finally{s.endBlock()}}}(this)),this.freeDocs(),this.__deferred.resolve(!0),delete this.__deferred},n.end(),n}(i),g=p.add(new m(p,"addCommentAndSave")),function(t,e,n){return g.show(t,e,n)}}])},{"../../../dscommon/DSDigest":82,"../../../dscommon/DSDocument":83,"../../../dscommon/DSObject":86,"../../../dscommon/util":92,"../../config":21,"../../data/dsChanges":25,"../../data/dsDataService":26,"../../models/Person":36,"../../models/Task":41,"../../models/types/Comments":44,shortid:3}],56:[function(t,e,n){var o;e.exports=(o=angular.module("ui/tasks/rmsTask",[])).name,o.run(["$rootScope",function(t){t.modal={type:null}}]),o.directive("rmsTask",["$rootScope","$timeout",function(t,e){return{restrict:"A",require:"ngModel",link:function(e,n,o,r){var s,i,a,u;n.on("click",function(e){var o;e.stopPropagation(),"task-edit"!==(o=t.modal).type?(t.modal={type:"task-edit",task:r.$viewValue,pos:n.offset()},t.$digest()):o.task!==r.$viewValue&&(t.modal={type:null},t.$digest(),t.$evalAsync(function(){t.modal={type:"task-edit",task:r.$viewValue,pos:n.offset()}},0))}),n.on("mouseover",function(e){e.stopPropagation(),0<=["task-info",null].indexOf(t.modal.type)&&(t.modal={type:"task-info",task:r.$viewValue,pos:n.offset()},t.$digest())}),n.on("mouseleave",function(e){e.stopPropagation(),0<=["task-info"].indexOf(t.modal.type)&&(t.modal={type:null},t.$digest())}),u=void 0,"taskView.time.task"!==o.rmsTask&&e.$watch(o.rmsTask+".style",function(t){n.css("background-color",t.color?t.color:""),n.css("border",t.border?t.border:"")}),i=u=function(r){var s;return t.modal={type:"drag-start",task:s=e.$eval(o.rmsTask),scope:e},t.$digest(),n.addClass("drag-start"),r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("task",s),r.dataTransfer.setDragImage($("#task-drag-ghost")[0],20,20),!0},s=function(e){return t.modal={type:null},n.removeClass("drag-start"),t.$digest(),!0},a=n[0],e.$watch(o.rmsTask+".$u",function(t){t?(a.draggable=!0,a.addEventListener("dragstart",i),a.addEventListener("dragend",s)):(a.draggable=!1,a.removeEventListener("dragstart",i),a.removeEventListener("dragend",s))})}}}]),o.directive("setTaskVisible",[function(){return{restrict:"A",link:function(t,e,n){var o;o=n.setTaskVisible,t.$eval(o+".setVisible(true)"),t.$on("$destroy",function(){t.$eval(o+".setVisible(false)")})}}}])},{}],57:[function(t,e,n){var o;e.exports=(o=angular.module("ui/tasks/rmsTaskAdd",[])).name,o.directive("rmsTaskAdd",["$rootScope",function(t){return{link:function(e,n){var o,r,s,i,a,u;for(e.addTask=function(){return t.modal={type:"task-edit"}},r=function(t){return n.addClass("drag-start"),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("new",!0),t.dataTransfer.setDragImage(n[0],20,20),!0},o=function(t){return n.removeClass("drag-start"),!0},u=$("*",n).addBack(),i=0,a=u.length;i<a;i++)s=u[i],s.draggable=!0,s.addEventListener("dragstart",r),s.addEventListener("dragend",o)}}}])},{}],58:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h,m,g,y;e.exports=(m=angular.module("ui/tasks/rmsTaskEdit",[t("../../data/dsChanges"),t("../../data/dsDataService"),t("./TaskSplitWeekView"),t("./addCommentAndSave")])).name,h=t("../../../dscommon/util").assert,y=t("../../ui/time"),r=t("../../../dscommon/DSDigest"),s=t("../../../dscommon/DSTags"),o=t("../../../dscommon/DSDataEditable"),c=t("../../models/Tag"),l=t("../../models/Task"),p=t("../../models/TaskList"),i=t("../../models/Person"),u=t("../../models/Project"),f=t("../../models/types/TaskSplit"),a=t("../../models/PersonDayStat"),d=o(l.Editable).$u,g=3,m.directive("rmsTaskEdit",["TaskSplitWeekView","dsDataService","dsChanges","addCommentAndSave","$rootScope","$window","$timeout",function(t,e,n,o,r,l,m){return{restrict:"A",scope:!0,link:function(n,l,m){var v,w,k,S,D,b,T,O,P,j,x,L,A,C,M,R,E,V,I;return O=r.modal,n.edit=S={},E=null,j=function(e){return new t(n,"TaskSplitWeekView "+e.format(),function(){return S.splitDuedate},S.split,e)},T=function(){var t,e,o;t=S.firstWeek,S.splitView=function(){var n,r,s;for(s=[],o=n=0,r=g;0<=r?n<r:n>r;o=0<=r?++n:--n)e=j(t),(t=moment(t)).add(1,"week"),s.push(e);return s}(),E=n.$watch(function(){var t;return null!=(t=S.split.lastDate(S.splitDuedate))?t.valueOf():void 0},function(t){var e;S.split.shift(e=moment(t),S.splitDuedate),S.splitDuedate=e})},L=function(){var t,e,o,r;for(o=S.splitView,t=0,e=o.length;t<e;t++)r=o[t],r.release(n);S.splitView=null,E()},n.$evalAsync(function(){$($("input",l)[1]).select()}),n.people=_.map(i.pool.items,function(t){return t}),n.task=C=O.task,n.$watch(function(){return y.today.valueOf()},function(){return n.today=y.today}),n.$on("$destroy",function(){"function"==typeof n._unwatch&&n._unwatch(),"function"==typeof n._unwatch2&&n._unwatch2(),"function"==typeof n._unwatch3&&n._unwatch3(),"function"==typeof n._unwatch4&&n._unwatch4(),S.tags&&S.tags!==C.get("tags")&&S.tags.release(n)}),(S.newTask=P=void 0===C)?(x=r.newTaskValues,S.project=(null!=x?x.project:void 0)||null,S.taskList=(null!=x?x.taskList:void 0)||null,S.responsible=(null!=x?x.taskList:void 0)||null,S.title=null,S.description=null,S.duedate=k=(null!=x?x.duedate:void 0)?moment(x.duedate):null,S.estimate=(null!=x?x.estimate:void 0)?moment.duration(x.estimate):null,S.tags=(null!=x?x.tags:void 0)?new s(n,x.tags):null,R=null,v=e.findDataSet(n,{type:u,mode:"original"}),v.watchStatus(n,function(t,o,r,s){var i,a,u,c,l;if(n._unwatch3=function(){var t,e,o,r;for("function"==typeof R&&R(),s(),v.release(n),r=n.projectsList,t=0,e=r.length;t<e;t++)o=r[t],o.release(n);n.projectsList=null},"ready"===o){for(s(),n._unwatch3=null,l=n.projectsList=function(){var t,e;t=v.items,e=[];for(c in t)u=t[c],e.push(u);return e}().sort(function(t,e){return t.get("name").localeCompare(e.get("name"))}),i=0,a=l.length;i<a;i++)u=l[i],u.addRef(n);R||(R=n.$watch(function(){var t;return null!=(t=S.project)?t.$ds_key:void 0},function(t){var o,r,s,i,a,c,l,d;if(n.taskListsList=null,S.taskList=null,t){if(n.taskListsList){for(c=n.taskListsList,r=0,i=c.length;r<i;r++)d=c[r],d.release(n);n.taskListsList=null}o=e.findDataSet(n,{type:p,mode:"original",project:S.project}),o.watchStatus(n,function(t,e,r,s){var i,a,c,l,p;if(n._unwatch4=function(){var t,e,r;if(s(),o.release(n),n.taskLists){for(r=n.taskLists,t=0,e=r.length;t<e;t++)d=r[t],d.release(n);n.taskLists=null}},"ready"===e){for(s(),n._unwatch4=null,c=n.taskListsList=function(){var t,e;t=o.items,e=[];for(p in t)l=t[p],e.push(l);return e}().sort(function(t,e){return t.get("position")-e.get("position")}),i=0,a=c.length;i<a;i++)u=c[i],u.addRef(n);return o.release(n)}})}else if(n.taskLists){for(l=n.taskLists,s=0,a=l.length;s<a;s++)d=l[s],d.release(n);n.taskLists=null}})),v.release(n)}}),n.task=C={$new:!0,$u:d,get:function(t){switch(t){case"split":case"duedate":case"responsible":case"tags":return null;default:throw new Error("Unexpected prop: "+t)}}}):(S.project=C.get("project"),S.taskList=C.get("taskList"),S.title=C.get("title"),S.duedate=k=C.get("duedate"),S.estimate=C.get("estimate"),S.responsible=C.get("responsible"),S.description=C.get("description"),S.tags=C.get("tags")),n.$watch(function(){return S.tags},function(t){var e,o;n.orderedTags=t?function(){var n,r;n=t.map,r=[];for(o in n)e=n[o],r.push(e);return r}().sort(function(t,e){var n;return 0!==(n=t.get("priority")-e.get("priority"))?n:t.get("name").localeCompare(e.get("name"))}):[]}),(V=function(){var t;t=e.findDataSet(n,{type:c,mode:"original"}),t.watchStatus(n,function(e,o,r,s){var i,a;n._unwatch2=s,"ready"===o&&(s(),n._unwatch2=null,n.tagsToSelect=function(){var e,n,o;e=t.items,o=[];for(a in e)i=e[a],(null!=(n=S.tags)?n.get(a):void 0)||o.push(i);return o}().sort(function(t,e){var n;return 0!==(n=t.get("priority")-e.get("priority"))?n:t.get("name").localeCompare(e.get("name"))}),t.release(n))})})(),S.tagsSelected=null,n.$watch(function(){return S.tagsSelected},function(){var t,e;S.tagsSelected&&(e=(t=S.tags)?S.tags.clone(n):new s(n),e.set(S.tagsSelected.name,S.tagsSelected),S.tags=e,t&&C.get("tags")!==t&&t.release(n),S.tagsSelected=null,V())}),n.tagsRemove=function(t){var e,o;Object.keys((e=S.tags).map).length>1?(o=e.clone(n),o.set(t.name,!1),S.tags=o):S.tags=null,e&&C.get("tags")!==e&&e.release(n),V()},S.splitDiff=null,S.firstWeek=M=moment().startOf("week"),S.splitDuedate=null!==k?k:moment().startOf("day"),(S.isSplit=null!==(S.split=null!==(A=C.get("split"))?A.clone():null)&&null!==S.duedate&&null!==S.estimate)?(D=moment(A.firstDate(k)).startOf("week"),b=moment(A.lastDate(k)).startOf("week"),(I=moment.duration(b.diff(D)).asWeeks())<g?D.isBefore(M)?S.firstWeek=D:moment.duration(b.diff(M)).asWeeks()<=g||(S.firstWeek=b.subtract(g-1,"week")):S.firstWeek=D,T()):S.splitView=null,(n.viewonly=!C.$u||_.isEmpty(C.$u))||(n.changes=!1,n.$watch(function(){var t,e,n,o,r,s,i;return n=[null===(e=S.project)?null:e.$ds_key,null===(s=S.taskList)?null:s.$ds_key,S.title,S.description,null===(k=S.duedate)?null:k.valueOf(),null===(t=S.estimate)?null:t.valueOf(),null===(o=S.responsible)?null:o.$ds_key,null===(r=S.tags)?null:r.valueOf()],null!==(A=S.split)&&(i=A.valueOf()).length>0&&(n=n.concat(i)),n},function(t,e){n.changes=t!==e,null!==t[4]&&null!==t[5]||(S.isSplit=!1)},!0),n.$watch(function(){return S.isSplit},function(t,e){var o;t?(null===S.split&&(S.split=new f),null===S.splitView&&T()):null!==S.splitView&&L(),t!==e&&(null!=(o=S.split)?o.valueOf().length:void 0)>0&&(n.changes=!0)}),n.$watch(function(){var t;return null!=(t=S.duedate)?t.valueOf():void 0},function(t,e){t!==e&&(n.changes=!0,null!==S.split&&null!==t&&null!==e&&S.splitDuedate.add(t-e))}),n.$watch(function(){var t;return[null!=(t=S.estimate)?t.valueOf():void 0,S.isSplit,S.split]},function(t){var e,n,o,r,s,i;e=t[0],n=t[1],s=t[2],"number"==typeof e&&n&&null!==s?(r=(o=moment.duration(s.total).subtract(e)).valueOf(),S.splitDiff=0===r||null!==(i=S.splitDiff)&&i.valueOf()===r?null:o):S.splitDiff=null},!0)),n.splitPrevWeek=function(){var t;S.firstWeek=t=moment(S.firstWeek).subtract(1,"week"),S.splitView.unshift(j(t)),S.splitView.pop().release(n)},n.splitNextWeek=function(){var t;t=moment(S.firstWeek.add(1,"week")).add(g-1,"week"),S.splitView.push(j(t)),S.splitView.shift().release(n)},n.close=w=function(){r.modal={type:null}},n.save=function(t,e){var n,r,s,i;h&&"undefined"!=typeof e&&"boolean"!=typeof e&&error.invalidArg("plan"),S.isSplit&&S.split.list.length>0&&(S.duedate=S.splitDuedate,s=A.total,null===(r=S.estimate)?S.estimate=s:0!==(n=r.valueOf()-s.valueOf())&&A.fixEstimate(n)),i={},C.$new&&(i.project=S.project,i.taskList=S.taskList),i.title=S.title,i.duedate=S.duedate,i.estimate=S.estimate,i.responsible=S.responsible,i.split=S.isSplit&&S.split.valueOf().length>0?S.split:null,i.tags=S.tags,i.description=S.description,"boolean"==typeof e&&(i.plan=e),o(C,t.shiftKey,i).then(function(t){t&&w()})},n.showTimeLeft=function(t){var e,o,r,s,i,a,u,c;return null===(u=t.get("timeLeft"))?"":(i=t.get("plan"),r=t.get("initPlan"),e=moment.duration(u),null!==r&&n.task.get("responsible")===S.responsible&&e.add(r),null!==(c=i.val)&&e.subtract(c),a=(c=e.valueOf())<0?(e=moment.duration(-c),"- "):"",o=Math.floor(e.asHours()),s=e.minutes(),a+=o+"h "+(s<10?"0"+s:s)+"m")},n.autoSplitInProgress=!1,n.autoSplit=function(){var t,o,r,s,i,u,c,l;if(h){if(!(null!==S.duedate&&y.today<=S.duedate))throw new Error("Invalid duedate: "+(null!=(i=S.duedate)?i.format():void 0));if(null===S.responsible)throw new Error("Invalid value 'edit.responsible': "+S.responsible);if(!(null!==S.estimate&&S.estimate>0))throw new Error("Invalid value 'edit.estimate': "+(null!=(u=S.estimate)?u.valueOf():void 0))}n.autoSplitInProgress=!0,c=S.responsible.$ds_key,t=moment(k=S.duedate),o=moment.duration(S.estimate),(A=S.split).clear(),S.splitDuedate=moment(t),r=n.task.get("duedate"),s=null!==r&&S.responsible===n.task.get("responsible")?n.task.get("split"):null,(l=function(){var i,u;i=e.findDataSet(n,{type:a,mode:"edited",startDate:u=moment(t).startOf("week"),endDate:moment(t).endOf("week")}),n._unwatch=i.watchStatus(n,function(e,i,a,d){var p,f,h,m,g;if("ready"===i){for(f=e.items[c].get("dayStats");o>0&&y.today<=t&&u<=t;)g=(p=f[moment.duration(t.diff(u)).asDays()]).timeLeft,null!==s&&null!==(m=s.get(r,t))&&(g=moment.duration(g)).add(m),g>0&&(A.set(k,t,h=moment.duration(Math.min(g.valueOf(),o.valueOf()))),o.subtract(h)),t.subtract(1,"day");d(),delete n._unwatch,o>0&&y.today<=t?(t.subtract(2,"days"),l()):n.autoSplitInProgress=!1}}),i.release(n)})()}}}}])},{"../../../dscommon/DSDataEditable":78,"../../../dscommon/DSDigest":82,"../../../dscommon/DSTags":90,"../../../dscommon/util":92,"../../data/dsChanges":25,"../../data/dsDataService":26,"../../models/Person":36,"../../models/PersonDayStat":37,"../../models/Project":39,"../../models/Tag":40,"../../models/Task":41,"../../models/TaskList":42,"../../models/types/TaskSplit":45,"../../ui/time":60,"./TaskSplitWeekView":54,"./addCommentAndSave":55}],59:[function(t,e,n){var o,r,s,i;e.exports=(i=angular.module("ui/tasks/rmsTaskInfo",[])).name,r=t("../../../dscommon/util").assert,s=t("../../../dscommon/util").error,o=t("../../../dscommon/DSObject"),i.directive("rmsTaskInfo",["$rootScope","$window",function(t,e){return{restrict:"A",scope:!0,link:function(e,n,o){var r,s,i,a,u;r=t.modal,$(window).height()>r.pos.top+150?e.top=Math.ceil(r.pos.top+50):e.top=Math.ceil(r.pos.top-100),$(window).width()-$("#sidebar").innerWidth()>r.pos.left?e.left=Math.ceil(r.pos.left+95):e.left=Math.ceil(r.pos.left-300),e.task=u=r.task,e.orderedTags=(a=u.get("tags"))?function(){var t,e;t=a.map,e=[];for(i in t)s=t[i],e.push(s);return e}().sort(function(t,e){var n;return 0!==(n=t.get("priority")-e.get("priority"))?n:t.get("name").localeCompare(e.get("name"))}):[]}}}])},{"../../../dscommon/DSObject":86,"../../../dscommon/util":92}],60:[function(t,e,n){var o,r;e.exports=o={today:moment().startOf("day"),historyLimit:moment().startOf("week").subtract(2,"weeks")},(r=function(){setTimeout(function(){o.today=moment().startOf("day"),r()},moment().startOf("day").add(1,"day").add(20,"seconds").valueOf()-(new Date).getTime())})()},{}],61:[function(t,e,n){var o,r,s,i,a,u,c;s=t("../../dscommon/util").assert,i=t("../../dscommon/util").error,u=t("../../dscommon/util").totalRelease,o=t("../../dscommon/DSObjectBase"),r=t("../models/PersonDayStat"),e.exports=(a=angular.module("ui/ui",["ui.router","ngSanitize",t("./views/view1/View1"),t("./views/view2/View2"),t("./views/view3/View3"),t("./views/changes/ViewChanges"),t("./account/rmsAccount"),t("./widgets/widgetDate"),t("./widgets/widgetDuration"),t("./tasks/rmsTask"),t("./tasks/rmsTaskEdit"),t("./tasks/TaskSplitWeekView"),t("./tasks/rmsTaskInfo"),t("./tasks/rmsTaskAdd"),t("./tasks/addCommentAndSave"),t("./layout"),t("./filters"),t("./noDrag"),t("./sameHeight"),t("./sameWidth")])).name,a.config(["$urlRouterProvider","$stateProvider","$locationProvider","$httpProvider",function(t,e,n,o){e.state({name:"/",url:"/",templateUrl:function(){return"./ui/main.html"},controller:c}),u&&e.state({name:"totalRelease",url:"/totalRelease",templat:"<div/>"})}]),u&&a.run(["$state","$rootScope",function(t,e){var n;return n=window.totalRelease,window.totalRelease=function(){t.go("totalRelease"),e.$evalAsync(function(){n(),setTimeout(function(){console.info(window.totalPool)},1e3)})}}]),c=["$rootScope","$scope",function(t,e){e.mode="edited",e.setMode=function(t){e.mode=t},e.taskSummaryColor=function(t){var e;return s&&(t instanceof r.DayStat||i.invalidArg("dayStat")),(e=t.get("timeLeft").valueOf())<0?"red":e/t.get("contract").valueOf()<=.2?"green":"light-yellow"},e.dayTaskWidth=function(t){var e;return s&&(t instanceof r.DayStat||i.invalidArg("dayStat")),(e=t.get("timeLeft").valueOf())<0?100:Math.round(100*(1-e/t.get("contract").valueOf()))},e.taskViewExpand=function(t){e.period.people[t].tasks.expand=!e.period.people[t].tasks.expand}}]},{"../../dscommon/DSObjectBase":87,"../../dscommon/util":92,"../models/PersonDayStat":37,"./account/rmsAccount":48,"./filters":49,"./layout":50,"./noDrag":51,"./sameHeight":52,"./sameWidth":53,"./tasks/TaskSplitWeekView":54,"./tasks/addCommentAndSave":55,"./tasks/rmsTask":56,"./tasks/rmsTaskAdd":57,"./tasks/rmsTaskEdit":58,"./tasks/rmsTaskInfo":59,"./views/changes/ViewChanges":62,"./views/view1/View1":64,"./views/view2/View2":68,"./views/view3/View3":69,"./widgets/widgetDate":73,"./widgets/widgetDuration":74}],62:[function(t,e,n){var o,r,s,i,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;e.exports=(c=angular.module("ui/views/changes/ViewChanges",[t("../../../data/dsChanges"),t("../../../../dscommon/DSView")])).name,
u=t("../../../../dscommon/util").assert,s=t("../../../../dscommon/DSObject"),r=t("../../../../dscommon/DSDigest"),a=t("../../../models/Task"),i=t("../../../models/Person"),o=t("./models/Change"),c.run(["$rootScope",function(t){t.showChanges=function(){t.modal="changes"!==t.modal.type?{type:"changes"}:{type:null}}}]),c.controller("ViewChanges",["$scope","ViewChanges","dsChanges","$rootScope",function(t,e,n,o){t.view=new e(t,"viewChanges"),t.save=function(){n.save().then(function(t){t&&(o.modal={type:null})})},t.reset=function(){n.reset(),o.modal={type:null}}}]),c.directive("viewChangesFix",[function(){return{restrict:"A",link:function(t,e,n){var o,r;r=$(".main-table.header",e),o=$(".main-table.data",e),r.width(o.width())}}}]),c.factory("ViewChanges",["DSView","dsChanges","$log",function(t,e,n){var r;return r=function(n){function r(){return s.apply(this,arguments)}var s;return l(r,n),r.begin("ViewChange"),r.propData("tasks",a,{mode:"changes"}),r.propPool("poolChanges",o),r.propList("changes",o),r.propNum("renderVer",0),s=function(e,n){t.call(this,e,n),this.dataUpdate({})},r.ds_dstr.push(function(){var t,e,n;t=this.get("data").get("tasksSet").items;for(n in t)e=t[n],delete e.__change.__refreshView}),r.prototype.render=function(){var t,n,o,r,s,i,a,u,c,l,d,p,f,h,m,g,y,v,_;if("ready"!==(v=this.get("data").get("tasksStatus"))&&"update"!==v)return void this.get("changesList").merge(this,[]);s=this.get("poolChanges"),n=[],c=(y=this.get("data").get("tasksSet")).type.prototype.__props,r=!1,p=function(t){return function(){t.__dirty++}}(this),l=y.items;for(g in l){h=l[g],r=!r,h.__change.__refreshView=p,f=function(t){return function(){e.removeChanges(t),p()}}(h),m=[],d=h.__change;for(u in d)a=d[u],"__error"!==u&&"__refreshView"!==u&&"clipboard"!==u&&(i=c[u],m.push(t=s.find(this,h.$ds_key+"."+u)),t.set("isDark",r),t.set("index",i.index),t.set("prop",u),t.set("value",null===(_=a.v)?" -":i.str(a.v)),t.set("conflict",i.equal(o=h.$ds_doc.get(u),a.s)?null:null===o?" -":i.str(o)));m.sort(function(t,e){return t.get("index")-e.get("index")}),m[0].set("doc",h),m[0].remove=f,Array.prototype.push.apply(n,m),h.__change.__error&&(n.push(t=s.find(this,h.$ds_key+".__error")),t.set("isDark",r),t.set("error",h.__change.__error))}this.get("changesList").merge(this,n),this.set("renderVer",this.get("renderVer")+1)},r.end(),r}(t)}])},{"../../../../dscommon/DSDigest":82,"../../../../dscommon/DSObject":86,"../../../../dscommon/DSView":91,"../../../../dscommon/util":92,"../../../data/dsChanges":25,"../../../models/Person":36,"../../../models/Task":41,"./models/Change":63}],63:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("../../../../../dscommon/util").assert,a=t("../../../../../dscommon/util").error,s=t("../../../../../dscommon/DSObject"),r=t("../../../../../dscommon/DSDocument"),e.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("Change"),e.propDoc("doc",r),e.propStr("prop"),e.propStr("value"),e.propStr("conflict"),e.propStr("error"),e.propBool("isDark"),e.propNum("index"),e.end(),e}(s)},{"../../../../../dscommon/DSDocument":83,"../../../../../dscommon/DSObject":86,"../../../../../dscommon/util":92}],64:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h,m=function(t,e){function n(){this.constructor=t}for(var o in e)g.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},g={}.hasOwnProperty;e.exports=(f=angular.module("ui/views/view1/View1",[t("../../../config"),t("../../../data/dsChanges"),t("../../../data/dsDataService"),t("../../../../dscommon/DSView"),t("../../tasks/addCommentAndSave"),t("../../../data/teamwork/TWTasks")])).name,p=t("../../../../dscommon/util").assert,o=t("../../../../dscommon/DSDigest"),l=t("../../../models/Task"),c=t("../../../models/Tag"),s=t("../../../models/Person"),i=t("../../../models/PersonDayStat"),a=t("../../../models/PersonTimeTracking"),r=t("./models/Day"),u=t("./models/Row"),d=t("./models/TaskView"),h=t("../../../../dscommon/util").serviceOwner,f.controller("View1",["$scope","View1","$rootScope",function(t,e,n){n.view1=t.view=new e(t,"view1"),t.$on("$destroy",function(){delete n.view1}),t.expandedHeight=function(t){return t.expand?_.isEmpty(t.tasks)?"height:100px":"height:"+(65*_.maxBy(t.tasks,"y").y+98)+"px":""}}]),f.factory("View1",["DSView","config","$rootScope","$log","TWTasks",function(t,e,n,o,c){var d;return d=function(o){function d(){return p.apply(this,arguments)}var p,f,h;return m(d,o),d.begin("View1"),d.propData("people",s,{watch:["roles","companyId"]}),d.propData("tasks",l,{filter:"assigned",watch:["responsible","duedate","split","estimate","priority"]}),d.propData("personDayStat",i,{}),d.propData("personTimeTracking",a,{watch:[]}),d.propMoment("startDate"),d.propList("days",r),d.propPool("poolRows",u),d.propList("rows",u),d.propNum("renderVer",0),d.propObj("hiddenPeople",{init:{}}),d.propNum("hiddenPeopleCount",{init:0}),d.ds_dstr.push(function(){this.__unwatchA(),this.__unwatchB(),this.__unwatchC()}),p=function(o,r){var s,i,a,u,c,l,d,p,f;if(t.call(this,o,r),this.scope=o,this.set("startDate",moment().startOf("week")),o.filterLoad=[o.selectedLoad={id:0,name:"All"},{id:-1,name:"Underload"},{id:1,name:"Overload"}],f=e.get("selectedLoad"))for(l=o.filterLoad,i=0,u=l.length;i<u;i++)s=l[i],s.id===f&&(o.selectedLoad=s);if(e.hasRoles)for(o.filterCompanies=[{id:-1,name:"All"},o.selectedCompany={id:23872,name:"WebProfy"},{id:50486,name:"Freelancers"}],p=e.get("selectedCompany"),d=o.filterCompanies,a=0,c=d.length;a<c;a++)if(s=d[a],s.id===p){o.selectedCompany=s;break}this.__unwatchA=o.$watch(function(t){return function(){var e,n;return[null!=(e=t.get("startDate"))?e.valueOf():void 0,o.mode,o.dataService.showTimeSpent,null!=(n=o.selectedManager)?n.$ds_key:void 0]}}(this),function(t){return function(e){var n,o,r,s;s=e[0],n=e[1],r=e[2],o=e[3],t.dataUpdate({startDate:moment(s),endDate:moment(s).add(6,"days"),mode:n,showTimeSpent:r,manager:o?o:null})}}(this),!0),this.__unwatchB=o.$watch(function(){return[o.selectedRole,o.selectedCompany,o.selectedManager,o.selectedLoad]},function(t){return function(r){var s,i,a,u;return u=r[0],s=r[1],a=r[2],i=r[3],n.peopleRoles&&(e.set("selectedRole",u?u.role:null),(null!=u?u.role:void 0)||(o.selectedRole=null)),n.filterManagers&&(e.set("selectedManager",a?a.$ds_key:null),(null!=a?a.$ds_key:void 0)||(o.selectedManager=null)),e.set("selectedCompany",s?s.id:null),e.set("selectedLoad",i?i.id:0),t.__dirty++}}(this),!0),this.__unwatchC=o.$watch(function(t){return function(){return[e.get("currentUserId"),t.get("data").get("peopleStatus")]}}(this),function(t){return function(n){var o,r;return o=n[0],r=n[1],null===o||"ready"!==r&&"update"!==r?void e.set("currentUser",null):void e.set("currentUser",t.get("data").get("people")[o])}}(this),!0)},d.prototype.periodChange=function(t){this.set("startDate",this.startDate.add(t,"week"))},d.prototype.hideRow=function(t){this.get("hiddenPeople")[t.$ds_key]=!0,this.hiddenPeopleCount++,this.__dirty++},d.prototype.unhideAll=function(){this.set("hiddenPeople",{}),this.hiddenPeopleCount=0,this.__dirty++},d.prototype.render=function(){var t,n,o,s,i,a,u,c,l,p,f,h,m,g,y,v,w,k,S,D,b,T,O,P,$,j,x,L,A,C,M,R,E;if("ready"!==(m=this.get("data").get("peopleStatus"))&&"update"!==m)return void this.get("rowsList").merge(this,[]);A=this.get("startDate"),n=this.get("daysList").merge(this,_.map([0,1,2,3,4,5,6],function(t){return function(e,n){var o,s;return o=moment(A).add(e,"days"),s=new r(t,o.format()),s.set("date",o),s.set("index",n),s.set("x",e),s}}(this))),u=function(){return!0},c=this.get("hiddenPeople");for(p in c){u=function(t){return!c.hasOwnProperty(t.$ds_key)};break}if(e.get("hasRoles")){if((null!=(D=this.scope.selectedCompany)?D.id:void 0)!==-1?(t=this.scope.selectedCompany.id,s=u,u=function(e){return s(e)&&e.get("companyId")===t}):s=u,null!=(b=this.scope.selectedRole)?b.role:void 0)if(L=this.scope.selectedRole,i=u,L.hasOwnProperty("roles")){for($={},T=L.roles.split(","),l=0,f=T.length;l<f;l++)S=T[l],$[S.trim()]=!0;u=function(t){var e;return i(t)&&(null!=(e=t.get("roles"))?e.any($):void 0)}}else if(L.hasOwnProperty("special"))switch(L.special){case"notSupervisors":u=function(t){var e;return i(t)&&(null===(e=t.get("roles"))||!e.get("Manager"))};break;default:console.error("Unexpected role.special value: "+P.special,L)}else P=L.role,u=function(t){var e;return i(t)&&(null!=(e=t.get("roles"))?e.get(P):void 0)};if(0!==(null!=(O=this.scope.selectedLoad)?O.id:void 0)){if("ready"!==(y=this.get("data").get("personDayStatStatus"))&&"update"!==y)return;g=this.get("data").get("personDayStat"),h=1===this.scope.selectedLoad.id?function(t){var e,n,o,r;for(r=g[t.$ds_key].get("dayStats"),n=0,o=r.length;n<o;n++)if(e=r[n],e.get("timeLeft")<0)return!0;return!1}:function(t){var e,n,o,r;for(r=g[t.$ds_key].get("dayStats"),n=0,o=r.length;n<o;n++)if(e=r[n],e.get("timeLeft").valueOf()/e.get("contract").valueOf()>.2)return!0;return!1},a=u,u=function(t){return a(t)&&h(t)}}}x=_.filter(this.data.get("people"),u),x.sort(function(t,e){var n,o;return(n=t.name.toLowerCase())<(o=e.name.toLowerCase())?-1:n>o?1:0}),k=this.get("poolRows"),j=this.get("rowsList").merge(this,_.map(x,function(t){return function(e){var n;return n=k.find(t,e.$ds_key),n.set("person",e),n}}(this))),o=_.map([0,1,2,3,4,5,6],function(){return moment.duration(0)}),E=_.map([0,1,2,3,4,5,6],function(){return moment.duration(0)}),"ready"!==(M=this.get("data").get("tasksStatus"))&&"update"!==M||"ready"!==(y=this.get("data").get("personDayStatStatus"))&&"update"!==y?_.forEach(j,function(t){return function(e){e.get("tasksList").merge(t,[]),e.set("personDayStat",null)}}(this)):(C=_.groupBy(this.data.tasks,function(t){return t.get("responsible").$ds_key}),R=null,"ready"!==(w=this.data.personTimeTrackingStatus)&&"update"!==w||(E=_.map([0,1,2,3,4,5,6],function(){return moment.duration(0)}),R=_.groupBy(v=this.data.personTimeTracking,function(t){return t.get("personId")})),_.forEach(j,function(t){return function(e){var n,r,s,i,a,u,c,l,p,f,h,m,y,w,k,S,D,b,T,O,P,$,j,x;for(e.set("personDayStat",g=t.data.get("personDayStat")[e.$ds_key]),k=r=g.get("dayStats"),u=c=0,l=k.length;c<l;u=++c)i=k[u],o[u].add(i.get("tasksTotal"));if(P=e.get("tasksPool"),b={},O=_.map(C[e.$ds_key],function(n){var o,r,s,i,a,u,c,l,d,p;if(d=P.find(t,n.$ds_key),d.set("task",n),R)if(c=n.get("split"))for(r=n.get("duedate"),l=(s=c.firstDate(r))<=A?0:moment.duration(s.diff(A)).asDays(),u=t.get("days").slice(l,7),a=0,i=u.length;a<i;a++)o=u[a],(p=v[e.$ds_key+"-"+n.$ds_key+"-"+o.get("date").valueOf()])&&(b[p.$ds_key]=!0);else(p=v[e.$ds_key+"-"+n.$ds_key+"-"+n.get("duedate").valueOf()])?(b[p.$ds_key]=!0,d.set("time",p)):d.set("time",null);return d}),R&&(j=R[e.$ds_key])){for(m=0,p=j.length;m<p;m++)$=j[m],b[$.$ds_key]||(O.push(T=P.find(t,$.$ds_key)),T.set("time",$));for(x=_.groupBy(j,function(t){return t.get("date").valueOf()}),S=g.get("dayStats"),u=y=0,f=S.length;y<f;u=++y)n=S[u],(s=x[n.get("day").valueOf()])?E[u].add(n.set("timeSpent",_.reduce(s,function(t,e){return t.add(e.get("timeMin"),"m")},moment.duration()))):n.set("timeSpent",null)}else for(D=g.get("dayStats"),w=0,h=D.length;w<h;w++)n=D[w],n.set("timeSpent",null);e.get("tasksList").merge(t,O),a=null,R&&(a=function(t,n){return($=v[e.$ds_key+"-"+t.get("task").$ds_key+"-"+n.valueOf()])?$:null}),d.layoutTaskView(A,O,a)}}(this))),_.forEach(n,function(t,e){t.set("workTime",o[e]),t.set("timeSpent",0===E[e].valueOf()?null:E[e])}),this.set("renderVer",this.get("renderVer")+1)},d.taskViewsSortRule=h=function(t,e){var n,o;return n=t.get("task"),o=e.get("task"),null===n&&null===o?e.get("time").get("taskId")-t.get("time").get("taskId"):null===n?1:null===o?-1:c.tasksSortRule(n,o)},f=function(t,e,n,o,r){var s,i,a,u,c,l,d,p,f,h,m,g,y,v,_,w;if(e.set("x",o),i=t[o],0===o)w=i.length;else for(w=u=0,d=i.length;u<d&&(v=i[w],"undefined"!=typeof v);w=++u);if(e.set("y",w),null===(g=e.get("task"))||null===(m=g.get("split")))e.set("split",null),e.set("len",1),w===i.length&&i.length++,i[w]=!0;else for(l=e.set("len",Math.min(moment.duration(moment(m.lastDate(g.get("duedate"))).diff(n)).asDays()+1,7-o)),_=e.set("split",[]),h=c=0,f=l;0<=f?c<f:c>f;h=0<=f?++c:--c)s=0===h?n:moment(n).add(h,"day"),y=r?r(e,s):null,null===(p=m.get(g.duedate,s))&&null===y||_.push({x:h,plan:p,time:y}),(a=t[o+h]).length<=w&&(a.length=w),a[w]=!0;return w},d.layoutTaskView=function(t,e,n){var o,r,s,i,a,u,c,l,d,p,m,g;if(c=0,_.some(e,function(t){var e;return null!=(e=t.get("task"))?e.get("split"):void 0}))for(m=_.groupBy(e,function(t){var e,n,o;return(o=t.get("task"))?(e=o.get("duedate"),(null!==(n=o.get("split"))?n.firstDate(e):e).valueOf()):t.get("time").get("date").valueOf()}),l=function(){var t,e;for(e=[],i=t=0;t<=6;i=++t)e.push([]);return e}(),s=function(){var t;t=[];for(d in m)t.push(parseInt(d));return t}().sort(),a=0,u=s.length;a<u;a++)o=s[a],(g=m[o]).sort(h),r=moment.duration((p=moment(o)).diff(t)).asDays(),r<0&&(r=0,p=t),_.forEach(g,function(t){c=Math.max(c,f(l,t,p,r,n))});else m=_.groupBy(e,function(t){var e;return((e=t.get("time"))?e.get("date"):t.get("task").get("duedate")).valueOf()}),_.forEach(m,function(e,n){var o,r;e.sort(h),r=moment.duration(((o=e[0].get("time"))?o.get("date"):e[0].get("task").get("duedate")).diff(t)).asDays(),_.forEach(e,function(t,e){t.set("x",r),c=Math.max(c,t.set("y",e)),t.set("len",1),t.set("split",null)})});return c+1},d.end(),d}(t)}]),f.factory("getDropTasksGroup",["dsDataService","$rootScope",function(t,e){var n;return n=h.add(t.findDataSet(h,{type:l,mode:"edited",filter:"all"})),function(){var t,o,r,s,i,a;return t=e.modal.task.get("duedate").valueOf(),i=e.modal.task.get("responsible"),r=e.modal.task.get("project"),s=function(){var e,s,u;e=n.items,u=[];for(o in e)a=e[o],a.plan||a.split||a.get("responsible")!==i||(null!=(s=a.get("duedate"))?s.valueOf():void 0)!==t||a.get("project")!==r||u.push(a);return u}(),0===s.length?[e.modal.task]:s}}]),f.directive("rmsView1DropTask",["View1","$rootScope","dsChanges","addCommentAndSave","getDropTasksGroup",function(t,e,n,o,r){return{restrict:"A",scope:!0,link:function(t,n,s){var i;return i=n[0],i.addEventListener("dragover",function(t){return t.preventDefault(),!0}),i.addEventListener("drop",function(s){var i,a,u;return s.dataTransfer.getData("task")&&(i=_.findIndex($(".drop-zone",n),function(t){var e;return e=$(t),e.offset().left+e.width()>=s.clientX}),u=!s.ctrlKey||(a=e.modal).task.split||null===a.task.duedate?[e.modal.task]:r(),i<0?o(u,s.shiftKey,{responsible:t.row.get("person"),plan:!1}):o(u,s.shiftKey,{responsible:t.row.get("person"),duedate:t.view.get("days")[i].get("date"),plan:!1})),e.$digest(),s.stopPropagation(),!1})}}}]),f.directive("rmsView1MouseOverWeekChange",["View1","$rootScope","dsChanges","addCommentAndSave",function(t,e,n,o){return{restrict:"A",link:function(t,n,o){var r,s,i;r=t.$eval(o.rmsView1MouseOverWeekChange),i=0,s=n[0],s.addEventListener("dragover",function(t){return t.timeStamp>i&&(i=t.timeStamp+3e3,e.view1.periodChange(r),e.$digest()),t.preventDefault(),!0})}}}])},{"../../../../dscommon/DSDigest":82,"../../../../dscommon/DSView":91,"../../../../dscommon/util":92,"../../../config":21,"../../../data/dsChanges":25,"../../../data/dsDataService":26,"../../../data/teamwork/TWTasks":33,"../../../models/Person":36,"../../../models/PersonDayStat":37,"../../../models/PersonTimeTracking":38,"../../../models/Tag":40,"../../../models/Task":41,"../../tasks/addCommentAndSave":55,"./models/Day":65,"./models/Row":66,"./models/TaskView":67}],65:[function(t,e,n){var o,r,s=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;o=t("../../../../../dscommon/DSObject"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.begin("Day"),e.propMoment("date"),e.propNum("index"),e.propNum("x"),e.propDuration("workTime"),e.propDuration("timeSpent"),e.end(),e}(o)},{"../../../../../dscommon/DSObject":86}],66:[function(t,e,n){var o,r,s,i,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;u=t("../../../../../dscommon/util").assert,c=t("../../../../../dscommon/util").error,o=t("../../../../../dscommon/DSObject"),r=t("../../../../models/Person"),s=t("../../../../models/PersonDayStat"),a=t("./TaskView"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return l(e,t),e.begin("Row"),e.propPool("tasksPool",a),e.propDoc("person",r),e.propDoc("personDayStat",s),e.propList("tasks",a),e.propBool("expand",{init:!1}),e.end(),e}(o)},{"../../../../../dscommon/DSObject":86,"../../../../../dscommon/util":92,"../../../../models/Person":36,"../../../../models/PersonDayStat":37,"./TaskView":67}],67:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;o=t("../../../../../dscommon/DSObject"),a=t("../../../../../dscommon/util").validate,s=t("../../../../models/Task"),r=t("../../../../models/PersonTimeTracking"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("TaskView"),e.propDoc("task",s),e.propDoc("time",r),e.propNum("x",{init:0,valid:a.required}),e.propNum("y",{init:0,valid:a.required}),e.propNum("len",{init:1,valid:a.required}),e.propObj("split"),e.end(),e}(o)},{"../../../../../dscommon/DSObject":86,"../../../../../dscommon/util":92,"../../../../models/PersonTimeTracking":38,"../../../../models/Task":41}],68:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;e.exports=(a=angular.module("ui/views/view2/View2",[t("../../../data/dsChanges"),t("../../../data/dsDataService"),t("../../../../dscommon/DSView"),t("../view1/View1"),t("../../tasks/addCommentAndSave"),t("../../../data/teamwork/TWTasks")])).name,i=t("../../../../dscommon/util").assert,o=t("../../../../dscommon/DSDigest"),r=t("../../../models/Task"),s=t("../view1/models/TaskView"),a.controller("View2",["$scope","View2",function(t,e){t.view=new e(t,"view2"),t.tasksHeight=function(t){return!t.expand||_.isEmpty(t.tasks)?"":"height:"+(52*_.maxBy(t.tasks,"y").y+100)+"px"}}]),a.factory("View2",["View1","DSView","$rootScope","$log","TWTasks",function(t,e,n,o,i){var a;return a=function(n){function o(){return a.apply(this,arguments)}var a,c;return u(o,n),o.begin("View2"),o.propData("tasksOverdue",r,{filter:"overdue",watch:["duedate","plan","estimate","priority"]}),o.propData("tasksNotAssigned",r,{filter:"notassigned",watch:["duedate","split","plan","estimate","priority"]}),o.propList("tasksOverdue",r),o.propPool("poolTasksNotassignedViews",s),o.propList("tasksNotAssigned",s),o.propNum("tasksNotAssignedHeight",{init:0}),o.propNum("renderVer",0),o.ds_dstr.push(function(){this.__unwatchA()}),a=function(t,n){e.call(this,t,n),this.__unwatchA=t.$watch(function(){var e,n;return[null!=(e=t.$parent.view.startDate)?e.valueOf():void 0,t.mode,null!=(n=t.selectedManager)?n.$ds_key:void 0]},function(t){return function(e){var n,o,r;r=e[0],n=e[1],o=e[2],t.dataUpdate({startDate:moment(r),endDate:moment(r).add(6,"days"),mode:n,manager:o?o:null})}}(this),!0)},c=function(t,e){var n,o;return n=t.get("task"),o=e.get("task"),i.tasksSortRule(n,o)},o.prototype.render=function(){var e,n,o,r,s;n=this.__scope.$parent.view.startDate,"ready"!==(o=this.get("data").get("tasksOverdueStatus"))&&"update"!==o?this.get("tasksOverdueList").merge(this,[]):(s=_.map(this.get("data").get("tasksOverdue"),function(t){return function(e){return e.addRef(t),e}}(this)),s.sort(i.tasksSortRule),this.get("tasksOverdueList").merge(this,s)),"ready"!==(o=this.get("data").get("tasksNotAssignedStatus"))&&"update"!==o?(this.get("tasksNotAssignedList").merge(this,[]),this.set("tasksNotAssignedHeight",0)):(e=this.get("poolTasksNotassignedViews"),r=this.get("tasksNotAssignedList").merge(this,_.map(this.get("data").get("tasksNotAssigned"),function(t){return function(n){var o;return o=e.find(t,n.$ds_key),o.set("task",n),o}}(this)).sort(c)),this.set("tasksNotAssignedHeight",t.layoutTaskView(n,r))),this.set("renderVer",this.get("renderVer")+1)},o.end(),o}(e)}]),a.directive("rmsView2DayDropTask",["dsChanges","$rootScope","addCommentAndSave","getDropTasksGroup",function(t,e,n,o){return{restrict:"A",scope:!0,link:function(t,r,s){var i,a;i=r[0],a=function(t){var e,n;return e=_.findIndex($(".vertical-lines > .col",r),function(e){var n;return n=$(e),n.offset().left+n.width()>=t.clientX}),-1<=(n=--e)&&n<=6?e:-2},i.addEventListener("dragover",function(t){return a(t)!==-2&&(t.preventDefault(),!0)}),i.addEventListener("drop",function(r){var s,i,u;return r.dataTransfer.getData("task")&&(s=a(r),u=!r.ctrlKey||(i=e.modal).task.split||null===i.task.duedate?[e.modal.task]:o(),n(u,r.shiftKey,{responsible:null,duedate:s===-1?null:t.view1.get("days")[s].get("date"),plan:!1})),e.$digest(),r.stopPropagation(),!1})}}}])},{"../../../../dscommon/DSDigest":82,"../../../../dscommon/DSView":91,"../../../../dscommon/util":92,"../../../data/dsChanges":25,"../../../data/dsDataService":26,"../../../data/teamwork/TWTasks":33,"../../../models/Task":41,"../../tasks/addCommentAndSave":55,"../view1/View1":64,"../view1/models/TaskView":67}],69:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f=function(t,e){function n(){this.constructor=t}for(var o in e)h.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},h={}.hasOwnProperty;e.exports=(p=angular.module("ui/views/view3/View3",[t("../../../config"),t("../../../data/dsDataService"),t("../../../../dscommon/DSView"),t("../../tasks/addCommentAndSave"),t("../../../data/teamwork/TWTasks")])).name,l=t("../../../../dscommon/util").assert,d=t("../../../../dscommon/util").error,a=t("../../../models/Task"),u=t("../../../models/TaskList"),r=t("../../../models/Project"),o=t("./models/PersonView"),s=t("./models/ProjectView"),c=t("./models/TaskListView"),i=t("../view1/models/Row"),p.controller("View3",["$scope","View3",function(t,e){t.view=new e(t,"view3")}]),p.factory("View3",["DSView","config","$rootScope","$log","TWTasks",function(t,e,n,i,c){var p;return p=function(i){function p(r,i){t.call(this,r,i),this.scope=r,this.expandedProj={},this.expandedRows={},this.__unwatchA=r.$watch(function(){var t;return[r.mode,e.activeSidebarTab,null!=(t=r.selectedManager)?t.$ds_key:void 0]},function(t){return function(o){var s,i,a;switch(i=o[0],s=o[1],a=o[2],n.view3ActiveTab=s,a||(a=null),s){case-1:"function"==typeof t.__unwatchB&&t.__unwatchB(),t.dataUpdate({filter:"clipboard",mode:i,manager:a});break;case 0:"function"==typeof t.__unwatchB&&t.__unwatchB(),t.dataUpdate({filter:"noduedate",mode:i,manager:a});break;case 1:t.__unwatchB=r.$watch(function(){var t;return null!=(t=r.$parent.view.startDate)?t.valueOf():void 0},function(o){var r,s;n.startDateVal=o,"number"!=typeof o?e.activeSidebarTab=0:(s=moment(o).add(1,"week"),r=moment(s).endOf("week"),t.dataUpdate({filter:"all",mode:i,startDate:s,endDate:r,manager:a}))});break;case 2:"function"==typeof t.__unwatchB&&t.__unwatchB(),t.dataUpdate({filter:"all",mode:i,manager:a})}}}(this),!0),this.__unwatchC=r.$watch(function(){return[e.view3GroupByPerson,e.view3HidePeopleWOTasks,e.view3FilterByPerson,e.view3FilterByProject,e.view3FilterByTask]},function(t){return function(){clearTimeout(t.__timer1),t.__timer1=setTimeout(function(){t.__dirty++,r.$digest()},300)}}(this),!0),r.notAssignedExpanded=!0,r.toggleProjectExpanded=function(t){return function(n){var o,r,i,a,u;return l&&(n instanceof s||d.invalidArg("project")),a=(r=t.expandedProj).hasOwnProperty(o=e.activeSidebarTab)?r[o]:r[o]=u={},a.hasOwnProperty(i=n.$ds_key)?a[i]=!a[i]:a[i]=!(2!==o)}}(this),r.isProjectExpanded=function(t){return function(n){var o,r,i,a;return l&&(n instanceof s||d.invalidArg("project")),(r=t.expandedProj).hasOwnProperty(o=e.activeSidebarTab)&&(a=r[o]).hasOwnProperty(i=n.$ds_key)?a[i]:2!==o}}(this),r.togglePersonExpanded=function(t){return function(n){var r,s,i,a,u;return l&&(n instanceof o||d.invalidArg("personView")),a=(s=t.expandedRows).hasOwnProperty(r=e.activeSidebarTab)?s[r]:s[r]=u={},a.hasOwnProperty(i=n.$ds_key)?a[i]=!a[i]:a[i]=!1}}(this),r.isPersonExpended=function(t){return function(n){var r,s,i,a;return l&&(n instanceof o||d.invalidArg("personView")),!(s=t.expandedRows).hasOwnProperty(r=e.activeSidebarTab)||!(a=s[r]).hasOwnProperty(i=n.$ds_key)||a[i]}}(this)}var h;return f(p,i),p.begin("View3"),p.propData("tasks",a,{watch:["duedate","priority","clipboard"]}),p.propPool("poolPeople",o),p.propList("people",o),p.propPool("poolProjects",s),p.propList("projects",s),p.ds_dstr.push(function(){this.__unwatchA(),"function"==typeof this.__unwatchB&&this.__unwatchB(),this.__unwatchС(),"function"==typeof this.__unwatchD&&this.__unwatchD(),clearTimeout(this.__timer1)}),h=function(t,e){return"null"===t?"not assigned tasks".indexOf(e)>=0:t.person.name.toLowerCase().indexOf(e)>=0||t.person.firstName.toLowerCase().indexOf(e)>=0||t.person.email.toLowerCase().indexOf(e)>=0},p.prototype.render=function(){var t,n,o,s,i,a,l,d,p,f,m,g,y,v,w,k,S,D,b,T,O,P,$,j;if("ready"!==(b=this.get("data").get("tasksStatus"))&&"update"!==b)return void this.get("projectsList").merge(this,[]);if(T=this.get("data").get("tasks"),(null!=(y=o=e.view3FilterByTask)?y.length:void 0)>0&&(o=o.trim().toLowerCase(),T=_.filter(T,function(t){return t.get("title").toLowerCase().indexOf(o)>=0})),0===e.view3GroupByPerson){if($=_.groupBy(T,function(t){return t.get("taskList").$ds_key}),P=_.groupBy($,function(t){return t[0].get("project").$ds_key}),(null!=(v=n=e.view3FilterByProject)?v.length:void 0)>0){n=n.trim().toLowerCase();for(i in P)j=P[i],r.pool.items[i].get("name").toLowerCase().indexOf(n)>=0||delete P[i]}f=this.get("poolProjects"),m=this.get("projectsList").merge(this,_.map(P,function(t){return function(e,n){var o;return o=f.find(t,n),o.set("project",r.pool.items[n]),o.get("taskListsList").merge(t,_.map(e,function(e){var n,r;return n=e[0].get("taskList").$ds_key,r=o.poolTaskLists.find(t,n),r.set("taskList",u.pool.items[n]),r.set("tasksCount",_.size(e)),r.set("totalEstimate",_.reduce(e,function(t,e){var n;return(n=e.get("estimate"))?t.add(n):t},moment.duration(0))),r.get("tasksList").merge(t,_.map(e,function(e){return e.addRef(t)}).sort(c.tasksSortRule)),r})),o}}(this)).sort(function(t,e){var n,o;return(n=t.get("project").get("name").toLowerCase())<(o=e.get("project").get("name").toLowerCase())?-1:n>o?1:0})),this.get("peopleList").merge(this,[]),this.__unwatchD&&(this.__unwatchD(),this.__unwatchD=null,this.__src.tasks.watch.length=this.__src.tasks.watch.length-1)}else{for(this.__unwatchD||(this.__unwatchD=this.scope.$watch(function(t){return function(){var e,n,o,r,s;for(r=t.scope.view1.rows,s=[],e=0,n=r.length;e<n;e++)o=r[e],s.push(o.$ds_key);return s}}(this),function(t){return function(e,n){e!==n&&t.__dirty++}}(this),!0),this.__src.tasks.watch.push("responsible")),p=this.get("poolPeople"),(null!=(w=t=e.view3FilterByPerson)?w.length:void 0)>0&&(t=t.trim().toLowerCase()),(null!=(k=n=e.view3FilterByProject)?k.length:void 0)>0&&(n=n.trim().toLowerCase()),O=_.groupBy(T,function(t){var e;return(e=t.get("responsible"))?e.$ds_key:"null"}),D=this.scope.view1.rows,O.hasOwnProperty("null")&&(D=D.concat("null")),S=[],s=0,a=D.length;s<a;s++)if(g=D[s],!t||h(g,t))if(O.hasOwnProperty(d="null"!==g?g.$ds_key:"null")){if($=_.groupBy(O[d],function(t){return t.get("taskList").$ds_key}),P=_.groupBy($,function(t){return t[0].get("project").$ds_key}),n)for(i in P)j=P[i],r.pool.items[i].get("name").toLowerCase().indexOf(n)>=0||delete P[i];if(0===Object.keys(P).length)continue;S.push(l=p.find(this,d)),"null"!==g&&l.set("row",g),f=l.get("poolProjects"),l.get("projectsList").merge(this,_.map(P,function(t){return function(e,n){var o;return o=f.find(t,n),o.set("project",r.pool.items[n]),o.get("taskListsList").merge(t,_.map(e,function(e){var n,r;return n=e[0].get("taskList").$ds_key,r=o.poolTaskLists.find(t,n),r.set("taskList",u.pool.items[n]),r.set("tasksCount",_.size(e)),r.set("totalEstimate",_.reduce(e,function(t,e){var n;return(n=e.get("estimate"))?t.add(n):t},moment.duration(0))),r.get("tasksList").merge(t,_.map(e,function(e){return e.addRef(t)}).sort(c.tasksSortRule)),r})),o}}(this)).sort(function(t,e){var n,o;return(n=t.get("project").get("name").toLowerCase())<(o=e.get("project").get("name").toLowerCase())?-1:n>o?1:0}))}else e.get("view3HidePeopleWOTasks")||(S.push(l=p.find(this,d)),"null"!==g&&l.set("row",g),l.get("projectsList").merge(this,[]));this.get("peopleList").merge(this,S),this.get("projectsList").merge(this,[])}},p.end(),p}(t)}]),p.directive("rmsView3DropTask",["$rootScope","addCommentAndSave","getDropTasksGroup",function(t,e,n){return{restrict:"A",scope:!0,link:function(o,r,s){var i,a;a=r[0],i=s.rmsView3DropTask.length>0?function(t){return function(){return t}}(parseInt(s.rmsView3DropTask)):function(){return t.view3ActiveTab},a.addEventListener("dragover",function(t){return t.preventDefault(),2===i()}),a.addEventListener("drop",function(o){var r,s,a;if(o.dataTransfer.getData("task")){switch(a=!o.ctrlKey||(s=t.modal).task.split||null===s.task.duedate?[t.modal.task]:n(),r={plan:!1},i()){case-1:r.duedate=null,r.clipboard=!0;break;case 0:r.duedate=null;break;case 1:r.duedate=moment(t.startDateVal).add(1,"week")}e(a,o.shiftKey,r)}return t.$digest(),o.stopPropagation(),!1})}}}])},{"../../../../dscommon/DSView":91,"../../../../dscommon/util":92,"../../../config":21,"../../../data/dsDataService":26,"../../../data/teamwork/TWTasks":33,"../../../models/Project":39,"../../../models/Task":41,"../../../models/TaskList":42,"../../tasks/addCommentAndSave":55,"../view1/models/Row":66,"./models/PersonView":70,"./models/ProjectView":71,"./models/TaskListView":72}],70:[function(t,e,n){var o,r,s,i,a,u,c,l,d=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;o=t("../../../../../dscommon/DSObject"),l=t("../../../../../dscommon/util").validate,r=t("../../../../models/Person"),i=t("../../../../models/Project"),a=t("./ProjectView"),c=t("./TaskListView"),u=t("../../view1/models/Row"),e.exports=s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,t),e.begin("PersonView"),e.propDoc("row",u),e.propPool("poolProjects",a),e.propList("projects",c),e.end(),e}(o)},{"../../../../../dscommon/DSObject":86,"../../../../../dscommon/util":92,"../../../../models/Person":36,"../../../../models/Project":39,"../../view1/models/Row":66,"./ProjectView":71,"./TaskListView":72}],71:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;o=t("../../../../../dscommon/DSObject"),a=t("../../../../../dscommon/util").validate,r=t("../../../../models/Project"),i=t("./TaskListView"),e.exports=s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("ProjectView"),e.propDoc("project",r),e.propPool("poolTaskLists",i),e.propList("taskLists",i),e.end(),e}(o)},{"../../../../../dscommon/DSObject":86,"../../../../../dscommon/util":92,"../../../../models/Project":39,"./TaskListView":72}],72:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;o=t("../../../../../dscommon/DSObject"),
a=t("../../../../../dscommon/util").validate,r=t("../../../../models/Task"),s=t("../../../../models/TaskList"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("TaskListView"),e.propDoc("taskList",s),e.propList("tasks",r),e.propNum("tasksCount",{init:0}),e.propDuration("totalEstimate"),e.propBool("isExpand",{init:!0}),e.end(),e}(o)},{"../../../../../dscommon/DSObject":86,"../../../../../dscommon/util":92,"../../../../models/Task":41,"../../../../models/TaskList":42}],73:[function(t,e,n){var o;e.exports=(o=angular.module("ui/widgets/widgetDate",[])).name,$.datepicker.regional.ru={dateFormat:"dd.mm.yy",firstDay:1},$.datepicker.setDefaults($.datepicker.regional.ru),$.timepicker.regional.ru={},$.timepicker.setDefaults($.timepicker.regional.ru),o.directive("widgetDate",["$rootScope","$timeout",function(t,e){return{restrict:"EA",require:"ngModel",link:function(n,o,r,s){var i;i=$("input",o),e(function(){i.datepicker(),i.change(function(){var e;s.$setViewValue((e=i.datetimepicker("getDate"))?moment(e.getTime()):null),t.$digest()}),(s.$render=function(){i.datetimepicker("setDate",s.$viewValue?new Date(s.$viewValue.valueOf()):null)})()},0)}}}])},{}],74:[function(t,e,n){var o,r,s;e.exports=(s=angular.module("ui/widgets/widgetDuration",[])).name,o=36e5,r=6e4,s.directive("widgetDuration",["$rootScope","$timeout",function(t,e){return{restrict:"EA",require:"ngModel",link:function(e,n,s,i){var a,u,c,l;l=$("input",n),u=$(l[0]),c=$(l[1]),(i.$render=function(){var t,e,n;(n=i.$viewValue)?(t=Math.floor(n.valueOf()/o),e=Math.floor(n.valueOf()%o/r),u.val(t),c.val(e<10?"0"+e:e)):(u.val(""),c.val(""))})(),a=function(){var e,n,o;n=parseInt(u.val()),o=parseInt(c.val()),e=moment.duration(0),isNaN(n)||e.add(n,"hours"),isNaN(o)||e.add(o,"minutes"),i.$setViewValue(0===e.valueOf()?null:e),t.$digest()},u.on("input",a),c.on("input",a)}}}])},{}],75:[function(t,e,n){var o,r,s,i,a,u,c;s=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,r=/RMS\s*Data\s*\(DO NOT CHANGE!?\)/i,o=/}\s*END/i,u=function(t){var e,n,o,r;for(n=o=r=t.length-1;o>=0&&("\r"===(e=t.charAt(n))||"\n"===e||" "===e||"\t"===e);n=o+=-1);return n>=0?t.substr(0,n+1):""},c=function(t){var e,n,o,r,s;for(n=-1,o=r=0,s=t.length;r<s;o=r+=1)if("\n"===(e=t.charAt(o)))n=o;else if("\r"!==e&&" "!==e&&"\t"!==e)break;return n===-1?t:o<t.length?t.substr(n+1):""},i=function(t){var e,n,s,a;return(s=t.search(r))===-1?t:(e=t.search(o))!==-1&&s<e?(a=u(t.substr(0,s)),n=c(t.substr(t.substr(s).search(/end/i)+3+s)),i(a.length>0?n.length>0?a+"\r\n\r\n"+n:a:n)):u(t.substr(0,s-1))},e.exports={clear:i,get:function(t){var e,n,i,u;if(s&&null!==t&&"string"!=typeof t&&a.invalidArg("description"),null===t||(u=t.search(r))===-1)return null;if((e=t.search(o))!==-1&&u<e&&(i=t.indexOf("{",u))!==-1&&i<e)try{return JSON.parse(t.substr(i,e-i+1).trim())}catch(c){n=c,console.error("ex: ",n)}return console.error("Corrupted RMS Data: ",t),null},put:function(t,e){return s&&(null!==t&&"string"!=typeof t&&a.invalidArg("description"),null!==e&&"object"!=typeof e&&a.invalidArg("data")),t=null===t?"":i(t),null===e||0===_.size(e)?t:(0===t.length?"":""+t)+("\r\n\r\nRMS Data (DO NOT CHANGE!) "+JSON.stringify(e)+" END")}}},{"../../dscommon/util":92}],76:[function(t,e,n){var o,r,s,i,a,u,c,l,d=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;c=t("./util").assert,l=t("./util").error,a=t("./DSHistory"),u=t("./DSPool"),r=t("./DSData"),i=t("./DSDocument"),s=t("./DSDigest"),e.exports=o=function(t){function e(){return n.apply(this,arguments)}var n,o;return d(e,t),e.begin("DSChangesBase"),e.noCache(),e.propDoc("hist",a),e.propNum("count",{init:0}),n=function(t,e){var n,o,s,i,c,l,d,p;for(r.call(this,t,e,{}),(o=this.set("hist",new a(this,e+".hist"))).release(this),n={add:function(t){return function(){t.count++,t.persist()}}(this),change:function(t){return function(){t.persist()}}(this),remove:function(t){return function(){t.count--,t.persist()}}(this)},this.__unwatch2=p=[],c=this.__proto__.__sets,s=0,i=c.length;s<i;s++)d=c[s],(l=this["_"+d]).$ds_hist=o,(l.$ds_pool=new u(this,e+"."+d+".pool",l.type)).release(this),l.watch(this,n,!0)},e.prototype.saveToLocalStorage=_.noop,e.prototype.persist=function(){},e.prototype.anyChange=function(){return this.get("count")>0},e.prototype.reset=function(){s.block(function(t){return function(){var e,n,o,r,s,i,a,u,c,l,d,p;(e=t.get("hist")).startReset();try{for(c=t.__proto__.__sets,n=0,s=c.length;n<s;n++)for(d=c[n],l=_.map((p=t["_"+d]).items,function(t){return t}),r=0,i=l.length;r<i;r++){o=l[r],a=o.$ds_doc;for(u in o.__change)"__error"!==u&&"__refreshView"!==u&&o.set(u,a.get(u))}}finally{e.endReset()}}}(this))},e.prototype.changesToMap=function(){var t,e,n,o,r,s,i,a,u,c,l,d,p,f,h,m;for(d={},u=this.__proto__.__sets,t=0,r=u.length;t<r;t++){h=u[t],a=(f=this["_"+h]).type.prototype.__props,d[h]=p={},c=f.items;for(o in c){e=c[o],p[o]=n={},l=e.__change;for(i in l)s=l[i],"__error"!==i&&"__refreshView"!==i&&(m=a[i].write)&&(n[i]={v:null===s.v?null:m(s.v),s:null===s.s?null:m(s.s)})}}return d},o=function(t,e,n,o,r){var s,i,a;a=e.hasOwnProperty(s=n.docType)?e[s]:e[s]={},a[t[r]]=i=a.hasOwnProperty(t[r])?a[t[r]]:a[t[r]]=[],i.push(function(t,e,n){return function(o){c&&(null!==o&&o.__proto__.constructor===t&&o.$ds_key===e||l.invalidArg("doc")),n[r]=o}}(n,t[r],o))},e.prototype.mapToChanges=function(t){var e,n,r,s,i,a,u,c,l,d,p,f,h,m,g,y,v,_,w;for(y={load:c={},changes:n={}},m=this.__proto__.__sets,r=0,u=m.length;r<u;r++){_=m[r],f=this["_"+_].type.prototype.__props,n[_]=v={},g=t[_];for(a in g){s=g[a],v[a]=i={};for(p in s)d=s[p],i[p]=function(){if("function"==typeof(w=(l=f[p]).type))return e={v:null,s:null},d.v&&o(d,c,w,e,"v"),d.s&&o(d,c,w,e,"s"),e;if(h=l.read)return{v:null===d.v?null:h.call(this,d.v),s:null===d.s?null:h.call(this,d.s)};throw new Error("Unsupported type "+w)}.call(this)}}return y},e.end(),c&&(e.end=function(){var t,e,n;r.end.call(this),e=this.prototype.__props;for(t in e)if(n=e[t],"set"===n.type&&!n.itemType.ds_editable)throw new Error("Type '"+this.name+"': propSet '"+t+"' has non-editable item type")}),e}(r)},{"./DSData":77,"./DSDigest":82,"./DSDocument":83,"./DSHistory":84,"./DSPool":88,"./util":92}],77:[function(t,e,n){var o,r,s,i,a,u,c=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;s=t("./util").assert,i=t("./util").error,u=t("./util").serviceOwner,a=t("./util").modeReleaseDataOnReload,r=t("./DSObject"),e.exports=o=function(t){function e(){return n.apply(this,arguments)}var n;return c(e,t),e.begin("DSData"),e.propObj("params"),e.noCache=function(t){0===arguments.length||t?this.ds_noCache=!0:delete this.ds_noCache},e.addDataSource(function(t,e){var n,o,r,s;for(r=this.__proto__.__sets,n=0,o=r.length;n<o;n++)s=r[n],this["_"+s].set("status",t);return"update"===t&&1===this.$ds_ref&&a&&!this.ds_noCache?void u.remove(this.release(u)):void("nodata"===t&&this.clear())}),e.prototype._startLoad=function(){var t;switch(t=this.get("status")){case"load":return!1;case"update":return!1}return this.set("status",function(){switch(t){case"nodata":return"load";case"ready":return"update"}}()),this.$ds_ref>1},e.prototype._endLoad=function(t){this.set("status",t?"ready":"nodata")},n=function(t,n,o){if(r.call(this,t,n),s){if(this.__proto__.constructor===e)throw new Error("Cannot instantiate DSData directly");"object"!=typeof o&&i.invalidArg("params")}this.set("params",o),this.__busySets=0,a&&!this.__proto__.constructor.ds_noCache&&u.add(this.addRef(u))},e.prototype.clear=function(){var t,e,n,o;for(n=this.__proto__.__sets,t=0,e=n.length;t<e;t++)o=n[t],this["_"+o].clear()},e.prototype.refresh=function(){this.load()},e.end(),e.end=function(){var t,e;r.end.call(this),this.prototype.__sets=function(){var n,o;n=this.prototype.__props,o=[];for(t in n)e=n[t],"set"===e.type&&o.push(t);return o}.call(this)},e}(r)},{"./DSObject":86,"./util":92}],78:[function(t,e,n){var o,r,s,i,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;a=t("./util").assert,c=t("./util").error,s=t("./DSDocument"),o=t("./DSData"),r=t("./DSDigest"),i=t("./DSSet"),u={},e.exports=function(t){var e,n;return a&&(null!==t&&t.ds_editable||c.invalidArg("itemType")),u.hasOwnProperty(t.docType)&&(n=u[t.docType]).itemType===t?n:u[t.name]=e=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var u,d;l(n,e),n.begin("DSDataEditable<"+t.docType+">"),n.propDoc("original",i),n.propDoc("changes",i),n.propSet("items",n.itemType=t),n.ds_dstr.push(function(){"function"==typeof this._unwatchA&&this._unwatchA(),"function"==typeof this._unwatchB&&this._unwatchB(),"function"==typeof this._unwatch1&&this._unwatch1(),"function"==typeof this._unwatch2&&this._unwatch2()}),n.prototype.clear=function(){o.prototype.clear.call(this),"function"==typeof this._unwatch1&&this._unwatch1(),delete this._unwatch1,"function"==typeof this._unwatch2&&this._unwatch2(),delete this._unwatch2},n.$u=u={};for(d in t.__super__.__props)u[d]=!0;return n.prototype.init=function(e,n,o){var l,d,p,f,h,m,g,y;if(a){if(n instanceof i||c.invalidArg("changes"),e instanceof i||c.invalidArg("original"),"function"!=typeof o&&"undefined"!=typeof o&&c.invalidArg("filter"),e.type.ds_editable)throw new Error("'original' expected to have non DSDocument.Editable items");if(t!==n.type)throw new Error("'itemType' and 'changes' must have same DSDocument.Editable type");if(e.type.Editable!==n.type)throw new Error("'original' and 'changes' must base on same DSDocument type");if(!n.hasOwnProperty("$ds_pool"))throw new Error("'changes' must be set instantiated as a field of DSChanges object")}this.set("original",e),this.set("changes",n),f=this.get("itemsSet"),p=f.items,d=n.$ds_pool,m=e.items,l=n.items,h=function(t){return function(){var s,i,c,h,g;t._startLoad(),"function"==typeof t._unwatch1&&t._unwatch1(),t._unwatch1=null,"function"==typeof t._unwatch2&&t._unwatch2(),t._unwatch2=null,h=function(t){if(a&&!d.items.hasOwnProperty(t.$ds_key))throw new Error("Missing editable item");return d.items[t.$ds_key]},c=function(e){var o;return(o=d.find(t,e.$ds_key)).init&&(o.init(e,n),o.$u=u),o},o?(_.forEach(m,function(e){var n;l.hasOwnProperty(n=e.$ds_key)||f.add(t,c(e))}),_.forEach(l,function(e){o.call(t,e)&&f.add(t,e.addRef(t))}),g=function(t){if(a&&!l.hasOwnProperty(t))throw new Error("Missing edtItem");s(l[t])},s=function(e){o.call(t,e)?p.hasOwnProperty(e.$ds_key)||f.add(t,e.addRef(t)):p.hasOwnProperty(e.$ds_key)&&f.remove(e)},i=function(t){return!!l.hasOwnProperty(t.$ds_key)&&(s(h(t)),!0)},t._unwatch1=e.watch(t,{add:function(e){i(e)||f.add(t,c(e))},remove:function(e){i(e)||(f.remove(h(e)),r.forget(t.$ds_key,e.$ds_key))}}),t._unwatch2=n.watch(t,{add:function(e){r.render(t.$ds_key,e.$ds_key,g)},change:function(e){r.render(t.$ds_key,e.$ds_key,g)},remove:function(e){s.call(t,e),r.forget(t.$ds_key,e.$ds_key)}})):(_.forEach(m,function(e){f.add(t,c(e))}),t._unwatch1=e.watch(t,{add:function(e){f.add(t,c(e))},remove:function(t){f.remove(h(t))}})),t._endLoad(!0)}}(this),g=[e,n],y=function(t){return function(e,n){var o,i,a;if(o=!1,(i=s.integratedStatus(g))!==(a=t.get("status")))switch(i){case"ready":o?(o=!1,t._endLoad(!0)):r.block(h);break;case"load":t._startLoad();break;case"update":t._startLoad()&&(o=!0);break;case"nodata":o?(o=!1,t._endLoad(!1)):t.set("status","nodata")}}}(this),this._unwatchA=e.watchStatus(this,y),this._unwatchB=n.watchStatus(this,y),this.init=null},n.end(),n}(o)}},{"./DSData":77,"./DSDigest":82,"./DSDocument":83,"./DSSet":89,"./util":92}],79:[function(t,e,n){var o,r,s,i,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;a=t("./util").assert,c=t("./util").error,s=t("./DSObject"),o=t("./DSData"),r=t("./DSDigest"),i=t("./DSSet"),u={},e.exports=function(t){var e,n;return a&&(s.isAssignableFrom(t)||c.invalidArg("itemType")),u.hasOwnProperty(t.docType)&&(n=u[t.docType]).itemType===t?n:u[t.docType]=e=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var s,u;l(n,e),n.begin("DSDataFiltered<"+t.docType+">"),n.propDoc("original",i),n.propSet("items",n.itemType=t),n.ds_dstr.push(function(){"function"==typeof this._unwatchA&&this._unwatchA(),"function"==typeof this._unwatch1&&this._unwatch1()}),n.prototype.clear=function(){o.prototype.clear.call(this),"function"==typeof this._unwatch1&&this._unwatch1(),delete this._unwatch1},n.$u=s={};for(u in t.__super__.__props)s[u]=!0;return n.prototype.init=function(e,n){var o,s,u,l;if(a&&(e instanceof i||c.invalidArg("original"),"function"!=typeof n&&c.invalidArg("filter"),t!==e.type))throw new Error("'itemType' and 'original' must have same DSObject type");this.set("original",e),s=this.get("itemsSet"),o=s.items,l=e.items,u=function(t){return function(){var i,a,u;t._startLoad(),"function"==typeof t._unwatch1&&t._unwatch1(),t._unwatch1=null;for(a in l)i=l[a],n(i)&&(i.addRef(t),s.add(t,i));u=function(e){o.hasOwnProperty(e)?n(i=l[e])||s.remove(i):n(i=l[e])&&(i.addRef(t),s.add(t,i))},t._unwatch1=e.watch(t,{add:function(e){r.render(t.$ds_key,e.$ds_key,u)},change:function(e){r.render(t.$ds_key,e.$ds_key,u)},remove:function(e){s.remove(e),r.forget(t.$ds_key,e.$ds_key)}}),t._endLoad(!0)}}(this),this._unwatchA=e.watchStatus(this,function(t){return function(n,o){var s,i,a;if(s=!1,(i=e.get("status"))!==(a=t.get("status")))switch(i){case"ready":s?(s=!1,t._endLoad(!0)):r.block(u);break;case"load":t._startLoad();break;case"update":t._startLoad()&&(s=!0);break;case"nodata":s?(s=!1,t._endLoad(!1)):t.set("status","nodata")}}}(this)),this.init=null},n.end(),n}(o)}},{"./DSData":77,"./DSDigest":82,"./DSObject":86,"./DSSet":89,"./util":92}],80:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("./util").assert,a=t("./util").error,r=t("./DSObject"),s=t("./DSPool"),e.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("DSDataService"),e.prototype.findDataSet=function(t,e){i&&("object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"object"==typeof e&&null!==e&&e.hasOwnProperty("type")||a.invalidArg("params"),e.hasOwnProperty("mode")&&["original","edited","changes"].indexOf(e.mode)>=0||a.invalidArg("params.mode"))},e.prototype.requestSources=function(t,e,n){var o,s,u,c;if(i){"object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"object"!=typeof e&&a.invalidArg("params"),"object"==typeof n&&null!==n||a.invalidArg("sources");for(o in n){u=n[o],"object"==typeof u&&null!==u||a.invalidArg("sources");for(s in u)switch(c=u[s],s){case"name":break;case"type":!c instanceof r&&a.invalidArg("sources");break;case"set":!c instanceof r&&a.invalidArg("sources");break;case"params":"object"==typeof c&&null!==c||a.invalidArg("sources");break;case"watch":break;case"unwatch":break;case"unwatchStatus":break;case"listener":break;case"index":break;default:a.invalidArg("sources")}}}},e.end(),e}(r)},{"./DSObject":86,"./DSPool":88,"./util":92}],81:[function(t,e,n){var o,r,s,i,a,u,c,l,d=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;e.exports=(c=angular.module("dscommon/DSDataSource",[])).name,l=t("./util").serviceOwner,u=t("./util").modeReleaseDataOnReload,s=t("./util").assert,a=t("./util").error,i=t("../utils/base64"),r=t("./DSObject"),o=t("./DSDigest"),c.factory("DSDataSource",["config","$rootScope","$q","$http",function(t,e,n,u){var c;return c=function(n){function c(){return l.apply(this,arguments)}var l;return d(c,n),c.begin("DSDataSource"),c.addDataSource(),c.setLoadAndRefresh=function(t){var e;return this.set("source",e=t.get("dataSource")),e.watchStatus(this,function(t){return function(e,n,r){switch(n){case"ready":o.block(function(){return t.load()});break;case"nodata":t.set("status","nodata")}}}(this))},l=function(n,o){r.call(this,n,o),this.cancelDefers=[],this._lastRefresh=null,this._refreshTimer=null,e.$watch(function(){return t.refreshPeriod},function(t){return function(e){t._setNextRefresh()}}(this))},c.prototype.setConnection=function(t,e){var n,o,r,u;if(s&&(null===t||"string"==typeof t&&t.length>0||a.invalidArg("url"),"undefined"==typeof e||null===e||"string"==typeof e&&e.length>0||a.invalidArg("token")),t&&("undefined"==typeof e||e)){if(this.url!==t||this.token!==e){for(u=this.cancelDefers,o=0,r=u.length;o<r;o++)n=u[o],n.resolve();this.cancelDefers.length=0,this.set("status","nodata"),this.url=t,this.authHeader=e?"Basic "+i.encode(e):null,this.set("status","ready")}}else this.set("status","nodata")},c.prototype._setNextRefresh=function(){var e,n,o;null!==this._refreshTimer&&clearTimeout(this._refreshTimer),null!==t.refreshPeriod&&(o=null===this._lastRefresh?0:(n=this._lastRefresh.add(t.refreshPeriod,"minutes"),e=moment(),n>=e?n-e:0),this._refreshTimer=setTimeout(function(t){return function(){t.refresh()}}(this),o))},c.prototype.refresh=function(){this._lastRefresh=moment(),this._setNextRefresh(),"ready"===this.get("status")&&(this.set("status","update"),this.set("status","ready"))},c.prototype.httpGet=function(t,e){var n,o;return this.cancelDefers.push(e),o=function(t){return function(n){return _.remove(t.cancelDefers,e),n}}(this),n={timeout:e.promise},this.authHeader&&(n.headers={Authorization:this.authHeader}),u.get(""+this.url+t,n).then(o,o)},c.prototype.httpPost=function(t,e,n){var o,r;return this.cancelDefers.push(n),r=function(t){return function(e){return _.remove(t.cancelDefers,n),e}}(this),o={timeout:n.promise},this.authHeader&&(o.headers={Authorization:this.authHeader}),u.post(""+this.url+t,e,o).then(r,r)},c.prototype.httpPut=function(t,e,n){var o,r;return this.cancelDefers.push(n),r=function(t){return function(e){return _.remove(t.cancelDefers,n),e}}(this),o={timeout:n.promise},this.authHeader&&(o.headers={Authorization:this.authHeader}),u.put(""+this.url+t,e,o).then(r,r)},c.end(),c}(r)}])},{"../utils/base64":94,"./DSDigest":82,"./DSObject":86,"./util":92}],82:[function(t,e,n){var o,r,s;r=t("./util").assert,s=t("./util").error,e.exports=o=function(){function t(){}var e,n,o,i;return n=0,e=0,o={},i=function(){var t,n,r,s,a,u,c;s=!0;for(a in o){s=!1;break}if(!s){e++,c=o,o={};for(t in c){n=c[t];for(u in n)(r=n[u])(u)}e--,i()}},t.block=function(t){e++;try{return t()}finally{0===--e&&i()}},t.render=function(t,n,i){var a;r&&("string"==typeof t&&t.length>0||s.invalidArg("dataDataKey"),"string"==typeof n&&n.length>0||s.invalidArg("key"),"function"!=typeof i&&s.invalidArg("func")),0===e?i(n):(a=o.hasOwnProperty(t)?o[t]:o[t]={},a[n]=i)},t.forget=function(t,n){var i;r&&("string"==typeof t&&t.length>0||s.invalidArg("dataDataKey"),"string"==typeof n&&n.length>0||s.invalidArg("key")),0!==e&&o.hasOwnProperty(t)&&(i=o[t],delete i[n])},t}()},{"./util":92}],83:[function(t,e,n){var o,r,s,i,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;a=t("./util").assert,u=t("./util").error,c=t("./util").traceRefs,s=t("./DSObjectBase"),r=t("./DSObject"),i=t("./DSSet"),e.exports=o=function(t){function e(t,n){if(e.__super__.constructor.call(this,t,n),a&&this.__proto__.constructor===e)throw new Error("Cannot instantiate DSDocument directly")}return l(e,t),e.begin("DSDocument"),e.propPool=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.propSet=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.propList=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.end(),e.end=function(){var t,e;r.end.call(this),e=this,this.Editable=t=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}var o,d,p,f,h,m,g;l(n,t),n.begin(e.docType+".Editable"),delete n.prototype.$ds_docType,n.ds_editable=!0,o=null,h=n.__super__.__init;for(d in h)g=h[d],e.prototype.__props[d.substr(1)].calc&&((o||(o={}))[d]=g);n.prototype.__init=o,n.ds_dstr.push(function(){var t,e,n,o;if(a&&(_.find(this.$ds_doc.$ds_evt,function(t){return function(e){return e===t}}(this))||console.error("Not an event listener")),_.remove(this.$ds_doc.$ds_evt,this),this.$ds_doc.release(this),t=this.__change)for(n in t)e=t[n],(o=e.s)instanceof s&&o.release(this),(g=e.v)instanceof s&&g.release(this)}),n.prototype.init=function(t,n,o){var r,l,d,p,f,h,m,g,y,v;if(a&&(null!==t&&t.__proto__.constructor===e||u.invalidArg("serverDoc"),null!==n&&n instanceof i||u.invalidArg("changesSet"),2!==arguments.length&&"object"!=typeof o&&u.invalidArg("changes")),(this.$ds_doc=t).addRef(this),this.$ds_chg=n,this.__change=o){m=!1;for(y in o)g=o[y],this.__props[y].equal(t.get(y),g.v)?delete o[y]:m=!0;if(m){if(c){h=[];for(y in o)r=o[y],r.v instanceof s&&h.push(r.v),r.s instanceof s&&h.push(r.s);for(l=0,f=h.length;l<f;l++)p=h[l],v=p.$ds_referries,0===v.length?console.error(s.desc(p)+": Empty $ds_referries"):(d=v.lastIndexOf(owner))<0?(console.error(s.desc(this)+": Referry not found: "+s.desc(owner)),totalReleaseVerb):(totalReleaseVerb&&(console.info(++util.serviceOwner.msgCount+": transfer: "+s.desc(p)+", refs: "+this.$ds_ref+", from: "+s.desc(owner)+", to: "+s.desc(this)),util.serviceOwner.msgCount===window.totalBreak),v[d]=this)}this.addRef(this),n.add(this,this)}else delete this.__change}t.hasOwnProperty("$ds_evt")?(a&&_.find(t.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),t.$ds_evt.push(this)):t.$ds_evt=[this],this.init=null},n.prototype.__onChange=function(t,e,n,o){var r,i,a,u,c,l,d,p,f,h,m,g;if((p=t.__props[e]).common){if(this.$ds_evt)for(f=this.$ds_evt,a=f.length-1;a>=0;a+=-1)d=f[a],d.__onChange.call(d,this,e,n,o)}else if((r=this.__change)&&r.hasOwnProperty(e)){if(p.equal(g=(p=r[e]).v,n)){for((m=p.s)instanceof s&&m.release(this),g instanceof s&&g.release(this),delete r[e],i=!0,u=0,l=r.length;u<l;u++)if(e=r[u],"__error"!==e&&"__refreshView"!==e){i=!1;break}i&&(delete this.__change,this.$ds_chg.remove(this))}}else if(this.$ds_evt)for(h=this.$ds_evt,c=h.length-1;c>=0;c+=-1)d=h[c],d.__onChange.call(d,this,e,n,o)},n.prototype._clearChanges=function(){var t,e,n,o,r,i,a;if(t=this.__change){for(r in t){if(o=t[r],this.$ds_evt)for(i=this.$ds_evt,e=i.length-1;e>=0;e+=-1)n=i[e],n.__onChange.call(n,this,r,this.$ds_doc[r],o.v);(a=o.s)instanceof s&&a.release(this),(g=o.v)instanceof s&&g.release(this)}delete this.__change,this.$ds_chg.remove(this)}},f=n.prototype.__props=e.prototype.__props,n.prototype.get=function(t){return a&&(f.hasOwnProperty(t)||u.invalidProp(this,t)),this[t]},n.prototype.set=function(t,e){return a&&(f.hasOwnProperty(t)||u.invalidProp(this,t)),this[t]=e},m=e.prototype.__props;for(d in m)p=m[d],p.calc||!function(t,e,o){var r;return p.common?Object.defineProperty(n.prototype,t,{get:function(){return this.$ds_doc[t]},set:function(e){var n;(n=this.$ds_doc[t])!==e&&(this.$ds_doc[t]=e,this.$ds_chg.$ds_hist.add(this,t,e,n))}}):Object.defineProperty(n.prototype,t,{get:r=function(){var e;return e=this.__change,e&&e.hasOwnProperty(t)?e[t].v:this.$ds_doc[t]},set:function(n){var i,c,l,p,f,h,m,y,v,_,w;if(a&&"undefined"==typeof(n=e(g=n))&&u.invalidValue(this,t,g),!o(m=r.call(this),n)){if(n instanceof s&&n.addRef(this),i=this.__change)if(o(w=this.$ds_doc[t],n)){this.$ds_chg.$ds_hist.add(this,t,n,(c=i[t]).v),(g=c.v)instanceof s&&g.release(this),(_=c.s)instanceof s&&_.release(this),delete i[t],l=!0;for(d in i)if("__error"!==d&&"__refreshView"!==d){l=!1;break}if(l){if(this.$ds_evt)for(y=this.$ds_evt,p=y.length-1;p>=0;p+=-1)h=y[p],h.__onChange.call(h,this,t,n,m);return delete this.__change,void this.$ds_chg.remove(this)}}else(c=i[t])?(this.$ds_chg.$ds_hist.add(this,t,n,c.v),(g=c.v)instanceof s&&g.release(this),c.v=n):(w instanceof s&&w.addRef(this),i[t]={v:n,s:w},this.$ds_chg.$ds_hist.add(this,t,n,m));else i=this.__change={},m instanceof s&&m.addRef(this),i[t]={v:n,s:m},this.addRef(this),this.$ds_chg.add(this,this),this.$ds_chg.$ds_hist.add(this,t,n,m);if(this.$ds_evt)for(v=this.$ds_evt,f=v.length-1;f>=0;f+=-1)h=v[f],h.__onChange.call(h,this,t,n,m)}}})}(p.name,p.valid,p.equal);return r.end.call(n),n}(e)},e}(r)},{"./DSObject":86,"./DSObjectBase":87,"./DSSet":89,"./util":92}],84:[function(t,e,n){var o,r,s,i,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;u=t("./util").assert,c=t("./util").error,a=t("./DSObjectBase"),i=t("./DSObject"),o=t("./DSDigest"),r=t("./DSDocument"),e.exports=s=function(t){function e(){return d.apply(this,arguments)}var n,r,s,d,p,f;return l(e,t),e.begin("DSHistory"),e.ds_dstr.push(function(){n.call(this)}),d=function(t,e){i.call(this,t,e),this.hist=[],this.histTop=0},n=function(){var t,e,n,o,r;for(o=this.hist,e=0,n=o.length;e<n;e++)t=o[e],t.i.release(this),"object"==typeof(r=t.o)&&r instanceof a&&r.release(this),"object"==typeof(r=t.n)&&r instanceof a&&r.release(this);this.hist=[],this.histTop=0},f=!1,s=null,r=0,e.prototype.startBlock=function(){s=++r},e.prototype.endBlock=function(){s=null},e.prototype.startReset=function(){f=!0,n.call(this)},e.prototype.endReset=function(){f=!1},e.prototype.add=function(t,e,n,o){var r,i,l,d,p,h,m,g,y,v,_;if(u&&(null!==t&&t.__proto__.constructor.ds_editable||c.invalidArg("item"),"string"==typeof e&&e.length>0||c.invalidArg("prop"),0<=["string","number","boolean","object","undefined"].indexOf(typeof n)||c.invalidArg("newVal"),0<=["string","number","boolean","object","undefined"].indexOf(typeof o)||c.invalidArg("oldVal")),!f){if((d=this.hist).length>this.histTop){for(y=d.slice(this.histTop),h=0,m=y.length;h<m;h++)l=y[h],l.i.release(this),"object"==typeof(_=l.o)&&_ instanceof a&&_.release(this),"object"==typeof(_=l.n)&&_ instanceof a&&_.release(this);d.length=this.histTop}if(t.addRef(this),n instanceof a&&n.addRef(this),o instanceof a&&o.addRef(this),d.push(g={i:t,p:e,n:n,o:o}),s&&(g.b=s),(this.histTop=p=d.length)>200){for(i=-1;;){for(r=d[++i].b;++i<p&&(l=d[i]).b===r;)(v=l.n)instanceof a&&v.release(this),(v=l.o)instanceof a&&v.release(this);if(p-i<=200)break}this.hist=d=d.slice(i),this.histTop=d.length}}},e.prototype.setSameAsServer=function(t,e){var n,o,r,s,i;for(u&&(null!==t&&t.__proto__.constructor.ds_editable||c.invalidArg("item"),"string"==typeof e&&e.length>0||c.invalidArg("prop")),s=this.hist.slice(0,this.histTop),o=r=s.length-1;r>=0;o=r+=-1)if(n=s[o],n.i===t&&n.p===e){"object"==typeof(i=n.n)&&i instanceof a&&i.release(this),"undefined"==typeof n.o?(t.release(this),this.hist.splice(o,1),this.histTop--):n.n=void 0;break}},e.prototype.hasUndo=function(){return this.histTop>0},e.prototype.undo=function(){var t,e,n,r,s;if((r=this.histTop)>0){f=!0;try{e=(n=this.hist)[this.histTop=--r],"number"!=typeof(t=e.b)||0===r||n[r-1].b!==t?"undefined"==typeof(s=e.o)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,s):o.block(function(o){return function(){for(;;){if("undefined"==typeof(s=e.o)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,s),0===r||(e=n[r-1]).b!==t)break;o.histTop=--r}}}(this))}finally{f=!1}}},e.prototype.hasRedo=p=function(){return this.histTop<this.hist.length},e.prototype.redo=function(){var t,e,n,r,s,i;if(f=!0,(r=this.histTop)<(s=(n=this.hist).length)){f=!0;try{e=n[r],this.histTop=++r,"number"!=typeof(t=e.b)||r===s||n[r].b!==t?"undefined"==typeof(i=e.n)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,i):o.block(function(o){return function(){for(;;){if("undefined"==typeof(i=e.n)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,i),r===s||(e=n[r]).b!==t)break;o.histTop=++r}}}(this))}finally{f=!1}}},e.end(),e}(i)},{"./DSDigest":82,"./DSDocument":83,"./DSObject":86,"./DSObjectBase":87,"./util":92}],85:[function(t,e,n){var o,r,s,i,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;c=t("./util"),s=t("./util").assert,u=t("./util").traceRefs,a=t("./util").totalReleaseVerb,i=t("./util").error,r=t("./DSObjectBase"),e.exports=o=function(t){function e(){return n.apply(this,arguments)}var n;return l(e,t),e.begin("DSList"),n=function(t,e,n){r.call(this,t,e),s&&!n instanceof r&&i.notDSObjectClass(n),this.type=n,this.items=[]},e.ds_dstr.push(function(){var t,e,n,o;for(n=this.items,t=0,e=n.length;t<e;t++)o=n[t],o.release(this)}),e.prototype.merge=function(t,e){var n,o,l,d,p,f,h,m,g,y;for(s&&("object"==typeof t&&t!==window||"function"==typeof t||i.invalidArg("owner"),_.isArray(e)||i.invalidArg("newList")),d=this.items,y=this.type,p=0,h=d.length;p<h;p++)l=d[p],l.release(this);for(d.length=0,n=f=0,m=e.length;f<m;n=++f)l=e[n],!l instanceof y&&i.invalidListValue(this,n,l),u&&(g=l.$ds_referries,0===g.length?console.error(r.desc(DSDitem)+": Empty $ds_referries"):(o=g.lastIndexOf(t))<0?console.error(r.desc(this)+": Referry not found: "+r.desc(t)):(a&&(console.info(++c.serviceOwner.msgCount+": transfer: "+r.desc(l)+", refs: "+this.$ds_ref+", from: "+r.desc(t)+", to: "+r.desc(this)),c.serviceOwner.msgCount===window.totalBreak),g[o]=this)),d.push(l);return d},e.end(),e}(r)},{"./DSObjectBase":87,"./util":92}],86:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p=function(t,e){function n(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;u=t("./util").assert,l=t("./util").serviceOwner,d=t("./util").totalRelease,l=t("./util").serviceOwner,c=t("./util").error,s=t("./DSObjectBase"),a=t("./DSSet"),o=t("./DSList"),i=t("./DSPool"),e.exports=r=function(t){function e(){return n.apply(this,arguments)}var n;return p(e,t),e.desc=s.desc=function(t){return t.hasOwnProperty("$ds_key")?t instanceof a||t instanceof o||t instanceof i?d?t.$ds_key+"("+t.$ds_globalId+")":t.$ds_key:d?t.$ds_key+":"+t.__proto__.constructor.docType+"("+t.$ds_globalId+")":t.$ds_key+":"+t.__proto__.constructor.docType:t===l?"util.serviceOwner":"function"==typeof t?t.docType:t.$evalAsync&&t.$watch?"$scope{$id: "+t.$id+"}":JSON.stringify(t)},n=function(t,e){if(s.call(this,t,e),u&&this.__proto__.constructor===s)throw new Error("Cannot instantiate DSObjectBsse directly")},e.addPool=function(t){d?Object.defineProperty(this,"pool",{get:function(e){return function(){return e.hasOwnProperty("__pool")||(e.__pool=new i(l,e.docType+".pool",e,t),l.clearPool(function(){e.__pool.release(l),delete e.__pool})),e.__pool}}(this)}):this.pool=new i(l,this.docType+".pool",this,t)},e.propPool=function(t,e,n){var o,r;return u&&(s.isAssignableFrom(e)||c.invalidArg("itemType")),o="_"+t,this.ds_dstr.push(function(){this[o].release(this),delete this[o]}),(r=this.prop({name:t,type:"pool",init:function(){return new i(this,this.$ds_key+"."+t+":pool<"+e.docType+">",e,n)},readonly:!0})).itemType=e,r},e.propSet=function(t,e){var n,o;return u&&(s.isAssignableFrom(e)||c.invalidArg("itemType")),n="_"+t,this.ds_dstr.push(function(){this[n].release(this)}),(o=this.prop({name:t,type:"set",init:function(){return new a(this,this.$ds_key+"."+t+":set<"+e.docType+">",e,this)},get:function(){return this[n].items},set:function(e){throw new Error("Use "+t+"Set.merge() instead")},readonly:!0})).itemType=e,this.prop({name:t+"Status",type:"calc",func:function(){return this[n].get("status")}}),this.prop({name:t+"Set",type:"calc",func:function(){return this[n]}}),o},e.propList=function(t,e){var n,r;return u&&(s.isAssignableFrom(e)||c.invalidArg("itemType")),n="_"+t,this.ds_dstr.push(function(){
this[n].release(this)}),(r=this.prop({name:t,type:"list",init:function(){return new o(this,this.$ds_key+"."+t+":list<"+e.docType+">",e)},get:function(){return this[n].items},set:function(e){throw new Error("Use "+t+"Set.merge() instead")},readonly:!0})).itemType=e,this.prop({name:t+"List",type:"calc",func:function(){return this[n]}}),r},e}(s)},{"./DSList":85,"./DSObjectBase":87,"./DSPool":88,"./DSSet":89,"./util":92}],87:[function(t,e,n){var o,r,s,i,a,u,c,l,d;d=t("./util"),r=t("./util").assert,c=t("./util").traceData,i=t("./util").serviceOwner,l=t("./util").traceRefs,a=t("./util").totalRelease,u=t("./util").totalReleaseVerb,s=t("./util").error,e.exports=o=function(){function t(){return e.apply(this,arguments)}var e,n,o,i,p,f,h;return t.isAssignableFrom=function(t){var e;if("function"!=typeof t&&s.invalidArg("clazz"),(e=t)===this)return!0;for(;;){if(!e.hasOwnProperty("__super__"))return!1;if(e=e.__super__.constructor,e===this)return!0}},a&&(h=n=null,(window.totalReleaseReset=function(){n=0,window.totalPool=h={},d.serviceOwner.start(),d.serviceOwner.msgCount=0})(),window.totalRelease=function(){return d.serviceOwner.stop(),h}),e=function(e,o){var i,c,p;if(r){if(this.__proto__.constructor===t)throw new Error("Cannot instantiate DSObjectBаse directly");"object"==typeof e&&e!==window||"function"==typeof e||s.invalidArg("referry"),"string"!=typeof o&&s.invalidArg("key")}if(this.$ds_key=o,this.$ds_ref=1,a&&(h[this.$ds_globalId=++n]=this,u&&(console.info(++d.serviceOwner.msgCount+": ctor: "+t.desc(this)+", refs: 1, ref: "+t.desc(e)),d.serviceOwner.msgCount===window.totalBreak)),l&&(this.$ds_referries=[e]),i=this.__proto__.__init)for(c in i)p=i[c],this[c]="function"==typeof p?p.call(this):p;this.__proto__._init.call(this)},t.prototype.addRef=function(e){if(r&&("object"==typeof e&&e!==window||"function"==typeof e||s.invalidArg("referry")),0===this.$ds_ref)throw new Error("addRef() on already fully released object");return l&&this.$ds_referries.push(e),this.$ds_ref++,u&&(console.info(++d.serviceOwner.msgCount+":addRef: "+t.desc(this)+", refs: "+this.$ds_ref+", ref: "+t.desc(e)),d.serviceOwner.msgCount===window.totalBreak),this},t.prototype.release=function(e){var n,o;if(r&&("object"==typeof e&&e!==window||"function"==typeof e||s.invalidArg("referry")),u&&(console.info(++d.serviceOwner.msgCount+": release: "+t.desc(this)+", refs: "+(this.$ds_ref-1)+", ref: "+t.desc(e)),d.serviceOwner.msgCount===window.totalBreak),0===this.$ds_ref)throw new Error("release() on already fully released object");if(l&&((n=this.$ds_referries.indexOf(e))<0?console.error(t.desc(this)+": Referry not found: "+t.desc(e)):this.$ds_referries.splice(n,1)),0===--this.$ds_ref&&(this.hasOwnProperty("$ds_pool")&&((o=this.$ds_pool).watchOn&&(r&&(_.find(this.$ds_evt,function(t){return function(t){return t===o}}(this))||console.error("Not an event listener")),_.remove(this.$ds_evt,o)),delete this.$ds_pool.items[this.$ds_key]),this.__proto__._dstr.call(this),a)){if(!this.hasOwnProperty("$ds_globalId"))throw new Error("Missing $ds_globalId, which means that something really wrong is going on");if(!h.hasOwnProperty(this.$ds_globalId))throw new Error(t.desc(this)+": Object already not in the totalPool");delete h[this.$ds_globalId]}return this},t.prototype.toString=function(){return this.__proto__.$ds_docType+"@"+this.$ds_key+("object"==typeof this.$ds_pool?" <- "+this.$ds_pool:"")},t.prototype.toJSON=function(){return this.__proto__.$ds_docType+"@"+this.$ds_key},t.prototype.writeMap=function(){var t,e,n,o;o={},n=this.__proto__.__props;for(e in n)t=n[e],t.write&&(o[e]=t.write(this["_"+e]));return o},t.prototype.readMap=function(e){var n,o,r,s,i;r=this.__proto__.__props;for(o in e)i=e[o],r.hasOwnProperty(o)&&(n=r[o]).read?(this[o]=s=n.read.call(this,i),s instanceof t&&s.release(this)):console.error("Unexpected property "+o)},t.begin=function(t){var e;r&&"string"!=typeof t&&s.invalidArg("name"),e=this,this.prototype.$ds_docType=this.docType=t,this.ds_ctor=this.__super__.constructor.hasOwnProperty("ds_ctor")?_.clone(this.__super__.constructor.ds_ctor):[],this.ds_dstr=this.__super__.constructor.hasOwnProperty("ds_dstr")?_.clone(this.__super__.constructor.ds_dstr):[]},t.end=function(){var t,e;0===this.ds_ctor.length?this.prototype._init=_.noop:(t=this.ds_ctor,this.prototype._init=function(){var e,n,o;for(n=0,o=t.length;n<o;n++)e=t[n],e.call(this)}),0===this.ds_dstr.length?this.prototype._dstr=_.noop:(e=this.ds_dstr,this.prototype._dstr=function(){var t,n;for(n=e.length-1;n>=0;n+=-1)t=e[n],t.call(this)})},t.prop=function(t){var e,n,o,i,a,u,c,l,d,p;if(r){if("object"!=typeof t&&s.invalidArg("opts"),!t.hasOwnProperty("name"))throw new Error("Missing opts.name");if(!("string"==typeof t.name&&t.name.length>0))throw new Error("Invalid value of opts.name");if(!t.hasOwnProperty("type"))throw new Error("Missing opts.type");if(!("string"==typeof t.type&&t.type.length>0||"function"==typeof t.type))throw new Error("Invalid value of opts.type");if(t.hasOwnProperty("readonly")&&"boolean"!=typeof t.readonly)throw new Error("Invalid value of opts.readonly");if("undefined"!=typeof t.calc&&"boolean"!=typeof t.calc)throw new Error("Invalid value of opts.calc");if("undefined"!=typeof t.common&&"boolean"!=typeof t.common)throw new Error("Invalid value of opts.common");if(t.hasOwnProperty("func")&&"function"!=typeof t.func)throw new Error("Invalid value of opts.func");if(t.hasOwnProperty("value")&&"function"==typeof t.value)throw new Error("Invalid value of opts.value");if(t.hasOwnProperty("init")&&!t.readonly&&!t.calc&&!t.hasOwnProperty("valid"))throw new Error("Missing opts.valid");if(t.hasOwnProperty("valid")&&(t.readonly||!t.hasOwnProperty("init")))throw new Error("Unexpected opts.valid");if(t.hasOwnProperty("valid")&&void 0===t.valid("function"==typeof(o=t.init)?o():o))throw new Error("Invalid init value: "+t.init);if(t.hasOwnProperty("valid")&&"function"!=typeof t.valid)throw new Error("Invalid value of opts.valid");if(t.hasOwnProperty("write")&&t.write&&"function"!=typeof t.write)throw new Error("Invalid value of opts.write");if(t.hasOwnProperty("read")&&t.read&&"function"!=typeof t.read)throw new Error("Invalid value of opts.read");if(t.hasOwnProperty("equal")&&"function"!=typeof t.equal)throw new Error("Invalid value of opts.equal");if(t.hasOwnProperty("str")&&"function"!=typeof t.str)throw new Error("Invalid value of opts.str");if(t.hasOwnProperty("get")&&"function"!=typeof t.get)throw new Error("Invalid value of opts.get");if(t.hasOwnProperty("set")&&"function"!=typeof t.set)throw new Error("Invalid value of opts.set");if(t.hasOwnProperty("readonly")&&!t.readonly&&t.hasOwnProperty("calc")&&t.calc)throw new Error("Ambiguous opts.readonly and opts.calc");if(t.hasOwnProperty("readonly")&&!t.readonly&&t.hasOwnProperty("common")&&t.common)throw new Error("Ambiguous opts.readonly and opts.common");if(t.hasOwnProperty("calc")&&t.calc&&t.hasOwnProperty("common")&&t.common)throw new Error("Ambiguous opts.calc and opts.common")}if(this.prototype.hasOwnProperty("__init")?r&&this.prototype.__props.hasOwnProperty(t.name)&&s.duplicatedProperty(this,t.name):(this.prototype.__init=(l=this.__super__.__init)?_.clone(l):{},c=this.prototype.__props=(d=this.__super__.__props)?_.clone(d):{},this.prototype.get=function(t){return r&&(c.hasOwnProperty(t)||s.invalidProp(this,t)),this[t]},this.prototype.set=function(t,e){return r&&(c.hasOwnProperty(t)||s.invalidProp(this,t)),this[t]=e}),u=this.prototype.__props[t.name]={name:t.name,index:_.size(this.prototype.__props),type:t.type,write:t.write||(t.hasOwnProperty("write")&&!t.write||t.calc||t.common?null:function(t){return null===t?null:t.valueOf()}),read:t.read||(t.hasOwnProperty("read")&&!t.read||t.calc||t.common?null:function(t){return t}),equal:e=t.equal||function(t,e){return(null!=t?t.valueOf():void 0)===(null!=e?e.valueOf():void 0)},str:t.str||function(t){return null===t?"":t.toString()},readonly:t.readonly||!1,calc:t.calc||!1,common:t.common||!1},t.hasOwnProperty("init"))p=u.valid=t.valid,u.init=this.prototype.__init[i="_"+(a=t.name)]=t.init,t.calc&&(t.readonly===!0,this.prototype["__setCalc"+(a.substr(0,1).toUpperCase()+a.substr(1))]=function(t){var n,o,r,u,c;if("undefined"==typeof(t=p(c=t))&&s.invalidValue(this,a,c),!e(u=this[i],t)&&(this[i]=t,n=this.$ds_evt))for(o=n.length-1;o>=0;o+=-1)r=n[o],r.__onChange.call(r,this,a,t,u)}),Object.defineProperty(this.prototype,a,{get:t.get||function(){return this[i]},set:t.set||(t.readonly?function(t){s.propIsReadOnly(this,a)}:function(t){var n,o,r,u,c;if("undefined"==typeof(t=p(c=t))&&s.invalidValue(this,a,c),!e(u=this[i],t)&&(this[i]=t,n=this.$ds_evt))for(o=n.length-1;o>=0;o+=-1)r=n[o],r.__onChange.call(r,this,a,t,u)})});else if(t.hasOwnProperty("value"))u.value=t.value,u.readonly=!0,Object.defineProperty(this.prototype,t.name,{value:t.value});else{if(!t.hasOwnProperty("func"))throw new Error("Missing get value");u.func=n=t.func,u.readonly=!0,Object.defineProperty(this.prototype,a=t.name,{get:t.get||function(){return n.call(this)},set:t.set||function(t){s.propIsReadOnly(this,a)}})}return u},t.propSimple=function(t,e,n){var o,i;return r&&("number"!==t&&"boolean"!==t&&"string"!==t&&"object"!==t&&s.invalidArg("type"),"string"!=typeof e&&s.invalidArg("name")),i=(o=i)?function(e){return null!==e&&typeof e!==t||void 0===(e=o(e))?void 0:e}:function(e){return null===e||typeof e===t?e:void 0},this.prop(_.assign({name:e,type:t,init:"undefined"==typeof init||null===init?null:"function"==typeof init||"object"!==t?init:function(){return _.clone(init)},valid:i,write:n&&(n.calc||n.common)?null:function(t){return t},read:function(t){return t},equal:function(t,e){return t===e},str:function(t){return null===t?"":t.toString()}},n))},t.propNum=function(t,e){this.propSimple("number",t,e)},t.propBool=function(t,e){return this.propSimple("boolean",t,e)},t.propStr=function(t,e){return this.propSimple("string",t,e)},t.propObj=function(t,e){return this.propSimple("object",t,e)},t.propDoc=function(e,n,o){var i,a,u;return r&&(u&&"function"!=typeof u&&s.invalidArg("valid"),"function"!=typeof n&&s.invalidArg("type"),!n instanceof t&&s.notDSObjectClass(n)),u=(a=u)?function(t){return(null===t||t instanceof n)&&void 0!==(t=a(t))?t:void 0}:function(t){return null===t||t instanceof n?t:void 0},i="_"+e,this.ds_dstr.push(function(){this[i]&&this[i].release(this)}),this.prop(_.assign({name:e,type:n,init:null,valid:u,write:o&&(o.calc||o.common)?null:function(t){return null!==t?t.$ds_key:null},read:function(t){return null},equal:function(t,e){return t===e},str:"function"==typeof n.str?n.str:function(t){return null===t?"":t.$ds_key},set:function(t){var n,o,r,a,c;if("undefined"==typeof(t=u(c=t))&&s.invalidValue(this,e,c),(a=this[i])!==t){if(this[i]=t,t&&t.addRef(this),n=this.$ds_evt)for(o=n.length-1;o>=0;o+=-1)r=n[o],r.__onChange.call(r,this,e,t,a);a&&a.release(this)}}},o))},t.propCalc=function(t,e,n){return r&&(e&&"function"==typeof e||s.invalidArg("func")),this.prop(_.assign({name:t,type:"calc",func:e},n))},t.propConst=function(t,e,n){return r&&"undefined"==typeof e&&s.invalidArg("value"),this.prop(_.assign({name:t,type:"const",value:e},n))},t.propEnum=function(t,e,n){var o,i,a,u,c,l;if(r)for(_.isArray(e)&&0!==e.length||s.invalidArg("values"),o=0,i=e.length;o<i;o++)c=e[o];return l=(u=l)?function(t){return(null===t||e.indexOf(t)>=0)&&u(t)?t:void 0}:function(t){return null===t||e.indexOf(t)>=0?t:void 0},a="_"+t,this.prop(_.assign({name:t,type:"enum",init:e[0],valid:l,set:function(e){var n,o,r,i,u;if("undefined"==typeof(e=l(u=e))&&s.invalidValue(this,t,u),(r=this[a])!==e&&(this[a]=e,this.$ds_evt))for(i=this.$ds_evt,n=i.length-1;n>=0;n+=-1)o=i[n],o.__onChange.call(o,this,t,e,r)}},n))},t.propMoment=function(t,e,n){var o;return r&&e&&"function"!=typeof e&&s.invalidArg("valid"),e=(o=e)?function(t){return(null===t||"object"==typeof t&&moment.isMoment(t))&&o(t)?t:void 0}:function(t){return null===t||moment.isMoment(t)?t:void 0},this.prop(_.assign({name:t,type:"moment",valid:e,read:function(t){return null!==t?moment(t):null},init:null},n))},t.propDuration=function(t,e,n){var o;return r&&e&&"function"!=typeof e&&s.invalidArg("valid"),e=(o=e)?function(t){return(null===t||"object"==typeof t&&moment.isDuration(t))&&o(t)?t:void 0}:function(t){return null===t||moment.isDuration(t)?t:void 0},this.prop(_.assign({name:t,type:"duration",valid:e,read:function(t){return null!==t?moment.duration(t):null},init:null},n))},t.onAnyPropChange=function(t){r&&"function"!=typeof t&&s.invalidArg("listener"),this.ds_ctor.push(function(){var e;e={__onChange:function(e){return function(){t.apply(e,arguments)}}(this)},this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(e):this.$ds_evt=[e]})},f=["nodata","load","update","ready"],p=["ready","update","nodata","load"],t.integratedStatus=function(t){var e,n,o,i,a;for(r&&(_.isArray(t)&&_.some(t,function(t){return t.__proto__.constructor.ds_dataSource})||s.invalidArg("sources")),o=-1,e=0,n=t.length;e<n;e++)a=t[e],a&&o<(i=p.indexOf(a.get("status")))&&(o=i);return o===-1?"nodata":p[o]},c&&(i=0,o=0),t.addDataSource=function(e){var n,a;if(r){if(this.ds_dataSource)throw new Error("This class already has data source mixin in it");0!==arguments.length&&"function"!=typeof e&&s.invalidArg("onStatusChange")}this.ds_dataSource=!0,c&&(this.ds_ctor.unshift(function(){this.$ds_sourceId=++i,console.info(++o+":ctor: "+t.desc(this)+"("+this.$ds_sourceId+")"),o===window.sourceBreak}),this.ds_dstr.push(function(){console.info(++o+":dstr: "+t.desc(this)+"("+this.$ds_sourceId+")"),o===window.sourceBreak})),a=function(t){return null===t||f.indexOf(t)>=0?t:void 0},n=this.prop({name:"status",type:"status",valid:a,init:f[0],set:function(n){var r,i,u,l,d;if("undefined"==typeof(n=a(d=n))&&s.invalidValue(this,"status",d),(u=this._status)!==n)for(c&&(console.info(++o+":newStatus: "+t.desc(this)+"("+this.$ds_sourceId+"), new: "+n+", old: "+u),o===window.sourceBreak),this._status=n,null!=e&&e.call(this,n,u),l=this.$ds_statusWatchers,r=l.length-1;r>=0;r+=-1)i=l[r],i.lst(this,n,u,i.unwatch)}}),n.statusValues=f,this.prototype.__init.$ds_statusWatchers=function(){return[]},this.prototype.watchStatus=function(t,e){var n,o,i,a;return r&&("object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("referry"),"function"!=typeof e&&s.invalidArg("listener")),(a=this.$ds_statusWatchers).push(i={lst:e}),this.addRef(t),i.unwatch=o=function(e){return function(n){return function(){n||(e.release(t),_.remove(a,i),n=!0)}}}(this)(!1),n=this.get("status"),"update"===n?(e(this,"ready","nodata",o),_.find(a,i)&&e(this,"update","ready",o)):e(this,n,"nodata",o),o}},t}()},{"./util":92}],88:[function(t,e,n){var o,r,s,i,a,u,c=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;i=t("./util").assert,a=t("./util").error,u=t("./util").traceWatch,r=t("./DSObjectBase"),o=t("./DSDigest"),e.exports=s=function(t){function e(){return n.apply(this,arguments)}var n,s;return c(e,t),e.begin("DSPool"),n=function(t,e,n,o){var s;r.call(this,t,e),i&&(r.isAssignableFrom(n)||a.notDSObjectClass(n)),s=this.items={},this.type=n,o&&(this.watchOn=!0,this.evt=[])},s=function(t){var e,n,o,r,s;if((r=this.items).hasOwnProperty(t))for(o=r[t],s=this.evt,n=s.length-1;n>=0;n+=-1)e=s[n],e.lst(o)},e.prototype.__onChange=function(t){this.watchOn&&this.evt.length>0&&o.render(this.$ds_key,t.$ds_key,function(t){return function(e){s.call(t,e)}}(this))},e.prototype.find=function(t,e,n){var o,r;return i&&("string"==typeof e||"object"==typeof e&&null!==e||a.invalidArg("key"),"undefined"==typeof n||"object"==typeof n&&null!==n||a.invalidArg("map")),"object"==typeof e&&(e=JSON.stringify(r=e)),n&&n.hasOwnProperty(e)?n[e]:(this.items.hasOwnProperty(e)?(o=this.items[e]).addRef(t):(o=this.items[e]=new this.type(t,e,r),o.$ds_pool=this,this.evt&&(o.hasOwnProperty("$ds_evt")?(i&&_.find(o.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),o.$ds_evt.push(this)):o.$ds_evt=[this],this.__onChange(o))),n?n[e]=o:o)},e.prototype.enableWatch=function(t){if(i&&!this.evt)throw new Error("Pool '"+r.desc(this)+"' watch functionality is not enabled");this.watchOn=t},e.prototype.watch=function(t,e){var n,o,s,c,l;if(i){"object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"function"!=typeof e&&a.invalidArg("listener");for(s in e)if(c=e[s],"change"!==s&&"add"!==s&&"remove"!==s)throw new Error("Unexpected event listener: "+s);if(u&&(e.owner=t),!this.evt)throw new Error("Pool '"+r.desc(this)+"' watch functionality is not enabled")}return(o=this.evt).push(l={lst:e}),this.addRef(t),n=!0,function(e){return function(){n&&(n=!1,e.release(t),_.remove(o,l))}}(this)},e.end(),e}(r)},{"./DSDigest":82,"./DSObjectBase":87,"./util":92}],89:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p=function(t,e){function n(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;d=t("./util"),s=t("./util").assert,c=t("./util").traceRefs,l=t("./util").traceWatch,u=t("./util").totalReleaseVerb,a=t("./util").modeReleaseDataOnReload,i=t("./util").error,o=t("./DSObjectBase"),e.exports=r=function(t){function e(){return a.apply(this,arguments)}var n,r,a;return p(e,t),e.begin("DSSet"),e.addDataSource(),e.ds_dstr.push(function(){var t,e,n,o;n=t=this.items;for(e in n)o=n[e],o.release(this),delete t[e]}),a=function(t,e,n,r){o.call(this,t,e),s&&(!n instanceof o&&i.notDSObjectClass(n),"object"!=typeof r&&void 0!==r&&i.invalidArg("data")),this.data=r,this.type=n,this.evt=[],this.items={}},e.prototype.__onChange=function(){var t,e,n,o;for(n=this.evt,e=n.length-1;e>=0;e+=-1)t=n[e],null!=(o=t.change)&&o.apply(t,arguments)},e.prototype.merge=function(t,e){var o,a,u;s&&("object"==typeof t&&t!==window||"function"==typeof t||i.invalidArg("owner"),"object"!=typeof e&&i.invalidArg("newMap")),u=this.items;for(a in u)o=u[a],e.hasOwnProperty(a)||r.call(this,o);for(a in e){if(o=e[a],s&&a!==o.$ds_key)throw new Error("Invalid source map.  key: "+a+"; item.$ds_key: "+o.$ds_key);n.call(this,t,o)}return this.items},e.prototype.reset=function(){var t,e,n,o,r;for(t=this.evt,_.forEach(n=this.items,function(e){return function(n){var o,r,s;for(r=0,s=t.length;r<s;r++)o=t[r],"function"==typeof o.remove&&o.remove(n);n.release(e)}}(this)),e=0,r=n.length;e<r;e++)o=n[e],delete n[o]},e.prototype.remove=function(t){this.items.hasOwnProperty(t.$ds_key)&&r.call(this,t)},r=function(t){var e,n,o;for(t.hasOwnProperty("$ds_evt")&&(s&&(_.find(t.$ds_evt,this)||console.error("Not an event listener")),_.remove(t.$ds_evt,this)),delete this.items[t.$ds_key],o=this.evt,n=o.length-1;n>=0;n+=-1)e=o[n],"function"==typeof e.remove&&e.remove(t);t.release(this)},e.prototype.add=n=function(t,e){var n,r,a,l,p,f;if(s&&("object"==typeof t&&t!==window||"function"==typeof t||i.invalidArg("owner"),e instanceof this.type||i.invalidMapElementType(this,e)),(l=this.items).hasOwnProperty(e.$ds_key))e.release(t);else for(e.hasOwnProperty("$ds_evt")?(s&&_.find(e.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),e.$ds_evt.push(this)):e.$ds_evt=[this],l[e.$ds_key]=e,c&&(f=e.$ds_referries,0===f.length?console.error(o.desc(e)+": Empty $ds_referries"):(a=f.lastIndexOf(t))<0?console.error(o.desc(this)+": Referry not found: "+o.desc(t)):(u&&(console.info(++d.serviceOwner.msgCount+": transfer: "+o.desc(e)+", refs: "+this.$ds_ref+", from: "+o.desc(t)+", to: "+o.desc(this)),d.serviceOwner.msgCount===window.totalBreak),f[a]=this)),p=this.evt,r=p.length-1;r>=0;r+=-1)n=p[r],"function"==typeof n.add&&n.add(e)},e.prototype.clear=function(){this.merge(this,{}),this.set("status","nodata")},e.prototype.watch=function(t,e,n){var o,r,a,u;if(s){"object"==typeof t&&t!==window||"function"==typeof t||i.invalidArg("owner"),"object"!=typeof e&&i.invalidArg("listener");for(a in e)if(u=e[a],"change"!==a&&"add"!==a&&"remove"!==a)throw new Error("Unexpected event listener: "+a);l&&(e.owner=t)}if(_.find(this.evt,function(t){return t===e})&&(e=_.clone(e)),(r=this.evt).push(e),!n)return this.addRef(t),o=!0,function(n){return function(){o&&(o=!1,n.release(t),_.remove(r,function(t){return t===e}))}}(this)},e.prototype.addRef=function(t){var n;return 1===this.$ds_ref&&(n=this.data)&&1===++n.__busySets&&n.addRef(n.__backRef=this),e.__super__.addRef.call(this,t),this},e.prototype.release=function(t){var n;return e.__super__.release.call(this,t),1===this.$ds_ref&&(n=this.data)&&0===--n.__busySets&&n.release(n.__backRef),this},e.end(),e}(o)},{"./DSObjectBase":87,"./util":92}],90:[function(t,e,n){var o,r,s,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;s=t("./util").assert,i=t("./util").error,o=t("./DSObjectBase"),e.exports=r=function(t){function e(t,n){var r,a,u,c,l,d,p,f,h,m;if(e.__super__.constructor.call(this,t,""+ ++e.nextTags),s&&(2===arguments.length&&"object"==typeof(f=arguments[1])||void 0!==n&&"string"!=typeof n&&i.invalidArg("enums")),2===arguments.length&&"object"==typeof(f=arguments[1])){f.__proto__===e.prototype?(this.map=_.clone(f.map),this.value=f.value):(this.map=l=_.clone(n),this.value=_.sortBy(function(){var t;t=[];for(a in l)t.push(a);return t}()).join(", ")),d=this.map;for(u in d)m=d[u],m instanceof o&&m.addRef(this)}else{if(this.map=l={},"string"==typeof n)for(p=n.split(","),r=0,c=p.length;r<c;r++)h=p[r],l[h.trim()]=!0;this.value=_.sortBy(function(){var t;t=[];for(a in l)t.push(a);return t}()).join(", ")}}return a(e,t),e.nextTags=0,e.begin("DSTags"),e.addPropType=function(t){t.propDSTags=function(n,o){var r,a;return s&&o&&"function"!=typeof o&&i.invalidArg("valid"),o=(a=o)?function(t){return(null===t||"object"==typeof t&&t instanceof e)&&a(t)?t:void 0}:function(t){return null===t||t instanceof e?t:void 0},r="_"+n,this.ds_dstr.push(function(){this[r]&&this[r].release(this)}),t.prop({name:n,type:"DSTags",valid:o,read:function(t){return null!==t?new e(this,t):null},str:function(t){return t.value},init:null,set:function(t){var e,s,a,u,c;if("undefined"==typeof(t=o(c=t))&&i.invalidValue(this,n,c),(u=this[r])!==t){if(this[r]=t,t&&t.addRef(this),e=this.$ds_evt)for(s=e.length-1;s>=0;s+=-1)a=e[s],a.__onChange.call(a,this,n,t,u);u&&u.release(this)}}})}},e.ds_dstr.push(function(){var t,e,n;e=this.map;for(t in e)n=e[t],n instanceof o&&n.release(this)}),e.prototype.clone=function(t){return new e(t,this)},e.prototype.toString=function(){return this.value},e.prototype.valueOf=function(){return this.value},e.prototype.set=function(t,e){var n,r,a,u;return s&&("string"!=typeof t&&i.invalidArg("enumValue"),"undefined"==typeof e&&i.invalidArg("value")),e?(n=(a=this.map).hasOwnProperty(t),e instanceof o&&e.addRef(this),(u=a[t])instanceof o&&u.release(this),a[t]=e,n||(this.value=_.sortBy(function(){var t;t=[];for(r in a)t.push(r);return t}()).join(", "))):(a=this.map).hasOwnProperty(t)&&((u=a[t])instanceof o&&u.release(this),delete this.map[t],this.value=_.sortBy(function(){var t;t=[];for(r in a)t.push(r);return t}()).join(", ")),this},e.prototype.get=function(t){return s&&"string"!=typeof t&&i.invalidArg("enumValue"),!!this.map.hasOwnProperty(t)&&this.map[t]},e.prototype.any=function(t){var e;for(e in t)if(this.map.hasOwnProperty(e))return!0;return!1},e.prototype.empty=function(){var t;for(t in this.map)return!1;return!0},e.prototype.diff=function(t){var n,o,r;return s&&("object"==typeof t&&t.__proto__===e.prototype||i.invalidArg("src")),r=t.map,function(){var t;t=[];for(n in o=this.map)r.hasOwnProperty(n)||t.push("+"+n);return t}.call(this).concat(function(){var t;t=[];for(n in r)o.hasOwnProperty(n)||t.push("-"+n);return t}()).join(", ")},e.end(),e}(o)},{"./DSObjectBase":87,"./util":92}],91:[function(t,e,n){var o,r,s,i,a,u,c=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;e.exports=(a=angular.module("dscommon/DSView",[t("../app/data/dsDataService")])).name,u=t("./util").traceView,s=t("./util").assert,i=t("./util").error,o=t("./DSObject"),r=t("./DSSet"),a.factory("DSView",["dsDataService","$log",function(t,e){var n,r;return r=function(){function t(){}return t.prototype.get=function(t){return s&&(this.hasOwnProperty(t)||i.invalidProp(this,t)),this[t]},t.prototype.set=function(t,e){return s&&(this.hasOwnProperty(t)||i.invalidProp(this,t)),this[t]=e},t}(),n=function(e){function n(){return a.apply(this,arguments)}var a,l;return c(n,e),n.begin("DSView"),n.begin=function(t){var e;o.begin.call(this,t),this.prototype.__src=(e=this.__super__.__src)?_.clone(e):{}},n.propData=function(t,e,n){var o,r;if(s){if("undefined"!=typeof this.prototype._src)throw new Error("Duplicate data set name: "+t);"undefined"==typeof n||"object"==typeof n&&null!==n||i.invalidArg("params")}"object"==typeof n&&(n.hasOwnProperty("watch")?(r=n.watch,delete n.watch):r=null,s&&(_.isArray(r)||null===r||i.invalidArg("params.watch"))),this.prototype.__srcLength=(o=_.size(this.prototype.__src))+1,this.prototype.__src[t]={name:t,type:e,watch:r,params:n,index:o}},n.ds_dstr.push(function(){var t,e,n;"function"==typeof this.__unwatch1&&this.__unwatch1(),"function"==typeof this.__unwatch2&&this.__unwatch2(),e=this.__src;for(t in e)n=e[t],"function"==typeof n.unwatch&&n.unwatch(),"function"==typeof n.unwatchStatus&&n.unwatchStatus(),n.hasOwnProperty("set")&&n.set.release(this)}),a=function(t,e){var n,r,a,u,c;o.call(this,t,e),s&&"object"!=typeof t&&i.invalidArg("$scope"),this.__unwatch1=(this.__scope=t).$on("$destroy",function(e){return function(){return delete e.__unwatch1,e.release(t)}}(this)),this.__dirty=0,this.__src=_.cloneDeep(this.__proto__.__src),this.__srcList=new Array(this.__proto__.__srcLength),this.dataStatus="nodata",a=function(t){return function(){t.__dirty++}}(this),r=this.__src;for(n in r)u=r[n],c=u.watch,u.listener={add:a,remove:a,change:c?function(t){return function(e){return function(n,o){e.indexOf(o)!==-1&&t.__dirty++}}}(this)(c):a}},n.prop({name:"data",type:"DSView.data",readonly:!0,init:function(){return new r}}),l=0,n.prototype.dataUpdate=function(e){var n,r,a,c,d,p,f,h,m;"undefined"==typeof e&&(e={}),s&&"object"!=typeof e&&null!==e&&i.invalidArg("params"),t.requestSources(this,e,this.__src),f=this.__src;for(a in f)if(m=f[a],m.hasOwnProperty("newSet")){if(d=m.newSet,m.hasOwnProperty("set")&&(m.set.release(this),m.unwatch(),m.unwatchStatus()),Object.defineProperty(n=this.get("data"),a,{configurable:!0,enumerable:!0,value:d.items}),Object.defineProperty(n,a+"Set",{configurable:!0,get:function(t){return function(){return t}}(d)}),Object.defineProperty(n,a+"Status",{configurable:!0,get:function(t){return function(){return t.get("status")}}(d)}),this.__srcList[m.index]=m.set=d,delete m.newSet,this.__dirty++,m.unwatch=d.watch(this,m.listener),p=!0,null!==m.watch)for(h=m.watch,r=0,c=h.length;r<c;r++){a=h[r],p=!1;break}else p=!1;m.unwatchStatus=function(t){return function(e){return d.watchStatus(t,function(n,r,s){var i;(s=t.dataStatus)!==(i=o.integratedStatus(t.__srcList))&&(t.dataStatus=i,!e&&("ready"===i&&"update"===s||"update"===i&&"ready"===s)||t.__dirty++)})}}(this)(p)}this.hasOwnProperty("__unwatch2")||(this.__unwatch2=this.__scope.$watch(function(t){return function(){return t.__dirty}}(this),function(t){return function(e,n){var r,s,i,a;if(u){s="",r=t.__src;for(a in r)i=r[a],s+=", "+a+": "+i.set.get("status");console.info(++l+":"+o.desc(t)+".render(): dataStatus: "+t.dataStatus+s),l===window.viewBreak}t.render()}}(this)))},n.end(),n}(o)}])},{"../app/data/dsDataService":26,"./DSObject":86,"./DSSet":89,"./util":92}],92:[function(t,e,n){var o,r;e.exports=r={assert:!0,traceData:!1,traceWatch:!1,traceView:!1,traceRefs:!1,totalRelease:!1,totalReleaseVerb:!1,modeReleaseDataOnReload:!0,serviceOwner:new(o=function(){function t(){return e.apply(this,arguments)}var e;return e=function(){this.name="serviceOwner",this.services=[],this.poolCleaners=[]},t.prototype.start=function(){this.services=[],this.poolCleaners=[]},t.prototype.stop=function(){var t,e,n,o,r,s,i,a;for(s=this.services,e=0,o=s.length;e<o;e++)a=s[e],a.release(this);if(this.poolCleaners)for(i=this.poolCleaners,n=0,r=i.length;n<r;n++)(t=i[n])()},t.prototype.add=function(t){return this.services.push(t),t},t.prototype.remove=function(t){_.remove(this.services,t)},t.prototype.clearPool=function(t){return this.poolCleaners.push(t)},t}()),validate:{required:function(t){return"undefined"!=typeof t&&null!==t?t:void 0},trimString:function(t){return"string"!=typeof t?null:0===(t=t.trim()).length?null:t}},error:{invalidArg:function(t){throw new Error("Invalid '"+t+"' parameter")},notDSObjectClass:function(t){throw new Error("Not a DSObject class")},invalidProp:function(t,e){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid property")},invalidListValue:function(t,e){throw new Error("Invalid value '"+e+"' at position "+t)},duplicatedProperty:function(t,e){throw new Error("Class '"+t.docType+"': Prop '"+e+"': Duplicated property name")},propIsReadOnly:function(t,e){throw new Error("Class '"+t.docType+"': Prop '"+e+"': Property is read-only")},invalidValue:function(t,e,n){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid value '"+n+"'")},invalidMapElementType:function(t){throw new Error("Invalid element type '"+t+"'")},invalidPropMapElementType:function(t,e,n){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid value '"+n+"'")}}}},{}],93:[function(t,e,n){!function(t,e,n){"use strict";function o(t){return/^-?\d+\.?\d*$/.test(t.replace(/["']/g,""))}var r=e.isDefined,s=e.isUndefined,i=e.isNumber,a=e.isObject,u=e.isArray,c=e.extend,l=e.toJson,d=e.fromJson,p=e.module("LocalStorageModule",[]);p.provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/"},this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(t){return this.prefix=t,this},this.setStorageType=function(t){return this.storageType=t,this},this.setStorageCookie=function(t,e){return this.cookie={expiry:t,path:e},this},this.setStorageCookieDomain=function(t){return this.cookie.domain=t,this},this.setNotify=function(t,e){return this.notify={setItem:t,removeItem:e},this},this.$get=["$rootScope","$window","$document","$parse",function(t,e,n,p){var f,h=this,m=h.prefix,g=h.cookie,y=h.notify,v=h.storageType;n?n[0]&&(n=n[0]):n=document,"."!==m.substr(-1)&&(m=m?m+".":"");var _=function(t){return m+t},w=function(){try{var n=v in e&&null!==e[v],o=_("__"+Math.round(1e7*Math.random()));return n&&(f=e[v],f.setItem(o,""),f.removeItem(o)),n}catch(r){return v="cookie",t.$broadcast("LocalStorageModule.notification.error",r.message),!1}}(),k=function(e,n){if(s(n)?n=null:(a(n)||u(n)||i(+n||n))&&(n=l(n)),!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),y.setItem&&t.$broadcast("LocalStorageModule.notification.setitem",{key:e,newvalue:n,storageType:"cookie"}),P(e,n);try{(a(n)||u(n))&&(n=l(n)),f&&f.setItem(_(e),n),y.setItem&&t.$broadcast("LocalStorageModule.notification.setitem",{key:e,newvalue:n,storageType:h.storageType})}catch(o){return t.$broadcast("LocalStorageModule.notification.error",o.message),P(e,n)}return!0},S=function(e){if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),$(e);var n=f?f.getItem(_(e)):null;return n&&"null"!==n?"{"===n.charAt(0)||"["===n.charAt(0)||o(n)?d(n):n:null},D=function(e){if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),y.removeItem&&t.$broadcast("LocalStorageModule.notification.removeitem",{key:e,storageType:"cookie"}),j(e);try{f.removeItem(_(e)),y.removeItem&&t.$broadcast("LocalStorageModule.notification.removeitem",{key:e,storageType:h.storageType})}catch(n){return t.$broadcast("LocalStorageModule.notification.error",n.message),
j(e)}return!0},b=function(){if(!w)return t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var e=m.length,n=[];for(var o in f)if(o.substr(0,e)===m)try{n.push(o.substr(e))}catch(r){return t.$broadcast("LocalStorageModule.notification.error",r.Description),[]}return n},T=function(e){e=e||"";var n=m.slice(0,-1),o=new RegExp(n+"."+e);if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),x();var r=m.length;for(var s in f)if(o.test(s))try{D(s.substr(r))}catch(i){return t.$broadcast("LocalStorageModule.notification.error",i.message),x()}return!0},O=function(){try{return e.navigator.cookieEnabled||"cookie"in n&&(n.cookie.length>0||(n.cookie="test").indexOf.call(n.cookie,"test")>-1)}catch(o){return t.$broadcast("LocalStorageModule.notification.error",o.message),!1}}(),P=function(e,o){if(s(o))return!1;if((u(o)||a(o))&&(o=l(o)),!O)return t.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var r="",i=new Date,c="";if(null===o?(i.setTime(i.getTime()+-864e5),r="; expires="+i.toGMTString(),o=""):0!==g.expiry&&(i.setTime(i.getTime()+24*g.expiry*60*60*1e3),r="; expires="+i.toGMTString()),e){var d="; path="+g.path;g.domain&&(c="; domain="+g.domain),n.cookie=_(e)+"="+encodeURIComponent(o)+r+d+c}}catch(p){return t.$broadcast("LocalStorageModule.notification.error",p.message),!1}return!0},$=function(e){if(!O)return t.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var o=n.cookie&&n.cookie.split(";")||[],r=0;r<o.length;r++){for(var s=o[r];" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(_(e)+"=")){var i=decodeURIComponent(s.substring(m.length+e.length+1,s.length));try{var a=JSON.parse(i);return d(a)}catch(u){return i}}}return null},j=function(t){P(t,null)},x=function(){for(var t=null,e=m.length,o=n.cookie.split(";"),r=0;r<o.length;r++){for(t=o[r];" "===t.charAt(0);)t=t.substring(1,t.length);var s=t.substring(e,t.indexOf("="));j(s)}},L=function(){return v},A=function(t,e,n,o){o=o||e;var s=S(o);return null===s&&r(n)?s=n:a(s)&&a(n)&&(s=c(n,s)),p(e).assign(t,s),t.$watch(e,function(t){k(o,t)},a(t[e]))},C=function(){for(var t=0,n=e[v],o=0;o<n.length;o++)0===n.key(o).indexOf(m)&&t++;return t};return{isSupported:w,getStorageType:L,set:k,add:k,get:S,keys:b,remove:D,clearAll:T,bind:A,deriveKey:_,length:C,cookie:{isSupported:O,set:P,add:P,get:$,remove:j,clearAll:x}}}]})}(window,window.angular)},{}],94:[function(t,e,n){var o;o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.exports={encode:function(t){var e,n,r,s,i,a,u,c,l;for(l="",e=void 0,n=void 0,r="",s=void 0,i=void 0,a=void 0,u="",c=0;;)if(e=t.charCodeAt(c++),n=t.charCodeAt(c++),r=t.charCodeAt(c++),s=e>>2,i=(3&e)<<4|n>>4,a=(15&n)<<2|r>>6,u=63&r,isNaN(n)?a=u=64:isNaN(r)&&(u=64),l=l+o.charAt(s)+o.charAt(i)+o.charAt(a)+o.charAt(u),e=n=r="",s=i=a=u="",!(c<t.length))break;return l},decode:function(t){var e,n,r,s,i,a,u,c,l,d;for(d="",n=void 0,r=void 0,s="",i=void 0,a=void 0,u=void 0,c="",l=0,e=/[^A-Za-z0-9\+\/\=]/g,e.exec(t)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");;)if(i=o.indexOf(t.charAt(l++)),a=o.indexOf(t.charAt(l++)),u=o.indexOf(t.charAt(l++)),c=o.indexOf(t.charAt(l++)),n=i<<2|a>>4,r=(15&a)<<4|u>>2,s=(3&u)<<6|c,d+=String.fromCharCode(n),64!==u&&(d+=String.fromCharCode(r)),64!==c&&(d+=String.fromCharCode(s)),n=r=s="",i=a=u=c="",!(l<t.length))break;return d}}},{}],95:[function(t,e,n){(function(o){var r=function(){var t={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(t,e,n,o,r,s,i){var a=s.length-1;switch(r){case 1:this.$=t.replace(/\\(\\|")/g,"$1").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\v/g,"\x0B").replace(/\\f/g,"\f").replace(/\\b/g,"\b");break;case 2:this.$=Number(t);break;case 3:this.$=null;break;case 4:this.$=!0;break;case 5:this.$=!1;break;case 6:return this.$=s[a-1];case 13:this.$={};break;case 14:this.$=s[a-1];break;case 15:this.$=[s[a-2],s[a]];break;case 16:this.$={},this.$[s[a][0]]=s[a][1];break;case 17:this.$=s[a-2],s[a-2][s[a][0]]=s[a][1];break;case 18:this.$=[];break;case 19:this.$=s[a-1];break;case 20:this.$=[s[a]];break;case 21:this.$=s[a-2],s[a-2].push(s[a])}},table:[{3:5,4:[1,12],5:6,6:[1,13],7:3,8:[1,9],9:4,10:[1,10],11:[1,11],12:1,13:2,15:7,16:8,17:[1,14],23:[1,15]},{1:[3]},{14:[1,16]},{14:[2,7],18:[2,7],22:[2,7],24:[2,7]},{14:[2,8],18:[2,8],22:[2,8],24:[2,8]},{14:[2,9],18:[2,9],22:[2,9],24:[2,9]},{14:[2,10],18:[2,10],22:[2,10],24:[2,10]},{14:[2,11],18:[2,11],22:[2,11],24:[2,11]},{14:[2,12],18:[2,12],22:[2,12],24:[2,12]},{14:[2,3],18:[2,3],22:[2,3],24:[2,3]},{14:[2,4],18:[2,4],22:[2,4],24:[2,4]},{14:[2,5],18:[2,5],22:[2,5],24:[2,5]},{14:[2,1],18:[2,1],21:[2,1],22:[2,1],24:[2,1]},{14:[2,2],18:[2,2],22:[2,2],24:[2,2]},{3:20,4:[1,12],18:[1,17],19:18,20:19},{3:5,4:[1,12],5:6,6:[1,13],7:3,8:[1,9],9:4,10:[1,10],11:[1,11],13:23,15:7,16:8,17:[1,14],23:[1,15],24:[1,21],25:22},{1:[2,6]},{14:[2,13],18:[2,13],22:[2,13],24:[2,13]},{18:[1,24],22:[1,25]},{18:[2,16],22:[2,16]},{21:[1,26]},{14:[2,18],18:[2,18],22:[2,18],24:[2,18]},{22:[1,28],24:[1,27]},{22:[2,20],24:[2,20]},{14:[2,14],18:[2,14],22:[2,14],24:[2,14]},{3:20,4:[1,12],20:29},{3:5,4:[1,12],5:6,6:[1,13],7:3,8:[1,9],9:4,10:[1,10],11:[1,11],13:30,15:7,16:8,17:[1,14],23:[1,15]},{14:[2,19],18:[2,19],22:[2,19],24:[2,19]},{3:5,4:[1,12],5:6,6:[1,13],7:3,8:[1,9],9:4,10:[1,10],11:[1,11],13:31,15:7,16:8,17:[1,14],23:[1,15]},{18:[2,17],22:[2,17]},{18:[2,15],22:[2,15]},{22:[2,21],24:[2,21]}],defaultActions:{16:[2,6]},parseError:function(t,e){throw new Error(t)},parse:function(t){function e(t){r.length=r.length-2*t,s.length=s.length-t,i.length=i.length-t}function n(){var t;return t=o.lexer.lex()||1,"number"!=typeof t&&(t=o.symbols_[t]||t),t}var o=this,r=[0],s=[null],i=[],a=this.table,u="",c=0,l=0,d=0,p=2,f=1;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var h=this.lexer.yylloc;i.push(h),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var m,g,y,v,_,w,k,S,D,b={};;){if(y=r[r.length-1],this.defaultActions[y]?v=this.defaultActions[y]:(null==m&&(m=n()),v=a[y]&&a[y][m]),"undefined"==typeof v||!v.length||!v[0]){if(!d){D=[];for(w in a[y])this.terminals_[w]&&w>2&&D.push("'"+this.terminals_[w]+"'");var T="";T=this.lexer.showPosition?"Parse error on line "+(c+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+D.join(", ")+", got '"+this.terminals_[m]+"'":"Parse error on line "+(c+1)+": Unexpected "+(1==m?"end of input":"'"+(this.terminals_[m]||m)+"'"),this.parseError(T,{text:this.lexer.match,token:this.terminals_[m]||m,line:this.lexer.yylineno,loc:h,expected:D})}if(3==d){if(m==f)throw new Error(T||"Parsing halted.");l=this.lexer.yyleng,u=this.lexer.yytext,c=this.lexer.yylineno,h=this.lexer.yylloc,m=n()}for(;;){if(p.toString()in a[y])break;if(0==y)throw new Error(T||"Parsing halted.");e(1),y=r[r.length-1]}g=m,m=p,y=r[r.length-1],v=a[y]&&a[y][p],d=3}if(v[0]instanceof Array&&v.length>1)throw new Error("Parse Error: multiple actions possible at state: "+y+", token: "+m);switch(v[0]){case 1:r.push(m),s.push(this.lexer.yytext),i.push(this.lexer.yylloc),r.push(v[1]),m=null,g?(m=g,g=null):(l=this.lexer.yyleng,u=this.lexer.yytext,c=this.lexer.yylineno,h=this.lexer.yylloc,d>0&&d--);break;case 2:if(k=this.productions_[v[1]][1],b.$=s[s.length-k],b._$={first_line:i[i.length-(k||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(k||1)].first_column,last_column:i[i.length-1].last_column},_=this.performAction.call(b,u,l,c,this.yy,v[1],s,i),"undefined"!=typeof _)return _;k&&(r=r.slice(0,-1*k*2),s=s.slice(0,-1*k),i=i.slice(0,-1*k)),r.push(this.productions_[v[1]][0]),s.push(b.$),i.push(b._$),S=a[r[r.length-2]][r[r.length-1]],r.push(S);break;case 3:return!0}}return!0}},e=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parseError)throw new Error(t);this.yy.parseError(t,e)},setInput:function(t){return this._input=t,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.match+=t,this.matched+=t;var e=t.match(/\n/);return e&&this.yylineno++,this._input=this._input.slice(1),t},unput:function(t){return this._input=t+this._input,this},more:function(){return this._more=!0,this},less:function(t){this._input=this.match.slice(t)+this._input},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,n,o,r;this._more||(this.yytext="",this.match="");for(var s=this._currentRules(),i=0;i<s.length&&(n=this._input.match(this.rules[s[i]]),!n||e&&!(n[0].length>e[0].length)||(e=n,o=i,this.options.flex));i++);return e?(r=e[0].match(/\n.*/g),r&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-1:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],t=this.performAction.call(this,this.yy,this,s[o],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),t?t:void 0):""===this._input?this.EOF:void this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return"undefined"!=typeof t?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return t.options={},t.performAction=function(t,e,n,o){switch(n){case 0:break;case 1:return 6;case 2:return e.yytext=e.yytext.substr(1,e.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},t.rules=[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt\/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],t.conditions={INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}},t}();return t.lexer=e,t}();"undefined"!=typeof t&&"undefined"!=typeof n&&(n.parse=function(){return r.parse.apply(r,arguments)},"undefined"!=typeof e&&t.main===e&&n.main("undefined"!=typeof o?o.argv.slice(1):t("system").args))}).call(this,t("_process"))},{_process:2,system:12}]},{},[20]);
